<!DOCTYPE html>
<html lang="zh-tw">
<head><meta name="generator" content="Hexo 3.9.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Tomas Lin">


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="湯瑪士的部落格">
<meta property="og:url" content="https://horsekitlin.github.io/page/5/index.html">
<meta property="og:site_name" content="湯瑪士的部落格">
<meta property="og:locale" content="zh-tw">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="湯瑪士的部落格">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="湯瑪士的部落格" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>湯瑪士的部落格</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Tomas Lin</a></h1>
        </hgroup>

        
        <p class="header-subtitle">技術手扎！不定期更新</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/archives/">主頁</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">標籤</a></li>
                        
                            <li><a href="/about/">關於我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:passon.com.tw@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/passontw" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css/">Css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DesignPatten/">DesignPatten</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FunctionPrograming/">FunctionPrograming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IThome2023/">IThome2023</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Leetcode/">Leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Material-design/">Material-design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MessageQueue/">MessageQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Microservies/">Microservies</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-Native/">React Native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reason/">Reason</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redux/">Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SocketCluster/">SocketCluster</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sodility/">Sodility</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Themes/">Themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translate/">Translate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Truffle/">Truffle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typescript/">Typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/">VSCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ithome-12/">ithome 12</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/">spring-boot</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Tomas Lin</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Tomas Lin</a></h1>
            </hgroup>
            
            <p class="header-subtitle">技術手扎！不定期更新</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">主頁</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">標籤</a></li>
                
                    <li><a href="/about/">關於我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:passon.com.tw@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/passontw" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-ReasonReact-Component" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/04/ReasonReact-Component/" class="article-date">
      <time datetime="2018-11-04T09:17:34.000Z" itemprop="datePublished">2018-11-04</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/04/ReasonReact-Component/">ReasonReact-Component</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h1><h2 id="Creation"><a href="#Creation" class="headerlink" title="Creation"></a>Creation</h2><p>ReasonReact 不需要　<code>class</code> 來建立 Component</p>
<p>提供一個建立的 API 會回傳一個 record</p>
<p>他的欄位是可以覆寫的(就像 <code>render</code>, <code>initialState</code>, <code>didMount</code>… 之類的)</p>
<p><code>ReasonReact.statelessComponent(&quot;TheComponentName&quot;)</code></p>
<p>字串是為了提供 <code>Debuging</code> 他就像是 React 中的 <code>displayName</code></p>
<p>例如要建立一個新的 <code>Greeting</code> 的 Component</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let component = ReasonReact.statelessComponent(&quot;Greeting&quot;);</span><br><span class="line"></span><br><span class="line">let make = (~name, _children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  render: _self =&gt; &lt;div&gt;&#123;ReasonReact.string(name)&#125;&lt;/div&gt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>make 會回傳一個 <code>Component record</code></p>
<p><strong>Note: 不要直接使用 <code>ReasonReact.statelessComponent</code>直接在 make 中解構，範例如下</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let make = _children =&gt; &#123;</span><br><span class="line">  ...(ReasonReact.statelessComponent(&quot;Greeting&quot;)),</span><br><span class="line">  render: self =&gt; blabla</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>上述範例為錯誤示範，請勿使用</strong></p>
<h1 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h1><p><code>Props</code> 其實就是 make function 中的 <code>labeld arguments</code> </p>
<p>也可以是有選擇性(optional)或有預設值(default value)</p>
<p>例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let make = (~name, ~age=?, ~className=&quot;box&quot;, _children) =&gt; </span><br><span class="line">  &lt;div&gt;(ReasonReact.string(name))&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>最後的一個參數必須是 <code>children</code> 但是如果沒有使用到的話</p>
<p>可以用 <code>_</code> 或是 <code>_children</code> 來做命名 compiler 會自動規避</p>
<p><code>props</code> 的名字不能是 <code>ref</code> 或是 <code>key</code></p>
<p>這部分和 ReactJs 一樣</p>
<p>上面的範例如果只傳入 <code>name</code></p>
<p><code>classname</code> 會是預設的 box</p>
<p><code>age</code> 預設會是 None</p>
<p>有時候在 ReactJs 中會以傳入的值決定回傳的 Component</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Foo name=&quot;Reason&quot; age=&#123;this.props.age&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>如果這樣傳值的話有可能會有 bug</p>
<p>因為 <code>age</code> 有可能是 Null 的</p>
<p>所以可以透過 varian</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">switch (myAge) &#123;</span><br><span class="line">| None =&gt; &lt;Foo name=&quot;Reason&quot; /&gt;</span><br><span class="line">| Some(nonOptionalAge) =&gt; &lt;Foo name=&quot;Reason&quot; age=nonOptionalAge /&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>這樣看起來有點繁雜</p>
<p>也可以這樣處理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Foo name=&quot;Reason&quot; age=?myAge /&gt;</span><br></pre></td></tr></table></figure>
<p>這並不是特殊的手法</p>
<p>詳情可以參照 <a href="https://reasonml.github.io/docs/en/function.html#explicitly-passed-optional" target="_blank" rel="noopener">Reason doc</a></p>
<h2 id="self"><a href="#self" class="headerlink" title="self"></a>self</h2><p>你會在 <code>make</code> 中看到 <code>self</code> 他的角色就像是 Javascript 中的 <code>this</code></p>
<p>它是一個 <code>record</code> 包含了 <code>state</code>, <code>handler</code>, <code>send</code></p>
<p>也可以傳遞生命週期 API</p>
<h1 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h1><p>Reason 也可以接受 <code>JSX</code> 但是在 <code>bsconfig.json</code> 要給予設定資訊</p>
<p><code>{&quot;reason&quot;: {&quot;react-jsx&quot;: 2}</code></p>
<p>更詳細的 <a href="https://bucklescript.github.io/bucklescript/docson/#build-schema.json" target="_blank" rel="noopener">schema</a></p>
<h2 id="Uncapitalized"><a href="#Uncapitalized" class="headerlink" title="Uncapitalized"></a>Uncapitalized</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div foo=&#123;bar&#125;&gt; &#123;child1&#125; &#123;child2&#125; &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>會編譯為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOMRe.createElement(&quot;div&quot;, ~props=ReactDOMRe.props(~foo=bar, ()), [|child1, child2|]);</span><br></pre></td></tr></table></figure>
<p>Javascript 會編譯為</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(<span class="string">'div'</span>, &#123;<span class="attr">foo</span>: bar&#125;, child1, child2)</span><br></pre></td></tr></table></figure>
<p><code>prop-less</code> 範例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div /&gt;</span><br></pre></td></tr></table></figure>
<p>則會轉譯成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOMRe.createElement(&quot;div&quot;, [||]);</span><br></pre></td></tr></table></figure>
<p>實際的 Javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(<span class="string">'div'</span>, <span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure>
<p><strong>Note: <code>ReactDOMRe.createElement</code> 是內部轉譯 JSX 專用，也有提供逃生出口 <code>ReasonReact.createDomElement</code> 詳情閱讀 <a href="https://reasonml.github.io/reason-react/docs/en/children" target="_blank" rel="noopener">children section</a></strong></p>
<h2 id="Capitalized"><a href="#Capitalized" class="headerlink" title="Capitalized"></a>Capitalized</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyReasonComponent key=&#123;a&#125; ref=&#123;b&#125; foo=&#123;bar&#125; baz=&#123;qux&#125;&gt; &#123;child1&#125; &#123;child2&#125; &lt;/MyReasonComponent&gt;</span><br></pre></td></tr></table></figure>
<p>會轉譯為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ReasonReact.element(</span><br><span class="line">  ~key=a,</span><br><span class="line">  ~ref=b,</span><br><span class="line">  MyReasonComponent.make(~foo=bar, ~baz=qux, [|child1, child2|])</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>prop-less</code> <code>&lt;MyReasonComponent /&gt;</code> 則會轉譯成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReasonReact.element(MyReasonComponent.make([||]));</span><br></pre></td></tr></table></figure>
<p><code>MyReasonComponent.make</code> 中的 make 跟上一個部分講的 <code>make</code> 是一樣的</p>
<p>也要注意不要將 <code>ref</code> <code>key</code> 這類的保留自使用在 props</p>
<h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><p>在 ReasonReact 中也允許使用 Fragment</p>
<p>他可以簡化 DOM 結構</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&gt; child1 child2 &lt;/&gt;;</span><br></pre></td></tr></table></figure>
<p>將會轉意成為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOMRe.createElement(ReasonReact.fragment, [|child1, child2|]);</span><br></pre></td></tr></table></figure>
<p>Javascript 則會</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(React.Fragment, <span class="literal">undefined</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Children"><a href="#Children" class="headerlink" title="Children"></a>Children</h2><p>ReasonReact 中的 children 是有完整的類型</p>
<p>你可以傳遞任何型態的值給它</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyReasonComponent&gt; &lt;div /&gt; &lt;div /&gt; &lt;/MyReasonComponent&gt;</span><br><span class="line"></span><br><span class="line">let let theChildren = [| &lt;div /&gt;, &lt;div /&gt; |];</span><br><span class="line">&lt;MyReasonComponent&gt; theChildren &lt;/MyReasonComponent&gt;</span><br></pre></td></tr></table></figure>
<p>上面兩個範例都會轉譯為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let theChildren = [| &lt;div /&gt;, &lt;div /&gt; |];</span><br><span class="line">ReasonReact.element(</span><br><span class="line">  MyReasonComponent.make([|theChildren|])</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Reason 中的 children 也可以使用 spread</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let theChildren = [| &lt;div /&gt;, &lt;div /&gt; |];</span><br><span class="line">&lt;MyReasonComponent&gt; ...theChildren &lt;/MyReasonComponent&gt;</span><br></pre></td></tr></table></figure>
<p>詳情可以參閱 <a href="https://reasonml.github.io/docs/en/jsx.html#children-spread" target="_blank" rel="noopener">children spread syntax</a></p>
<p>更詳細的 Children 後續會再做了解</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReasonReact-Helloworld" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/04/ReasonReact-Helloworld/" class="article-date">
      <time datetime="2018-11-04T04:39:42.000Z" itemprop="datePublished">2018-11-04</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/04/ReasonReact-Helloworld/">ReasonReact-Helloworld</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><p>這部分和 Reason 一樣</p>
<p>只是提供了一個 react theme</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install </span>-g <span class="keyword">bs-platform</span></span><br><span class="line"><span class="keyword">$ </span><span class="keyword">bsb </span>-init reason-react-demo -theme react</span><br><span class="line">$ cd reason-react-demo &amp;&amp; npm <span class="keyword">install </span>&amp;&amp; npm start</span><br></pre></td></tr></table></figure>
<p><code>npm start</code> 僅僅是將 <code>.re</code> 編譯為 <code>.js</code></p>
<p>我們還需要使用 <code>npm run webpack</code> 作打包的動作</p>
<p>另外要再開一個 <code>web-develop-server</code></p>
<p>所以另外也還要再開一個 <code>npm run server</code></p>
<p>這些指令在初始化的時候就會產生</p>
<p>工程師都是懶惰的</p>
<p>所以現在要利用 <code>concurrently</code> 來幫我們簡化一下</p>
<h2 id="concurrently"><a href="#concurrently" class="headerlink" title="concurrently"></a>concurrently</h2><p>這個套件可以一行指令一次執行多個 process</p>
<p>使用上也很方便</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span> -g concurrently</span><br></pre></td></tr></table></figure>
<p><em>command</em></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ concurrently -n reason,webpack,<span class="keyword">server</span> <span class="string">"yarn start"</span> <span class="string">"yarn webpack"</span>  <span class="string">"yarn server"</span></span><br></pre></td></tr></table></figure>
<p><em>package.json</em><br>需要使用 <code>\</code> 跳脫字元</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line">"dev": "concurrently -n reason,webpack,server \"yarn start\" \"yarn webpack\"  \"yarn server\"",</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">run</span><span class="bash"> dev</span></span><br></pre></td></tr></table></figure>
<h1 id="檔案結構"><a href="#檔案結構" class="headerlink" title="檔案結構"></a>檔案結構</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="selector-tag">README</span><span class="selector-class">.md</span></span><br><span class="line">├── <span class="selector-tag">bsconfig</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">lib</span></span><br><span class="line">│   └── <span class="selector-tag">bs</span></span><br><span class="line">│       ├── <span class="selector-tag">ReactTemplate</span><span class="selector-class">.cmi</span></span><br><span class="line">│       ├── <span class="selector-tag">ReactTemplate</span><span class="selector-class">.cmj</span></span><br><span class="line">│       ├── <span class="selector-tag">ReactTemplate</span><span class="selector-class">.cmt</span></span><br><span class="line">│       ├── <span class="selector-tag">ReactTemplate</span><span class="selector-class">.js</span></span><br><span class="line">│       ├── <span class="selector-tag">ReactTemplate</span><span class="selector-class">.mlmap</span></span><br><span class="line">│       ├── <span class="selector-tag">build</span><span class="selector-class">.ninja</span></span><br><span class="line">│       └── <span class="selector-tag">src</span></span><br><span class="line">│           ├── <span class="selector-tag">Component1-ReactTemplate</span><span class="selector-class">.cmi</span></span><br><span class="line">│           ├── <span class="selector-tag">Component1-ReactTemplate</span><span class="selector-class">.cmj</span></span><br><span class="line">│           ├── <span class="selector-tag">Component1-ReactTemplate</span><span class="selector-class">.cmt</span></span><br><span class="line">│           ├── <span class="selector-tag">Component1</span><span class="selector-class">.mlast</span></span><br><span class="line">│           ├── <span class="selector-tag">Component1</span><span class="selector-class">.mlast</span><span class="selector-class">.d</span></span><br><span class="line">│           ├── <span class="selector-tag">Component2-ReactTemplate</span><span class="selector-class">.cmi</span></span><br><span class="line">│           ├── <span class="selector-tag">Component2-ReactTemplate</span><span class="selector-class">.cmj</span></span><br><span class="line">│           ├── <span class="selector-tag">Component2-ReactTemplate</span><span class="selector-class">.cmt</span></span><br><span class="line">│           ├── <span class="selector-tag">Component2</span><span class="selector-class">.mlast</span></span><br><span class="line">│           ├── <span class="selector-tag">Component2</span><span class="selector-class">.mlast</span><span class="selector-class">.d</span></span><br><span class="line">│           ├── <span class="selector-tag">Index-ReactTemplate</span><span class="selector-class">.cmi</span></span><br><span class="line">│           ├── <span class="selector-tag">Index-ReactTemplate</span><span class="selector-class">.cmj</span></span><br><span class="line">│           ├── <span class="selector-tag">Index-ReactTemplate</span><span class="selector-class">.cmt</span></span><br><span class="line">│           ├── <span class="selector-tag">Index</span><span class="selector-class">.mlast</span></span><br><span class="line">│           └── <span class="selector-tag">Index</span><span class="selector-class">.mlast</span><span class="selector-class">.d</span></span><br><span class="line">├── <span class="selector-tag">package-lock</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">package</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">src</span></span><br><span class="line">│   ├── <span class="selector-tag">Component1</span><span class="selector-class">.bs</span><span class="selector-class">.js</span></span><br><span class="line">│   ├── <span class="selector-tag">Component1</span><span class="selector-class">.re</span></span><br><span class="line">│   ├── <span class="selector-tag">Component2</span><span class="selector-class">.bs</span><span class="selector-class">.js</span></span><br><span class="line">│   ├── <span class="selector-tag">Component2</span><span class="selector-class">.re</span></span><br><span class="line">│   ├── <span class="selector-tag">Index</span><span class="selector-class">.bs</span><span class="selector-class">.js</span></span><br><span class="line">│   ├── <span class="selector-tag">Index</span><span class="selector-class">.re</span></span><br><span class="line">│   └── <span class="selector-tag">index</span><span class="selector-class">.html</span></span><br><span class="line">└── <span class="selector-tag">webpack</span><span class="selector-class">.config</span><span class="selector-class">.js</span></span><br></pre></td></tr></table></figure>
<p><code>lib</code> 裡面放的是  BuckleScript 的檔案</p>
<p>這部分之後再做研究</p>
<p><code>src</code> 中放的是 <code>.re</code> 檔案 以及編譯過後的 <code>.js</code> 檔案</p>
<p><code>webpackconfig.js</code> 就是 webpack 的設定檔案</p>
<p>他會以 <code>index.bs.js</code> 為進入點</p>
<p>所以第一次要先編譯之後產生這個檔案再跑 webpack 才不會出錯</p>
<p><code>src</code> 中主要有四個檔案 <code>index.html</code> <code>Index.re</code> <code>Component1.re</code> <code>Component2.re</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>ReasonReact Examples<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  Component 1:</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"index1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  Component 2:</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"index2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"Index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>這邊有一個比較特別的地方</p>
<p>以前使用 create-react-app 建立出來的都只會有一個 <code>&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</code></p>
<p>會以這個為最外層的 div</p>
<p>其他的 Component 都在這個 div 之下做 render</p>
<p>這個範例一開始建立了兩個 <code>div</code></p>
<p>各自 render <code>Component1</code> 和 <code>Component2</code></p>
<p>或許這之後會解釋這樣的實作有和優劣？</p>
<p>還是只是範例而已</p>
<p><em>Component1.re</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/* This is the basic component. */</span><br><span class="line">let component = ReasonReact.statelessComponent(&quot;Page&quot;);</span><br><span class="line"></span><br><span class="line">/* Your familiar handleClick from ReactJS. This mandatorily takes the payload,</span><br><span class="line">   then the `self` record, which contains state (none here), `handle`, `reduce`</span><br><span class="line">   and other utilities */</span><br><span class="line">let handleClick = (_event, _self) =&gt; Js.log(&quot;clicked!&quot;);</span><br><span class="line"></span><br><span class="line">/* `make` is the function that mandatorily takes `children` (if you want to use</span><br><span class="line">   `JSX). `message` is a named argument, which simulates ReactJS props. Usage:</span><br><span class="line"></span><br><span class="line">   `&lt;Page message=&quot;hello&quot; /&gt;`</span><br><span class="line"></span><br><span class="line">   Which desugars to</span><br><span class="line"></span><br><span class="line">   `ReasonReact.element(Page.make(~message=&quot;hello&quot;, [||]))` */</span><br><span class="line">let make = (~message, _children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  render: self =&gt;</span><br><span class="line">    &lt;div onClick=(self.handle(handleClick))&gt;</span><br><span class="line">      (ReasonReact.string(message))</span><br><span class="line">    &lt;/div&gt;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>Component1.re</code> 很簡單</p>
<p>先將原始的 Compoennt assign 之後做解構</p>
<p>但是在綁定 Event 就比較特別的是</p>
<p>先寫了一個 <code>function handleClick</code></p>
<p>在 <code>div</code> 的 <code>onClick</code> 去 trigger</p>
<p>使用的方式是 <code>onClick=(self.handle(handleClick))</code></p>
<p>變數部分也改用 <code>()</code> 而不是以前 React 使用的 <code>{}</code></p>
<p>看到這邊其實跟之前的 React 會有一些不同</p>
<p>先做一些調整</p>
<p><strong>src/index.html</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>ReasonReact Examples<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"Index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>App.re</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let component = ReasonReact.statelessComponent(&quot;App&quot;);</span><br><span class="line"></span><br><span class="line">let make = (_children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  render: (_) =&gt;</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      (ReasonReact.string(&quot;Component1:&quot;))</span><br><span class="line">      &lt;Component1 message=&quot;Hello!&quot; /&gt;</span><br><span class="line">      (ReasonReact.string(&quot;Component2:&quot;))</span><br><span class="line">      &lt;Component2 greeting=&quot;Hello!&quot; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="Hot-Reload"><a href="#Hot-Reload" class="headerlink" title="Hot Reload"></a>Hot Reload</h2><p>這時候會發現當我們更新了程式碼之後還是不會自動 Reload</p>
<p>還是有點麻煩</p>
<p>其實只要稍微調整一下 <code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> outputDir = path.join(__dirname, <span class="string">'build/'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.env.NODE_ENV === <span class="string">'production'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./src/Index.bs.js'</span>,</span><br><span class="line">  mode: isProd ? <span class="string">'production'</span> : <span class="string">'development'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: outputDir,</span><br><span class="line">    publicPath: outputDir,</span><br><span class="line">    filename: <span class="string">'Index.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'src/index.html'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    contentBase: outputDir,</span><br><span class="line">    port: process.env.PORT || <span class="number">8000</span>,</span><br><span class="line">    historyApiFallback: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>這樣就完成囉!</p>
<p>Have fun!</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason-Create-NPM-Package-PartII" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/02/Reason-Create-NPM-Package-PartII/" class="article-date">
      <time datetime="2018-11-02T13:21:54.000Z" itemprop="datePublished">2018-11-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/02/Reason-Create-NPM-Package-PartII/">Reason-Create-NPM-Package-PartII</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="建立-Semver-的類別"><a href="#建立-Semver-的類別" class="headerlink" title="建立 Semver 的類別"></a>建立 Semver 的類別</h1><p>semver 在 Javascript 可以使用 <code>new</code> 關鍵字來產生物件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> semver(<span class="string">"1.5.0"</span>);</span><br><span class="line">s.minor(); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<p>在 Reason 中可以使用 class type 來綁定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class type semverInstance =</span><br><span class="line">[@bs]</span><br><span class="line">&#123;</span><br><span class="line">  pub version: string;</span><br><span class="line">  pub major: int;</span><br><span class="line">  pub minor: int;</span><br><span class="line">  pub patch: int;</span><br><span class="line">  pub raw: string;</span><br><span class="line">  pub build: array(string);</span><br><span class="line">  pub prerelease: array(string)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type tSemver = Js.t(semverInstance);</span><br></pre></td></tr></table></figure>
<p>完成了這一步先回想一下如何發布 NPM 的套件</p>
<h2 id="發布-NPM-套件"><a href="#發布-NPM-套件" class="headerlink" title="發布 NPM 套件"></a>發布 NPM 套件</h2><p><a href="https://docs.npmjs.com/getting-started/publishing-npm-packages" target="_blank" rel="noopener">document</a></p>
<p>將寫完的 Reason 檔案透過上面的步驟就可以推到 NPM 上面</p>
<h3 id="使用-NPM-上的-bs-express-套件"><a href="#使用-NPM-上的-bs-express-套件" class="headerlink" title="使用 NPM 上的 bs-express 套件"></a>使用 NPM 上的 bs-express 套件</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install bs-<span class="built_in">express</span> <span class="built_in">express</span></span><br></pre></td></tr></table></figure>
<p><em>bsconfig.json</em></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"bs-dependencies": [</span><br><span class="line">  <span class="string">"bs-express"</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p><em>Demo.re</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">open Express;</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">let onListen = e =&gt;</span><br><span class="line">  switch (e) &#123;</span><br><span class="line">  | exception (Js.Exn.Error(e)) =&gt;</span><br><span class="line">    Js.log(e);</span><br><span class="line">    Node.Process.exit(1);</span><br><span class="line">  | _ =&gt; Js.log @@ &quot;Listening at http://127.0.0.1:3000&quot;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  App.get(app, ~path=&quot;/&quot;) @@</span><br><span class="line">Middleware.from((next, req,) =&gt; &#123;</span><br><span class="line">  Response.sendString(&quot;Hello world&quot;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let server = App.listen(app, ~port=3000, ~onListen, ());</span><br></pre></td></tr></table></figure></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span> <span class="title">src</span>/Demo.bs.js</span><br></pre></td></tr></table></figure>
<p><a href="http://localhost:3000/" target="_blank" rel="noopener">Demo Url</a></p>
<p>你就可以看到 Hello World!</p>
<p>終於串起 Reason 和 NPM 的部分</p>
<p>接下來是怎麼處理 使用 Reason 讓 Javascript 使用呢？</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason-Create-NPM-Package-PartI" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/02/Reason-Create-NPM-Package-PartI/" class="article-date">
      <time datetime="2018-11-02T00:47:49.000Z" itemprop="datePublished">2018-11-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/02/Reason-Create-NPM-Package-PartI/">Reason Create NPM Package Part-I</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="使用-semver"><a href="#使用-semver" class="headerlink" title="使用 semver"></a>使用 semver</h1><p>和之前一樣先寫一個 javascript 的版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> semver = <span class="built_in">require</span>(<span class="string">'semver'</span>);</span><br><span class="line"></span><br><span class="line">semver.valid(<span class="string">'1.2.3'</span>);</span><br><span class="line"></span><br><span class="line">semver.valid(<span class="string">'a.b.c'</span>);</span><br><span class="line"></span><br><span class="line">semver.clean(<span class="string">'  =v1.2.3   '</span>);</span><br><span class="line"></span><br><span class="line">semver.satisfies(<span class="string">'1.2.3'</span>, <span class="string">'1.x || &gt;=2.5.0 || 5.0.0 - 7.2.3'</span>);</span><br></pre></td></tr></table></figure>
<p>如果要在 Reason 中使用 <code>semver</code> 的話</p>
<p>如何寫一個 <code>interface</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;semver&quot;] [@bs.val] </span><br><span class="line">external clean: string =&gt; Js.nullable(string) = &quot;clean&quot;;</span><br><span class="line"></span><br><span class="line">let clean = a =&gt; clean(a) |&gt; Js.Nullable.toOption;</span><br></pre></td></tr></table></figure>
<p>之前其實就有聊過這部分</p>
<p><code>Js.nullable(string)</code> 也一種寫法代表是 Javascript 帶過來的值</p>
<p>意思是 <code>string</code> 但是也有可能是 <code>null</code> 得值</p>
<h2 id="Jext-test"><a href="#Jext-test" class="headerlink" title="Jext test"></a>Jext test</h2><p>寫完之後來驗證一下你的型態</p>
<p>所以需要安裝一下 <a href="https://github.com/glennsl/bs-jest" target="_blank" rel="noopener">bs-jest</a></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">npm</span> install --save-dev @glennsl/bs-jest</span><br></pre></td></tr></table></figure>
<p>建立一個 <code>__tests__/semver_spec.re</code></p>
<p><code>bsconfig.json</code> 也要做一些調整</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is the configuration file used by BuckleScript's build system bsb. Its documentation lives here: http://bucklescript.github.io/bucklescript/docson/#build-schema.json</span></span><br><span class="line"><span class="comment">// BuckleScript comes with its own parser for bsconfig.json, which is normal JSON, with the extra support of comments and trailing commas.</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"package-name"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">  <span class="attr">"sources"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"dir"</span> : <span class="string">"src"</span>,</span><br><span class="line">      <span class="attr">"subdirs"</span> : <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"dir"</span>: <span class="string">"__tests__"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"dev"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"package-specs"</span>: &#123;</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="attr">"in-source"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"suffix"</span>: <span class="string">".bs.js"</span>,</span><br><span class="line">  <span class="attr">"bs-dev-dependencies"</span>: [</span><br><span class="line">    <span class="string">"@glennsl/bs-jest"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"warnings"</span>: &#123;</span><br><span class="line">    <span class="attr">"error"</span> : <span class="string">"+101"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"namespace"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"refmt"</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要是要加上 <code>sources</code> 和 <code>bs-dev-dependencies</code></p>
<p>先寫個簡單的測試</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">open Jest;</span><br><span class="line"></span><br><span class="line">describe(&quot;Expect&quot;, () =&gt; &#123;</span><br><span class="line">  open Expect;</span><br><span class="line">  test(&quot;toBe&quot;, () =&gt; </span><br><span class="line">    expect(1 + 2) |&gt; toBe(3)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe(&quot;Expect.Operators&quot;, () =&gt; &#123;</span><br><span class="line">  open Expect;</span><br><span class="line">  open! Expect.Operators;</span><br><span class="line">  test(&quot;==&quot;, () =&gt; expect(1+2) === 3);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可以看到上例</p>
<p>也可以測試從外部引入的套件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">open Jest;</span><br><span class="line"></span><br><span class="line">let () = describe(&quot;semver&quot;,</span><br><span class="line">  ExpectJs.(() =&gt; &#123;</span><br><span class="line">      test(&quot;#clean&quot;, () =&gt;</span><br><span class="line">        expect(Semver.clean(&quot;    =1.5.0    &quot;)</span><br><span class="line">          |&gt; (result =&gt; switch (result) &#123;</span><br><span class="line">              | Some(v) =&gt; v</span><br><span class="line">              | None =&gt; raise(Not_found)</span><br><span class="line">              &#125;</span><br><span class="line">          ),</span><br><span class="line">        )</span><br><span class="line">        |&gt; toBe(&quot;1.5.0&quot;)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/glennsl/bs-jest/tree/master/__tests__" target="_blank" rel="noopener">更多範例</a></p>
<p>在 <code>package.json</code> 中加入 <code>files</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"files": [   </span><br><span class="line">  "src/semver.re", </span><br><span class="line">  <span class="string">"bsconfig.json"</span></span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>
<p>可以讓 <code>NPM</code> 知道需要哪些檔案</p>
<p>也必須讓 <code>NPM</code> 知道這個套件和 <code>servem</code> 有依賴關係</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"peerDependencies": &#123;"semver": "^5.5.0"&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="開始寫綁定檔案"><a href="#開始寫綁定檔案" class="headerlink" title="開始寫綁定檔案"></a>開始寫綁定檔案</h2><p><em>src/semver.re</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;semver&quot;] [@bs.val]</span><br><span class="line">external clean: string =&gt; Js.nullable(string) = &quot;&quot;;</span><br><span class="line">let clean = a =&gt; clean(a) |&gt; Js.Nullable.toOption;</span><br></pre></td></tr></table></figure>
<p>簡單吧！</p>
<p>可以自己再補齊其他的 <a href="https://github.com/npm/node-semver" target="_blank" rel="noopener">API</a></p>
<h2 id="Enums-of-String"><a href="#Enums-of-String" class="headerlink" title="Enums of String"></a>Enums of String</h2><p><code>semver.cmp</code> 需要丟入三個參數</p>
<p>先寫一個簡單的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;semver&quot;] [@bs.val]</span><br><span class="line">external cmp: (string, string, string) =&gt; bool = &quot;&quot;;</span><br></pre></td></tr></table></figure>
<p>但是第二個參數因為是 <code>operations</code> 所以只能允許 <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>==</code>, <code>!==</code> 這類的字串</p>
<p>如果想要更精確的描述的話</p>
<p>我們需要對第二個參數做更完整的定義</p>
<p>在 Javascript 中會是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Semver.cmp(<span class="string">"1.5.0"</span>, <span class="string">"&lt;"</span>, <span class="string">"2.3.5"</span>);</span><br></pre></td></tr></table></figure>
<p>所以需要針對這個變數宣告一個類型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">type comparator = </span><br><span class="line">  | LooseEqual</span><br><span class="line">  | LooseNotEqual</span><br><span class="line">  | Equal</span><br><span class="line">  | Empty</span><br><span class="line">  | NotEqual</span><br><span class="line">  | Gt</span><br><span class="line">  | Gte</span><br><span class="line">  | Lt</span><br><span class="line">  | Lte;</span><br><span class="line"></span><br><span class="line">let comparatorToString = comparator: string =&gt;</span><br><span class="line">  switch (comparator) &#123;</span><br><span class="line">  | LooseEqual =&gt; &quot;==&quot;</span><br><span class="line">  | LooseNotEqual =&gt; &quot;!==&quot;</span><br><span class="line">  | Equal =&gt; &quot;===&quot;</span><br><span class="line">  | Empty =&gt; &quot;&quot;</span><br><span class="line">  | NotEqual =&gt; &quot;!==&quot;</span><br><span class="line">  | Gt =&gt; &quot;&gt;&quot;</span><br><span class="line">  | Gte =&gt; &quot;&gt;=&quot;</span><br><span class="line">  | Lt =&gt; &quot;&lt;&quot;</span><br><span class="line">  | Lte =&gt; &quot;&lt;=&quot;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">[@bs.module &quot;semver&quot;] [@bs.val]</span><br><span class="line">external cmp: (string, string, string) =&gt; bool = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">let cmp = (a: string, c: comparator, b: string) =&gt;</span><br><span class="line">  cmp(a, c |&gt; comparatorToString, b);</span><br></pre></td></tr></table></figure>
<p>可以看到我們宣告了一個類型給第二個參數</p>
<p>再藉由 Fast Pipe 輸入參數時做檢查</p>
<p>達到 <code>Enums</code> 的需求</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-BuckleScript-Function" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/29/BuckleScript-Function/" class="article-date">
      <time datetime="2018-10-29T14:15:50.000Z" itemprop="datePublished">2018-10-29</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/29/BuckleScript-Function/">BuckleScript-Function</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="MongoDB-的-CRUD"><a href="#MongoDB-的-CRUD" class="headerlink" title="MongoDB 的 CRUD"></a>MongoDB 的 CRUD</h1><p>昨天我們引入了 <code>mongoDB</code> 今天來整理一下寫一個 <code>module</code></p>
<p>按照慣例先來一個 <code>Javascript</code> 版本</p>
<p><code>src/mongoManager/index.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MongoClient = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient;</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'mongodb://localhost:27017'</span>;</span><br><span class="line"><span class="keyword">const</span> dbName = <span class="string">'myproject'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mongoDBManagerClass</span> </span>&#123;</span><br><span class="line">  initialDB(&#123;url, dbName&#125;)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      MongoClient.connect(url, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;, (err, client) =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>._client = client;</span><br><span class="line">        <span class="keyword">this</span>._db = client.db(dbName);</span><br><span class="line">        <span class="keyword">this</span>._document = <span class="keyword">this</span>._db.collection(<span class="string">'documents'</span>);</span><br><span class="line">        resolve();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  insertManyDocument(array) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>._document.insertMany(array,(error, result) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(error) reject(error);</span><br><span class="line">        <span class="keyword">else</span> resolve(result);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  closeClient() &#123;</span><br><span class="line">    <span class="keyword">this</span>._client.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoDBManager = <span class="keyword">new</span> mongoDBManagerClass(&#123;url, dbName&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoDBManager;</span><br></pre></td></tr></table></figure></p>
<p><code>src/app.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">'./routes/usersRoutes'</span>);</span><br><span class="line"><span class="keyword">const</span> mongoDBManager = <span class="built_in">require</span>(<span class="string">'./mongodbManager'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'mongodb://localhost:27017'</span>;</span><br><span class="line"><span class="keyword">const</span> dbName = <span class="string">'myproject'</span>;</span><br><span class="line"></span><br><span class="line">mongoDBManager</span><br><span class="line">  .initialDB(&#123;url, dbName&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mongoDBManager.insertManyDocument([&#123;<span class="attr">a</span> : <span class="number">1</span>&#125;])</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> mongoDBManager.closeClient());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">5000</span>;</span><br><span class="line">app.use(<span class="string">'/user'</span>, userRouter);</span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; res.send(<span class="string">'Hello World!'</span>));</span><br><span class="line">app.listen(port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>!`</span>));</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Express-MongoDB-PartII" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/28/Express-MongoDB-PartII/" class="article-date">
      <time datetime="2018-10-28T15:00:07.000Z" itemprop="datePublished">2018-10-28</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/28/Express-MongoDB-PartII/">Express-MongoDB-PartII</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>在準備 <code>MongoDBManager</code> 的時候遇到兩個蠻大的問題</p>
<p>今天先補上這兩個部分的筆記</p>
<ul>
<li>Promise</li>
<li>Pipe</li>
</ul>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>callback 在之前就有範例了</p>
<p>但是如何在 Reason 中實作 <code>Promise</code> 呢？</p>
<p>我們知道 <code>Promise</code> 最常用的是 <code>resolve</code> <code>then</code> 和 <code>catch</code></p>
<p>這部分 <a href="https://bucklescript.github.io/bucklescript/api/Js.Promise.html" target="_blank" rel="noopener">BuckleScript</a> 已經有實作支援</p>
<ul>
<li>Js.Promise.resolve: ‘a =&gt; Js.Promise.t(‘a)</li>
<li>Js.Promise.then_: (‘a =&gt; Js.Promise.t(‘b), Js.Promise.t(‘a)) =&gt; Js.Promise.t(‘b)</li>
<li>Js.Promise.catch: (Js.Promise.error =&gt; Js.Promise.t(‘a), Js.Promise.t(‘a)) =&gt; Js.Promise.t(‘a)</li>
</ul>
<p>但是這只是表示了 JS 中 Reason 的型態</p>
<p>在 Reason 中新增一個 <code>Promise</code> 其實 BuckleScript 也有提供建立的方法</p>
<ul>
<li>Js.Promise.make: ( ( ~resolve: (. ‘a) =&gt; unit, ~reject: (. exn) =&gt; unit ) =&gt; unit ) =&gt; Js.Promise.t(‘a)</li>
</ul>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let myPromise = Js.Promise.make((~resolve, ~reject) =&gt; resolve(. 2));</span><br><span class="line">myPromise</span><br><span class="line">|&gt; Js.Promise.then_(value =&gt; &#123;</span><br><span class="line">  Js.log(value);</span><br><span class="line">  Js.Promise.resolve(value + 2);</span><br><span class="line">&#125;)</span><br><span class="line">|&gt; Js.Promise.then_(value =&gt; &#123;</span><br><span class="line">  Js.log(value);</span><br><span class="line">  Js.Promise.resolve(value + 3);</span><br><span class="line">&#125;)</span><br><span class="line">|&gt; Js.Promise.catch(err =&gt; &#123;</span><br><span class="line">  Js.log2(&quot;Failure!!&quot;, err);</span><br><span class="line">  Js.Promise.resolve(-2);</span><br><span class="line">&#125;);</span><br><span class="line">/*</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>我們要如何寫一個 <code>function</code> 裡面包含 <code>Promise</code> 呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sleep = <span class="function">(<span class="params">ms = <span class="number">1000</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'wake up'</span>), ms);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[@bs.val] external setTimeout: (unit =&gt; unit, int) =&gt; unit = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">let sleep = (ms: int) =&gt; </span><br><span class="line">  Js.Promise.make((~resolve, ~reject) =&gt;</span><br><span class="line">    setTimeout(() =&gt; resolve(. () =&gt; Js.log(&quot;wake up&quot;)), ms));</span><br></pre></td></tr></table></figure>
<p>那麼上方的範例也可以更改為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">let addTwoPromise = (value: int) =&gt; </span><br><span class="line">  Js.Promise.make((~resolve, ~reject) =&gt; &#123;</span><br><span class="line">    Js.log(value);</span><br><span class="line">    resolve(. value + 2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">let addThreePromise = (value: int) =&gt;</span><br><span class="line">  Js.Promise.make((~resolve, ~reject) =&gt; &#123;</span><br><span class="line">    Js.log(value);</span><br><span class="line">    resolve(. value + 3);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">let errorHandler = (error) =&gt;</span><br><span class="line">  Js.Promise.make((~resolve, ~reject) =&gt; &#123;</span><br><span class="line">    Js.log2(&quot;Failure!!&quot;, error);</span><br><span class="line">    resolve(. -2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">myPromise</span><br><span class="line">|&gt; Js.Promise.then_(addTwoPromise)</span><br><span class="line">|&gt; Js.Promise.then_(addThreePromise)</span><br><span class="line">|&gt; Js.Promise.catch(errorHandler);</span><br></pre></td></tr></table></figure>
<p>因為我們準備做一個 <code>MongoDBModule</code></p>
<p>所以也要試試在 module 中實作 <code>Promise method</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">module MyPromiseModule &#123;</span><br><span class="line">  let value = 2;</span><br><span class="line"></span><br><span class="line">  let myPromise = Js.Promise.make((~resolve, ~reject) =&gt; resolve(. value));</span><br><span class="line"></span><br><span class="line">  let addTwoPromise = (value) =&gt; </span><br><span class="line">  Js.Promise.make((~resolve, ~reject) =&gt; &#123;</span><br><span class="line">    Js.log(value);</span><br><span class="line">    resolve(. value + 2);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  let addThreePromise = (value) =&gt;</span><br><span class="line">  Js.Promise.make((~resolve, ~reject) =&gt; &#123;</span><br><span class="line">    Js.log(value);</span><br><span class="line">    resolve(. value + 3);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  let errorHandler = (error) =&gt;</span><br><span class="line">  Js.Promise.make((~resolve, ~reject) =&gt; &#123;</span><br><span class="line">    Js.log2(&quot;Failure!!&quot;, error);</span><br><span class="line">    resolve(. -2);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyPromiseModule.myPromise</span><br><span class="line">|&gt; Js.Promise.then_(MyPromiseModule.addTwoPromise)</span><br><span class="line">|&gt; Js.Promise.then_(MyPromiseModule.addThreePromise)</span><br><span class="line">|&gt; Js.Promise.catch(MyPromiseModule.errorHandler);</span><br></pre></td></tr></table></figure>
<h2 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h2><p>其實上面已經有使用 <code>Pipe</code></p>
<p>在這裡補充一下</p>
<p><code>-&gt;</code> 是 Reason 提供的運算子</p>
<p>可以幫助將 <code>b(a)</code> 轉換為 <code>b-&gt;a</code></p>
<p><code>validateAge(getAge(parseData(person)))</code></p>
<p>這個 function 其實有點難以閱讀</p>
<p>但是經過 <code>-&gt;</code> 運算子之後</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person</span><br><span class="line">  -&gt;parseData</span><br><span class="line">  -&gt;getAge</span><br><span class="line">  -&gt;validateAge</span><br></pre></td></tr></table></figure>
<p>可以很清楚地瞭解他的脈絡順序</p>
<p><code>a(one, two, three)</code> 也可以寫為 <code>one-&gt;a(two, three)</code></p>
<p>還有一些 function chain 的延伸</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Express-MongoDB" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/27/Express-MongoDB/" class="article-date">
      <time datetime="2018-10-27T11:53:39.000Z" itemprop="datePublished">2018-10-27</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/27/Express-MongoDB/">Express-MongoDB</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><p>之前有提過如何使用 <code>NPM</code> 上的 package</p>
<p>今天來試試看串接一下 <code>MongoDB</code></p>
<p>做最簡單的 <code>CRUD</code></p>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span> mongodb</span><br></pre></td></tr></table></figure>
<h3 id="Nodejs-version"><a href="#Nodejs-version" class="headerlink" title="Nodejs version"></a>Nodejs version</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">'./routes/usersRoutes'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MongoClient = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient;</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'mongodb://localhost:27017'</span>;</span><br><span class="line"><span class="keyword">const</span> dbName = <span class="string">'myproject'</span>;</span><br><span class="line"></span><br><span class="line">MongoClient.connect(url, <span class="function"><span class="keyword">function</span>(<span class="params">err, client</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> db = client.db(dbName);</span><br><span class="line">  <span class="keyword">const</span> collection = db.collection(<span class="string">'documents'</span>);</span><br><span class="line">  collection.insertMany([</span><br><span class="line">    &#123;<span class="attr">a</span> : <span class="number">1</span>&#125;, &#123;<span class="attr">a</span> : <span class="number">2</span>&#125;, &#123;<span class="attr">a</span> : <span class="number">3</span>&#125;</span><br><span class="line">  ], <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Inserted 3 documents into the collection"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">  &#125;);</span><br><span class="line">  client.close();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/user'</span>, userRouter);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; res.send(<span class="string">'Hello World!'</span>));</span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>!`</span>));</span><br></pre></td></tr></table></figure>
<p>可以看到在 <code>mongodb</code> 中有一個 <code>MongoClient</code> 他還有一個 <code>connect</code> 的 function</p>
<p><code>connect</code> 有兩個參數 <code>(string, (err, client) =&gt; unit)</code></p>
<p>以此類推</p>
<p>轉譯成 Reason</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">/* 在上面的範例中  `require` 了一個 `express` 他是一個函式 它會回傳一個 `app` 的物件</span><br><span class="line">然和對 `app` 的這個物件 有使用到兩個函式</span><br><span class="line">`listen` 和 `get`</span><br><span class="line">listen 會丟入一個參數(int)</span><br><span class="line">get 會丟入兩個參數(string, function)</span><br><span class="line">而在 get 中丟入的 function 會有兩個物件 `req`, `res`</span><br><span class="line">因為只有使用到 `res.send`</span><br><span class="line">大致上我們可以先宣告剛剛有提到函式 和參數的類型 */</span><br><span class="line">type res = &#123;.</span><br><span class="line">  [@bs.meth] &quot;send&quot;: string =&gt; string</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">type nextFun = unit =&gt; string;</span><br><span class="line">type handler = (string, res, nextFun) =&gt; string;</span><br><span class="line"></span><br><span class="line">type expressApp = &#123;.</span><br><span class="line">  [@bs.meth] &quot;use&quot;: handler =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;listen&quot;: (int) =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler, handler) =&gt; string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type router = &#123;.</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler) =&gt; string,</span><br><span class="line">  [@bs.meth] &quot;use&quot;: handler =&gt; unit</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type dbErrorType = Js.t(&#123;. message: string &#125;);</span><br><span class="line">type jsObjectType = &#123;. &#125;;</span><br><span class="line">type insertManyResultType = &#123;. &#125;;</span><br><span class="line">type insertRespType = (dbErrorType, insertManyResultType) =&gt; unit;</span><br><span class="line">type collectionType = &#123;.</span><br><span class="line">  [@bs.meth] &quot;insertMany&quot;: (array(&#123;. &quot;a&quot;: int&#125;), insertRespType) =&gt; unit</span><br><span class="line">&#125;;</span><br><span class="line">type dbType = &#123;.</span><br><span class="line">  [@bs.meth] &quot;collection&quot;: (string) =&gt; collectionType</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type clientType = Js.t(&#123;.</span><br><span class="line">  [@bs.meth] db: string =&gt; dbType,</span><br><span class="line">  [@bs.meth] close: unit =&gt; unit</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">type mongoClientType = &#123;.</span><br><span class="line">  [@bs.meth] &quot;connect&quot;: (string, (dbErrorType, clientType) =&gt; unit) =&gt; unit</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.module] external express: unit =&gt; expressApp = &quot;express&quot;;</span><br><span class="line">[@bs.module &quot;mongodb&quot;] external mongoClient: mongoClientType = &quot;MongoClient&quot;;</span><br><span class="line">[@bs.module &quot;./routes/UserRoutes.bs&quot;] external userRoutes: router = &quot;routes&quot;;</span><br><span class="line"></span><br><span class="line">let url = &quot;mongodb://localhost:27017&quot;;</span><br><span class="line">let dbName = &quot;myproject&quot;;</span><br><span class="line">mongoClient##connect(url, (error, client) =&gt; &#123;</span><br><span class="line">  let db = client##db(dbName);</span><br><span class="line">  let collection = db##collection(&quot;documents&quot;);</span><br><span class="line"></span><br><span class="line">  let inputData = [|&#123;&quot;a&quot;: 1&#125;|];</span><br><span class="line"></span><br><span class="line">  collection##insertMany(inputData, (_, result) =&gt; &#123;</span><br><span class="line">    Js.log(&quot;Inserted 3 documents into the collection&quot;);</span><br><span class="line">    Js.log(result);</span><br><span class="line">  &#125;);</span><br><span class="line">  client##close();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">[@bs.val] external use: handler =&gt; unit = &quot;app.use&quot;;</span><br><span class="line">[@bs.val] external useWithString: (string, router) =&gt; unit = &quot;app.use&quot;;</span><br><span class="line"></span><br><span class="line">use((_, _, next) =&gt; &#123;</span><br><span class="line">  Js.log(&quot;here is use function&quot;);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">useWithString(&quot;/user&quot;, userRoutes);</span><br><span class="line"></span><br><span class="line">app##get(&quot;/&quot;, (_, _, next) =&gt; &#123;</span><br><span class="line">  Js.log(&quot;hello next&quot;);</span><br><span class="line">  next();</span><br><span class="line">&#125;, (_, res, _) =&gt; res##send(&quot;Hello World!&quot;));</span><br><span class="line"></span><br><span class="line">app##listen(5000);</span><br></pre></td></tr></table></figure>
<p>再重寫的時候會複習一下之前討論過的很多資料型態</p>
<p>發現不夠熟練</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let list1 = [0,1];</span><br><span class="line">let array1 = [|0, 1|];</span><br></pre></td></tr></table></figure>
<p>這兩種的轉譯結果會是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list1 = <span class="comment">/* :: */</span>[</span><br><span class="line">  <span class="number">0</span>,</span><br><span class="line">  <span class="comment">/* :: */</span>[</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="comment">/* [] */</span><span class="number">0</span></span><br><span class="line">  ]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> array1 = <span class="comment">/* array */</span>[</span><br><span class="line">  <span class="number">0</span>,</span><br><span class="line">  <span class="number">1</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>可以看到這兩個的結果和原本預計的會有所不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type obj2Type = Js.t(&#123;</span><br><span class="line">  .</span><br><span class="line">  a: string</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let obj1: &#123;. &quot;a&quot;: string&#125; = &#123;&quot;a&quot;: &quot;a&quot;&#125;;</span><br><span class="line">let obj2 = &#123;&quot;a&quot;: &quot;a&quot;, &quot;b&quot;: &quot;b&quot;&#125;;</span><br></pre></td></tr></table></figure>
<p>上述的範例中 <code>obj1</code> 如果不定長度的話會引起錯誤</p>
<p><code>obj2</code> 可以是任意長度 (Json)</p>
<p>轉譯結果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  a: <span class="string">"a"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  a: <span class="string">"a"</span>,</span><br><span class="line">  b: <span class="string">"b"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Express-Middleware" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/27/Express-Middleware/" class="article-date">
      <time datetime="2018-10-27T10:11:28.000Z" itemprop="datePublished">2018-10-27</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/27/Express-Middleware/">Express-Middleware</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h1><p>昨天有用 Reason 寫出了一個 <code>helloworld</code></p>
<p>今天來增加一些東西</p>
<ul>
<li>use</li>
<li>Route<ul>
<li>Middleware</li>
<li>多個 Middleware</li>
</ul>
</li>
<li>Json</li>
</ul>
<h2 id="use"><a href="#use" class="headerlink" title="use"></a>use</h2><p><code>Express</code> 的 middleware 有兩種形式</p>
<p>一種是 <code>app.use</code></p>
<p>他的 input 是 <code>handler</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">/* 在上面的範例中  `require` 了一個 `express` 他是一個函式 它會回傳一個 `app` 的物件</span><br><span class="line">然和對 `app` 的這個物件 有使用到兩個函式</span><br><span class="line">`listen` 和 `get`</span><br><span class="line">listen 會丟入一個參數(int)</span><br><span class="line">get 會丟入兩個參數(string, function)</span><br><span class="line">而在 get 中丟入的 function 會有兩個物件 `req`, `res`</span><br><span class="line">因為只有使用到 `res.send`</span><br><span class="line">大致上我們可以先宣告剛剛有提到函式 和參數的類型 */</span><br><span class="line">type res = &#123;.</span><br><span class="line">  [@bs.meth] &quot;send&quot;: string =&gt; string</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">type nextFun = unit =&gt; string;</span><br><span class="line">type handler = (string, res, nextFun) =&gt; string;</span><br><span class="line"></span><br><span class="line">type expressApp = &#123;.</span><br><span class="line">  [@bs.meth] &quot;use&quot;: handler =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;listen&quot;: (int) =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler, handler) =&gt; string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.module] external express: unit =&gt; expressApp = &quot;express&quot;;</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">app##use((_, _, next) =&gt; &#123;</span><br><span class="line">  Js.log(&quot;here is use function&quot;);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app##get(&quot;/&quot;, (_, _, next) =&gt; &#123;</span><br><span class="line">  Js.log(&quot;hello next&quot;);</span><br><span class="line">  next();</span><br><span class="line">&#125;, (_, res, _) =&gt; res##send(&quot;Hello World!&quot;));</span><br><span class="line"></span><br><span class="line">app##listen(3000);</span><br></pre></td></tr></table></figure>
<p>當你打開瀏覽器 <code>http://localhost:3000</code> 之後 </p>
<p>終端機會顯示 </p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">here <span class="keyword">is</span> <span class="keyword">use</span> <span class="keyword">function</span></span><br><span class="line">hello next</span><br></pre></td></tr></table></figure>
<p>這樣就完成了 use 的使用</p>
<p>簡單吧!</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason-BasicType-Module" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/27/Reason-BasicType-Module/" class="article-date">
      <time datetime="2018-10-27T10:11:14.000Z" itemprop="datePublished">2018-10-27</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/27/Reason-BasicType-Module/">Reason-BasicType-Module</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h1><p>模組就像是一個小的檔案</p>
<p>可以用 <code>let binding</code> 內嵌 module</p>
<h2 id="建立"><a href="#建立" class="headerlink" title="建立"></a>建立</h2><p>使用 <code>module</code> 這個關鍵字來宣告</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module School = &#123;</span><br><span class="line">  type profession = Teacher | Director;</span><br><span class="line"></span><br><span class="line">  let person1 = Teacher;</span><br><span class="line">  let getProfession = (person) =&gt;</span><br><span class="line">    switch(person) &#123;</span><br><span class="line">    | Teacher =&gt; &quot;A teacher&quot;</span><br><span class="line">    | Director =&gt; &quot;A director&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>模組中的值(包含型別) 可以像 <code>record</code> 一樣使用 <code>.</code> 來存取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module School = &#123;</span><br><span class="line">  type profession = Teacher | Director;</span><br><span class="line"></span><br><span class="line">  let person1 = Teacher;</span><br><span class="line">  let getProfession = (person) =&gt;</span><br><span class="line">    switch(person) &#123;</span><br><span class="line">    | Teacher =&gt; &quot;A teacher&quot;</span><br><span class="line">    | Director =&gt; &quot;A director&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let anotherPerson: School.profession = School.Teacher;</span><br><span class="line">print_endline(School.getProfession(anotherPerson));</span><br></pre></td></tr></table></figure>
<p>上面的範例中使用了 <code>School.profession</code> 的類型來宣告變數</p>
<p>巢狀的 <code>module</code> 也是一樣的使用方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module Mymodule = &#123;</span><br><span class="line">  module NestedModule = &#123;</span><br><span class="line">    let message = &quot;Hello&quot;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let message =  Mymodule.NestedModule.message;</span><br><span class="line">print_endline(message);</span><br></pre></td></tr></table></figure>
<h2 id="open-Module"><a href="#open-Module" class="headerlink" title="open Module"></a>open Module</h2><p>要一直前置加上模組名稱會很繁瑣</p>
<p>所以可以利用 <code>open</code> 來簡化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/* let p: School.profession = School.getProfession(School.person1); */</span><br><span class="line">/*上述程式碼可以修改為*/</span><br><span class="line">open School;</span><br><span class="line">let p: profession = getProfession(person1);</span><br></pre></td></tr></table></figure>
<p><strong>note: 要謹慎使用 open 最好在 local scope 中使用，否則會很難了解變數來源</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let p = &#123;</span><br><span class="line">  open School;</span><br><span class="line">  print_endline(&quot;hello!&quot;);</span><br><span class="line">  getProfession(person1);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="擴充模組"><a href="#擴充模組" class="headerlink" title="擴充模組"></a>擴充模組</h2><p>使用 <code>include</code> 讓 module 靜態擴展到另一個新的模組</p>
<p>這句話很難理解吧！</p>
<p>看個範例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module BaseComponent = &#123;</span><br><span class="line">  let defaultGreeting = &quot;Hello&quot;;</span><br><span class="line">  let getAudience = (~excited) =&gt; excited ? &quot;hello&quot; : &quot;world&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module ActualComponent = &#123;</span><br><span class="line">  include BaseComponent;</span><br><span class="line">  let defaultGreeting = &quot;Hey&quot;;</span><br><span class="line">  let render = () =&gt; defaultGreeting ++ &quot; &quot; ++ getAudience(~excited=true);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">print_endline(BaseComponent.defaultGreeting); /* Hello */</span><br><span class="line">print_endline(ActualComponent.defaultGreeting); /* Hey */</span><br></pre></td></tr></table></figure>
<p>上述範例中 <code>ActualComponent</code> 因為有 <code>include BaseComponent;</code></p>
<p>所以會擁有 <code>BaseComponent</code> 的特性和方法</p>
<p>但是也可以在下面使用 <code>let</code> 來複寫某些參數或方法</p>
<p><strong>note: <code>open</code> 和 <code>include</code>是完全不一樣的 前者是將內容帶到你的 scope 你就不用每次都要加上模組名稱來取值，後者則是複製一份值到新的模組內</strong></p>
<p>在 <code>Reason</code> 中每一個檔案都是一個模組</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*FileA.re*/</span><br><span class="line">let a = 1;</span><br><span class="line">let b = 2;</span><br><span class="line"></span><br><span class="line">/*FileB.re*/</span><br><span class="line">include FileA;</span><br><span class="line">print_endline(a);</span><br></pre></td></tr></table></figure>
<h3 id="標記式"><a href="#標記式" class="headerlink" title="標記式"></a>標記式</h3><p>模組的類型稱為 <code>signature</code></p>
<p>模組的實作是 <code>re</code> 模組的宣告是 <code>rei</code></p>
<p>要建立一個 signature 要使用關鍵字 <code>module type</code></p>
<p>signature 名稱必須是大寫字母開頭</p>
<p>可以放置在 <code>rei</code> 檔案內</p>
<p>可以放在定義的 <code>{}</code> scope 內</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">module type EstablishmentType = &#123;</span><br><span class="line">  type profession;</span><br><span class="line">  let getProfession: profession =&gt; string;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>signature 宣告了 module 必須滿足的型態要求</p>
<p>使 module 和 signature 相同</p>
<p>形式如下:</p>
<ul>
<li><code>let x: int;</code> 要求 <code>let</code> 繫結名稱必須是 <code>x</code>，型別是 <code>int</code></li>
<li><code>type t = someType;</code> 要求型別欄位 <code>t</code> 必須與 <code>someType</code> 相同</li>
<li><code>type t;</code> 要求型別欄位 <code>t</code>，但並不強迫任何要求於 t 的實際、具體型別。 我們不能在標記式內使用 <code>t</code> 於其他項目來描述關係，例如 <code>let makePair: t =&gt; (t, t)</code> </li>
</ul>
<p>上述 <code>EstablishmentType</code> 範例中</p>
<ul>
<li>宣告一個類型 <code>profession</code></li>
<li>必須要有一個函式來取得 <code>profession</code> 的值</li>
</ul>
<h3 id="擴展-Module-類型"><a href="#擴展-Module-類型" class="headerlink" title="擴展 Module 類型"></a>擴展 Module 類型</h3><p>就像 Module 一樣</p>
<p>可以利用 include 來做擴展 module type</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module type BaseComponent = &#123;</span><br><span class="line">  let defaultGreeting: string;</span><br><span class="line">  let getAudience: (~excited: bool) =&gt; string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module type ActualComponent = &#123;</span><br><span class="line">  /* the BaseComponent signature is copied over */</span><br><span class="line">  include BaseComponent;</span><br><span class="line">  let render: unit =&gt; string;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>note: BaseComponent是 module type 而不是 module</strong></p>
<p>如果你沒有宣告 module type</p>
<p>可以透過實際的 module 來提取 <code>include (module type of ActualModuleName)</code></p>
<p>例如我們可以繼承 OCmal 中的公用模組 <code>List</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">module type MyList = &#123;</span><br><span class="line">  include (module type of List);</span><br><span class="line">  let myListFun: list(&apos;a) =&gt; list(&apos;a);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="每個-rei-都是一個標記式"><a href="#每個-rei-都是一個標記式" class="headerlink" title="每個 rei 都是一個標記式"></a>每個 <code>rei</code> 都是一個標記式</h3><p>類似 <code>.re</code> 定義 Reason 模組</p>
<p><code>rei</code> 定義 Reason 模組類型</p>
<p>React.re 的標記式預設是暴露所有模組內欄位</p>
<p>因為沒有包含實作檔案</p>
<p><code>.rei</code> 在生態圈也用來作為相對應模組的文件</p>
<p>紀錄開放的 API</p>
<p><code>Module.re</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type state = int;</span><br><span class="line">let render = (str) =&gt; str;</span><br></pre></td></tr></table></figure></p>
<p><code>Module.rei</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type state = int;</span><br><span class="line">let render: string =&gt; string;</span><br></pre></td></tr></table></figure></p>
<h3 id="模組函式-functors"><a href="#模組函式-functors" class="headerlink" title="模組函式(functors)"></a>模組函式(functors)</h3><p>模組可以包含函式</p>
<p>就像在檔案裡面寫函式</p>
<p>但是這還是有些不一樣</p>
<p>因為 module 定義在不同層級</p>
<p>所以我們稱之為 <code>functors</code></p>
<ul>
<li>functors 使用關鍵字 <code>module</code> 而不是 <code>let</code></li>
<li>Functors 接受一個或多個模組作為參數並傳回一個模組</li>
<li>Functors 必須大寫字母開頭（就像是模組/標記式）</li>
<li>Functors 必須註解參數</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">module type Comparable = &#123;</span><br><span class="line">  type t;</span><br><span class="line">  let equal: (t, t) =&gt; bool;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module MakeSet = (Item: Comparable) =&gt; &#123;</span><br><span class="line">  /* let&apos;s use a list as our naive backing data structure */</span><br><span class="line">  type backingType = list(Item.t);</span><br><span class="line">  let empty = [];</span><br><span class="line">  let add = (currentSet: backingType, newItem: Item.t) : backingType =&gt;</span><br><span class="line">    if (ListLabels.exists((x) =&gt; Item.equal(x, newItem), currentSet)) &#123;</span><br><span class="line">      currentSet;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      [</span><br><span class="line">        newItem,</span><br><span class="line">        ...currentSet /* prepend to the set and return it */</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上述是一個 <code>MakeSet</code> Functor</p>
<p>他接受一個 <code>Comparable</code> 類型的 module</p>
<p>會回傳一個包含此類型的新集合</p>
<p>Functor 也可以和函式一樣使用參數</p>
<p>如下例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">module type Comparable = &#123;</span><br><span class="line">  type t;</span><br><span class="line">  let equal: (t, t) =&gt; bool;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module MakeSet = (Item: Comparable) =&gt; &#123;</span><br><span class="line">  /* let&apos;s use a list as our naive backing data structure */</span><br><span class="line">  type backingType = list(Item.t);</span><br><span class="line">  let empty = [];</span><br><span class="line">  let add = (currentSet: backingType, newItem: Item.t) : backingType =&gt;</span><br><span class="line">    if (ListLabels.exists((x) =&gt; Item.equal(x, newItem), currentSet)) &#123;</span><br><span class="line">      currentSet;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      [</span><br><span class="line">        newItem,</span><br><span class="line">        ...currentSet /* prepend to the set and return it */</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">module IntPair = &#123;</span><br><span class="line">  type t = (int, int);</span><br><span class="line">  let equal = ((x1, y1), (x2, y2)) =&gt; x1 == x2 &amp;&amp; y1 == y2;</span><br><span class="line">  let create = (x, y) =&gt; (x, y);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module SetOfIntPairs = MakeSet(IntPair);</span><br></pre></td></tr></table></figure>
<h3 id="模組函式類別"><a href="#模組函式類別" class="headerlink" title="模組函式類別"></a>模組函式類別</h3><p>Like with module types, functor types also act to constrain and hide what we may assume about functors. The syntax for functor types are consistent with those for function types, but with types capitalized to represent the signatures of modules the functor accepts as arguments and return values. In the previous example, we’re exposing the backing type of a set; by giving MakeSet a functor signature, we can hide the underlying data structure!</p>
<p><strong>未翻譯</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">module type Comparable = &#123;</span><br><span class="line">  type t;</span><br><span class="line">  let equal: (t, t) =&gt; bool;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module type MakeSetType = (Item: Comparable) =&gt; &#123;</span><br><span class="line">  type backingType;</span><br><span class="line">  let empty: backingType;</span><br><span class="line">  let add: (backingType, Item.t) =&gt; backingType;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module MakeSet: MakeSetType = (Item: Comparable) =&gt; &#123;</span><br><span class="line">  /* let&apos;s use a list as our naive backing data structure */</span><br><span class="line">  type backingType = list(Item.t);</span><br><span class="line">  let empty = [];</span><br><span class="line">  let add = (currentSet: backingType, newItem: Item.t) : backingType =&gt;</span><br><span class="line">    if (ListLabels.exists((x) =&gt; Item.equal(x, newItem), currentSet)) &#123;</span><br><span class="line">      currentSet;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      [</span><br><span class="line">        newItem,</span><br><span class="line">        ...currentSet /* prepend to the set and return it */</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module IntPair = &#123;</span><br><span class="line">  type t = (int, int);</span><br><span class="line">  let equal = ((x1, y1), (x2, y2)) =&gt; x1 == x2 &amp;&amp; y1 == y2;</span><br><span class="line">  let create = (x, y) =&gt; (x, y);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module SetOfIntPairs = MakeSet(IntPair);</span><br></pre></td></tr></table></figure>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>要小心的是 <code>module</code> 和 <code>functor</code> 在不同樣的語言層級</p>
<p>你無法輕易的將他們傳遞給 <code>record</code> 或 <code>tuple</code></p>
<p>真的不得已的話一定要小心</p>
<p>因為很多時候只需要一個 <code>record</code> 或是 <code>function</code> 就夠了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Express-Router" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/26/Express-Router/" class="article-date">
      <time datetime="2018-10-26T13:39:20.000Z" itemprop="datePublished">2018-10-26</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/26/Express-Router/">Express-Router</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h1><p>在上一篇中提到了 <code>Middleware</code></p>
<p>今天會討論到更多細節的部分</p>
<p>但是第一步要先了解關於 <code>Router</code></p>
<p>Express 可以拿來寫 <code>RESTful API</code></p>
<p>但是 <code>route</code> 要如何分類呢？</p>
<p>雖然之前已經有用 <code>app.get</code> 來做基本的 <code>route</code></p>
<p>但是如果大量使用的話其實會造成程式碼的雜亂跟難以維護</p>
<p>所以 Express 中有一個 <code>Router</code> 的 funciton </p>
<p>可以產出一個 Router 物件</p>
<p>然後再藉由 <code>app.use</code> 來做 route 的實現和管理</p>
<p>基本上可以這樣分類</p>
<p><strong>分類方式沒有絕對答案</strong></p>
<p><em>routes/userRoutes.js</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">'/'</span>, (req, res, _) =&gt; &#123;</span><br><span class="line">  res.json(&#123;<span class="attr">name</span>: <span class="string">'tomas'</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p><em>app.js</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">'./routes/usersRoutes'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/user'</span>, userRouter);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; res.send(<span class="string">'Hello World!'</span>));</span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>!`</span>));</span><br></pre></td></tr></table></figure>
<p>這時候如果我們用 <code>POST</code> 呼叫 <code>http://localhost:5000/user</code></p>
<p>得到的 respnose 會是 <code>{&quot;name&quot;: &quot;tomas&quot;}</code></p>
<p>我想這部分應該沒什麼問題</p>
<p>然後我們按照之前的模式把這些程式碼改為 <code>.re</code></p>
<p><em>routes/UserRoutes.re</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">type response = &#123;. &quot;name&quot;: string &#125;;</span><br><span class="line">type res = &#123;.</span><br><span class="line">  [@bs.meth] &quot;send&quot;: string =&gt; string,</span><br><span class="line">  [@bs.meth] &quot;json&quot;: response =&gt; string</span><br><span class="line"> &#125;;</span><br><span class="line">type nextFun = unit =&gt; string;</span><br><span class="line">type handler = (string, res, nextFun) =&gt; string;</span><br><span class="line"></span><br><span class="line">type router = &#123;.</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler) =&gt; string,</span><br><span class="line">  [@bs.meth] &quot;use&quot;: handler =&gt; unit</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.module &quot;express&quot;] external router: unit =&gt; router = &quot;Router&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let routes = router();</span><br><span class="line"></span><br><span class="line">routes##get(&quot;/&quot;, (_, res, _) =&gt; &#123;</span><br><span class="line">  let resp = &#123;&quot;name&quot;: &quot;tomas&quot;&#125;;</span><br><span class="line">  res##json(resp);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">type res = &#123;.</span><br><span class="line">  [@bs.meth] &quot;send&quot;: string =&gt; string</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">type nextFun = unit =&gt; string;</span><br><span class="line">type handler = (string, res, nextFun) =&gt; string;</span><br><span class="line"></span><br><span class="line">type expressApp = &#123;.</span><br><span class="line">  [@bs.meth] &quot;use&quot;: handler =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;listen&quot;: (int) =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler, handler) =&gt; string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type router = &#123;.</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler) =&gt; string,</span><br><span class="line">  [@bs.meth] &quot;use&quot;: handler =&gt; unit</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.module] external express: unit =&gt; expressApp = &quot;express&quot;;</span><br><span class="line">[@bs.module &quot;./routes/UserRoutes.bs&quot;] external userRoutes: router = &quot;routes&quot;;</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">[@bs.val] external use: handler =&gt; unit = &quot;app.use&quot;;</span><br><span class="line">[@bs.val] external useWithString: (string, router) =&gt; unit = &quot;app.use&quot;;</span><br><span class="line"></span><br><span class="line">use((_, _, next) =&gt; &#123;</span><br><span class="line">  Js.log(&quot;here is use function&quot;);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">useWithString(&quot;/user&quot;, userRoutes);</span><br><span class="line"></span><br><span class="line">app##get(&quot;/&quot;, (_, _, next) =&gt; &#123;</span><br><span class="line">  Js.log(&quot;hello next&quot;);</span><br><span class="line">  next();</span><br><span class="line">&#125;, (_, res, _) =&gt; res##send(&quot;Hello World!&quot;));</span><br><span class="line"></span><br><span class="line">app##listen(5000);</span><br></pre></td></tr></table></figure>
<p>首先遇到幾個問題</p>
<ul>
<li>一個是如何 <code>require</code> 正確的 <code>routes/UserRoutes.bs</code> 中的 <code>routes</code>?<ul>
<li>延伸怎麼控制 export ? 只能用 Reason 預設的？</li>
</ul>
</li>
<li>app.use 有兩種 input 格式 如何處理?</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;./routes/UserRoutes.bs&quot;] external userRoutes: router = &quot;routes&quot;;</span><br></pre></td></tr></table></figure>
<p>第一個問題基本上上述那一行就可以解決</p>
<h3 id="Import-And-Export"><a href="#Import-And-Export" class="headerlink" title="Import And Export"></a>Import And Export</h3><p>之前有提過如何引用共用模組</p>
<p>今天來談談本地的模組引用問題</p>
<p>在 <code>Reason</code> 中如何控制 <code>export</code> 呢？</p>
<p>BuckleScript 支援</p>
<ul>
<li>CommonJS (require(‘MyFile’))</li>
<li>ES6 modules (import myFile from ‘MyFile’)</li>
<li>AMD(define([‘myFile’], …)</li>
</ul>
<p>預設的 <code>let</code> 綁定的值都會自動 <code>export</code></p>
<p>所以其他檔案都可以使用</p>
<h4 id="Export-ES6-value"><a href="#Export-ES6-value" class="headerlink" title="Export ES6 value"></a>Export ES6 value</h4><p>example:</p>
<p><em>student.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> name = <span class="string">"Al"</span>;</span><br></pre></td></tr></table></figure></p>
<p><em>teacher.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> studentName <span class="keyword">from</span> <span class="string">'student.js'</span>;</span><br></pre></td></tr></table></figure></p>
<p>在 Reason 中只需要用 <code>let</code> 綁定 default 這個變數</p>
<p>就可以自動輸出 ES6 預設模組</p>
<p><em>FavoriteStudent.ml</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let default = &quot;default value&quot;;</span><br></pre></td></tr></table></figure></p>
<p><em>demo.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> studentName <span class="keyword">from</span> <span class="string">'FavoriteStudent.js'</span>;</span><br></pre></td></tr></table></figure></p>
<h4 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h4><p>使用 <a href="mailto:`@bs.module" target="_blank" rel="noopener">`@bs.module</a>`</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;path&quot;] external dirname : string =&gt; string = &quot;dirname&quot;;</span><br><span class="line">let root = dirname(&quot;/User/chenglou&quot;);</span><br></pre></td></tr></table></figure>
<p>output<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">var</span> root = Path.dirname(<span class="string">"/User/chenglou"</span>);</span><br></pre></td></tr></table></figure></p>
<h4 id="Import-Default-value"><a href="#Import-Default-value" class="headerlink" title="Import Default value"></a>Import Default value</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module] external leftPad : string =&gt; int =&gt; string = &quot;./leftPad&quot;;</span><br><span class="line">let paddedResult = leftPad(&quot;hi&quot;, 5);</span><br></pre></td></tr></table></figure>
<p>output</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LeftPad = <span class="built_in">require</span>(<span class="string">"./leftPad"</span>);</span><br><span class="line"><span class="keyword">var</span> paddedResult = LeftPad(<span class="string">"hi"</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Import-an-ES6-Default-value"><a href="#Import-an-ES6-Default-value" class="headerlink" title="Import an ES6 Default value"></a>Import an ES6 Default value</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;./student&quot;] external studentName : string = &quot;default&quot;;</span><br><span class="line">Js.log(studentName);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Student = <span class="built_in">require</span>(<span class="string">"./student"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(Student.default);</span><br></pre></td></tr></table></figure>
<p>當你在 BuckleScript 端使用的名稱和 JS 名稱相匹配</p>
<p>你可以使用空字串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;path&quot;] external dirname : string =&gt; string = &quot;&quot;;</span><br></pre></td></tr></table></figure>
<h3 id="相同的-Function-不同的參數"><a href="#相同的-Function-不同的參數" class="headerlink" title="相同的 Function 不同的參數"></a>相同的 Function 不同的參數</h3><p>我們可以看到 <code>app.use</code> 和 <code>router.use</code> 中有兩種不同的輸入值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/user'</span>, userRouter);</span><br></pre></td></tr></table></figure>
<p>如上例可以看到 相同的 <code>app.use</code> 卻有兩種不同的輸入值得型態</p>
<p>在強形態中不能將這種 視為同樣的一個 function</p>
<p>所以要將它分為兩種 function 型態</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type handler = (string, res, nextFun) =&gt; string;</span><br><span class="line">type router = &#123;.</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler) =&gt; string,</span><br><span class="line">  [@bs.meth] &quot;use&quot;: handler =&gt; unit</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.val] external use: handler =&gt; unit = &quot;app.use&quot;;</span><br><span class="line">[@bs.val] external useWithString: (string, router) =&gt; unit = &quot;app.use&quot;;</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>use</code> 的 參數是放入一個 <code>handler</code> 的類型</p>
<p>而另一個 <code>useWithString</code> 也是 <code>app.use</code></p>
<p>但是參數的類型是另外的 <code>(string, router) =&gt; unit</code></p>
<p>第一個參數是字串 第二個是 <code>router</code> 的類型</p>
<p>裡面有一個  <code>get</code> 和 <code>use</code> 的 method</p>
<p>當然若是要實現 <code>RESTful API</code> 要再增加 <code>post</code>, <code>put</code>, <code>delete</code>….</p>
<p>不過方式也都一樣</p>
<p>也就不贅述了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2024 Tomas Lin
            </div>
            <!-- <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div> -->
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>