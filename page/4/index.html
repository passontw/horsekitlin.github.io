<!DOCTYPE html>
<html lang="zh-tw">
<head><meta name="generator" content="Hexo 3.9.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Tomas Lin">


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="湯瑪士的部落格">
<meta property="og:url" content="https://horsekitlin.github.io/page/4/index.html">
<meta property="og:site_name" content="湯瑪士的部落格">
<meta property="og:locale" content="zh-tw">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="湯瑪士的部落格">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="湯瑪士的部落格" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>湯瑪士的部落格</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Tomas Lin</a></h1>
        </hgroup>

        
        <p class="header-subtitle">技術手扎！不定期更新</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/archives/">主頁</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">標籤</a></li>
                        
                            <li><a href="/about/">關於我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:passon.com.tw@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/passontw" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css/">Css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DesignPatten/">DesignPatten</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FunctionPrograming/">FunctionPrograming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IThome2023/">IThome2023</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Leetcode/">Leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Material-design/">Material-design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MessageQueue/">MessageQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Microservies/">Microservies</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-Native/">React Native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reason/">Reason</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redux/">Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SocketCluster/">SocketCluster</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sodility/">Sodility</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Themes/">Themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translate/">Translate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Truffle/">Truffle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typescript/">Typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/">VSCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ithome-12/">ithome 12</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/">spring-boot</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Tomas Lin</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Tomas Lin</a></h1>
            </hgroup>
            
            <p class="header-subtitle">技術手扎！不定期更新</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">主頁</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">標籤</a></li>
                
                    <li><a href="/about/">關於我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:passon.com.tw@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/passontw" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-RN-JestInReactNative" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/01/08/RN-JestInReactNative/" class="article-date">
      <time datetime="2019-01-08T11:55:46.000Z" itemprop="datePublished">2019-01-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/08/RN-JestInReactNative/">RN-JestInReactNative</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Initial-project"><a href="#Initial-project" class="headerlink" title="Initial project"></a>Initial project</h1><p>我又重新來接觸一次 React Native</p>
<p>但是修改的部分太多了</p>
<p>重新做了一次部署架構</p>
<p>發現又多了一些問題</p>
<p>紀錄一下過程</p>
<p>一開始一定是先 initial project <code>helloworld</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ react-native init helloworld</span><br><span class="line">$ yarn test</span><br><span class="line">&gt; helloword@<span class="number">0.0</span><span class="number">.1</span> test <span class="regexp">/Users/</span>linweiqin<span class="regexp">/Projects/</span>helloword</span><br><span class="line">&gt; jest</span><br><span class="line"></span><br><span class="line">No tests found</span><br><span class="line">In <span class="regexp">/Users/</span>linweiqin<span class="regexp">/Projects/</span>helloword</span><br><span class="line">  <span class="number">645</span> files checked.</span><br><span class="line"><span class="symbol">  testMatch:</span> **<span class="regexp">/__tests__/</span>**<span class="comment">/*.js?(x),**/</span>?(*.)+(spec|test).js?(x) - 1 match</span><br><span class="line">  testPathIgnorePatterns: <span class="regexp">/node_modules/</span> - <span class="number">7</span> matches</span><br><span class="line"><span class="string">Pattern:</span>  - <span class="number">0</span> matches</span><br><span class="line">npm ERR! Test failed.  See above <span class="keyword">for</span> more details.</span><br></pre></td></tr></table></figure>
<p>因為我是使用 <code>redux-saga</code></p>
<p>所以建一個測試</p>
<p><strong>tests</strong>/saga.test.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; testSaga &#125; <span class="keyword">from</span> <span class="string">'redux-saga-test-plan'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; take, put, call&#125; <span class="keyword">from</span> <span class="string">"redux-saga/effects"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">mainSaga</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> action = <span class="keyword">yield</span> take(<span class="string">'HELLO'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span> put(&#123; <span class="attr">type</span>: <span class="string">'ADD'</span>, <span class="attr">payload</span>: x + y &#125;);</span><br><span class="line">  <span class="keyword">yield</span> call(identity, action);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> action = &#123; <span class="attr">type</span>: <span class="string">'TEST'</span> &#125;;</span><br><span class="line"></span><br><span class="line">it(<span class="string">'works with unit tests'</span>, () =&gt; &#123;</span><br><span class="line">  testSaga(mainSaga, <span class="number">40</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="comment">// advance saga with `next()`</span></span><br><span class="line">    .next()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert that the saga yields `take` with `'HELLO'` as type</span></span><br><span class="line">    .take(<span class="string">'HELLO'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// pass back in a value to a saga after it yields</span></span><br><span class="line">    .next(action)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert that the saga yields `put` with the expected action</span></span><br><span class="line">    .put(&#123; <span class="attr">type</span>: <span class="string">'ADD'</span>, <span class="attr">payload</span>: <span class="number">42</span> &#125;)</span><br><span class="line"></span><br><span class="line">    .next()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert that the saga yields a `call` to `identity` with</span></span><br><span class="line">    <span class="comment">// the `action` argument</span></span><br><span class="line">    .call(identity, action)</span><br><span class="line"></span><br><span class="line">    .next()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert that the saga is finished</span></span><br><span class="line">    .isDone();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ yarn <span class="keyword">add</span><span class="bash"> redux-saga</span></span><br><span class="line">$ yarn <span class="keyword">add</span><span class="bash"> -D redux-saga-test-plan</span></span><br><span class="line">$ yarn test</span><br></pre></td></tr></table></figure>
<p><img src="&#39;../images/rnjest/syntax_error.png&#39;" alt="error1"></p>
<p>在 <code>package.json</code> 要加上一個設定</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...,</span><br><span class="line">  "jest": &#123;</span><br><span class="line">    "preset": "react-native",</span><br><span class="line">    "transform": &#123;</span><br><span class="line">      "^.+\\.js$": "&lt;rootDir&gt;/node_modules/react-native/jest/preprocessor.js"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基本上這樣可以測試一般的</p>
<p>但是希望可以測試 Component</p>
<p>App.test.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// __tests__/App.test.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'../App'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> renderer <span class="keyword">from</span> <span class="string">'react-test-renderer'</span>;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'renders correctly'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> tree = renderer.create(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>).toJSON();</span><br><span class="line">  expect(tree).toMatchSnapshot();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="React-與-React-Native"><a href="#React-與-React-Native" class="headerlink" title="React 與 React Native"></a>React 與 React Native</h1><p>如果使用同一個架構的話 <code>React</code> 與 <code>React Native</code> 是大同小異的</p>
<p>但是基於兩個的底層是完全不同的</p>
<p>一個是 <code>Web HTML</code> 一個是 <code>Native code</code></p>
<p>希望使用盡量一致的 Lib 來做測試似乎困難度有點高</p>
<p>雖然尚未有完全無違和的測試</p>
<p>還是可以利用 <code>Jest</code> + <code>Enzyme</code> + <code>Jsdom</code> 來為 React Native 模擬 mount 環境</p>
<p>續前章 <a href="./RN-JestErrorWithRNRouterFlux.md">初步使用 Jest + Enzyme 做 React Native 測試</a></p>
<p>如果要在 測試中使用 <code>mount</code> 的話</p>
<p>會顯示 <code>document is undefined</code> 的錯誤</p>
<p>所以為了彌補這個問題</p>
<p>我們需要做一些補充</p>
<h1 id="shallow-and-mount-的不同"><a href="#shallow-and-mount-的不同" class="headerlink" title="shallow and mount 的不同"></a>shallow and mount 的不同</h1><h2 id="shallow"><a href="#shallow" class="headerlink" title="shallow"></a>shallow</h2><p><code>shallow</code> 針對 Component 做單一的單元測試，並不會直接顯示他的 <code>Children Component</code></p>
<h2 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h2><p><code>mount</code> 會完整的 render 所有的 <code>Component</code> 包含他下層的所有 <code>Component</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'../App'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount, shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> renderer <span class="keyword">from</span> <span class="string">'react-test-renderer'</span>;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'renders correctly'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> tree = renderer.create(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>).toJSON();</span><br><span class="line">  expect(tree).toMatchSnapshot();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">test(<span class="string">'mount component'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = shallow(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="&#39;../images/rnjest/mount_error.png&#39;" alt="mount error"></p>
<p>會產生這個錯誤</p>
<p>因為找不到 global document</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn <span class="keyword">add</span><span class="bash"> enzyme jest-enzyme enzyme-adapter-react-16 enzyme-react-16-adapter-setup --dev</span></span><br></pre></td></tr></table></figure>
<p>需要再 <code>package.json</code> 中增加</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...,</span><br><span class="line">  "jest": &#123;</span><br><span class="line">    "preset": "react-native",</span><br><span class="line">    "setupTestFrameworkScriptFile": "./node_modules/jest-enzyme/lib/index.js",</span><br><span class="line">    "setupFiles": [</span><br><span class="line">      <span class="string">"enzyme-react-16-adapter-setup"</span></span><br><span class="line">    ],</span><br><span class="line">    "transform": &#123;</span><br><span class="line">      "^.+\\.js$": "&lt;rootDir&gt;/node_modules/react-native/jest/preprocessor.js"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="&#39;../images/rnjest/dom_error.png&#39;" alt="dom error"></p>
<p>缺少了 <code>react-dom</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn <span class="keyword">add</span><span class="bash"> react-dom --dev</span></span><br></pre></td></tr></table></figure>
<p>這時候就可以執行了</p>
<p>但是因為 <code>shallow</code> 只能 render 一層</p>
<p>如果要完整 render 的話要使用 <code>mount</code></p>
<p>但是這樣會造成因為找不到 global document</p>
<p>要先增加 <code>setupFile.js</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn <span class="keyword">add</span><span class="bash"> jsdom enzyme-adapter-react-16 react-native-mock-render --dev</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; JSDOM &#125; = <span class="built_in">require</span>(<span class="string">'jsdom'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jsdom = <span class="keyword">new</span> JSDOM();</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="built_in">window</span> &#125; = jsdom;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyProps</span>(<span class="params">src, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> props = <span class="built_in">Object</span>.getOwnPropertyNames(src)</span><br><span class="line">    .filter(<span class="function"><span class="params">prop</span> =&gt;</span> <span class="keyword">typeof</span> target[prop] === <span class="string">'undefined'</span>)</span><br><span class="line">    .map(<span class="function"><span class="params">prop</span> =&gt;</span> <span class="built_in">Object</span>.getOwnPropertyDescriptor(src, prop));</span><br><span class="line">  <span class="built_in">Object</span>.defineProperties(target, props);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">global.window = <span class="built_in">window</span>;</span><br><span class="line">global.document = <span class="built_in">window</span>.document;</span><br><span class="line">global.navigator = &#123;</span><br><span class="line">  userAgent: <span class="string">'node.js'</span>,</span><br><span class="line">&#125;;</span><br><span class="line">copyProps(<span class="built_in">window</span>, global);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Enzyme <span class="keyword">from</span> <span class="string">"enzyme"</span>;</span><br><span class="line"><span class="keyword">import</span> Adapter <span class="keyword">from</span> <span class="string">"enzyme-adapter-react-16"</span>;</span><br><span class="line"></span><br><span class="line">Enzyme.configure(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> Adapter() &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ignore React Web errors when using React Native</span></span><br><span class="line"><span class="built_in">console</span>.error = <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> message;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'react-native-mock-render/mock'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn <span class="built_in">remove</span> enzyme-react<span class="number">-16</span>-adapter-<span class="built_in">setup</span></span><br></pre></td></tr></table></figure>
<p>package.json 也要做一些調整</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...,</span><br><span class="line">  "jest": &#123;</span><br><span class="line">    "preset": "react-native",</span><br><span class="line">    "cacheDirectory": "./cache",</span><br><span class="line">    "coveragePathIgnorePatterns": [</span><br><span class="line">      <span class="string">"./app/utils/vendor"</span></span><br><span class="line">    ],</span><br><span class="line">    "coverageThreshold": &#123;</span><br><span class="line">      "global": &#123;</span><br><span class="line">        "statements": 80</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    "transformIgnorePatterns": [</span><br><span class="line">      <span class="string">"/node_modules/(?!react-native|react-clone-referenced-element|react-navigation)"</span></span><br><span class="line">    ],</span><br><span class="line">    "transform": &#123;</span><br><span class="line">      "^.+\\.js$": "&lt;rootDir&gt;/node_modules/react-native/jest/preprocessor.js"</span><br><span class="line">    &#125;,</span><br><span class="line">    "setupTestFrameworkScriptFile": "./setupFile.js"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="&#39;../images/rnjest/test_success.png&#39;" alt="test success"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/React-Native/">React Native</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React-Native/">React Native</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-RN-code-push" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/01/02/RN-code-push/" class="article-date">
      <time datetime="2019-01-02T03:06:03.000Z" itemprop="datePublished">2019-01-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/02/RN-code-push/">RN-code-push</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Initial-React-Native-App"><a href="#Initial-React-Native-App" class="headerlink" title="Initial React Native App"></a>Initial React Native App</h1><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx react-<span class="keyword">native</span> <span class="keyword">init</span> codepushdemo &amp;&amp; cd codepushdemo</span><br></pre></td></tr></table></figure>
<h1 id="Install-code-push"><a href="#Install-code-push" class="headerlink" title="Install code push"></a>Install code push</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install the CLI</span></span><br><span class="line">$ npm <span class="keyword">install</span> -g code-push-cli</span><br><span class="line">$ npm <span class="keyword">install</span> -g appcenter-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register for an account via github or email (if you have code-push account you could use **code-push login**)</span></span><br><span class="line">$ code-push <span class="keyword">register</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your app. We call it AwesomeApp.</span></span><br><span class="line">$ code-push app <span class="keyword">add</span> codepushdemo-ios ios react-<span class="keyword">native</span></span><br><span class="line">$ code-push app <span class="keyword">add</span> codepushdemo-android android react-<span class="keyword">native</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare app center</span></span><br><span class="line">$ yarn <span class="keyword">add</span> appcenter appcenter-analytics appcenter-crashes <span class="comment">--save-exact</span></span><br><span class="line"></span><br><span class="line">$ cd ios &amp;&amp; pod <span class="keyword">install</span> &amp;&amp; cd ..</span><br></pre></td></tr></table></figure>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">**Note:**</span><br><span class="line"></span><br><span class="line"><span class="keyword">link</span> 完之 IOS 會自動使用 Pod </span><br><span class="line"></span><br><span class="line">所以在 <span class="built_in">local</span> 端 Xcode 要開啟 <span class="string">`XXXXX.xcworkspace`</span> 才能正常開發</span><br></pre></td></tr></table></figure>
<h3 id="IOS"><a href="#IOS" class="headerlink" title="IOS"></a>IOS</h3><p><a href="https://github.com/microsoft/react-native-code-push#releasing-updates" target="_blank" rel="noopener">releasing-updates</a></p>
<h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><p><code>code-push</code> 官方只支援 <code>github</code> <code>bitbucket</code> 和 <code>microsoft devops</code> 三種版控</p>
<p>這次使用 <code>bitbucket</code> 做 Demo</p>
<p>要先在 bitbucket 建立一個新的 repo</p>
<h1 id="參考資料來源"><a href="#參考資料來源" class="headerlink" title="參考資料來源"></a>參考資料來源</h1><p><a href="https://medium.com/@rajanmaharjan/get-started-with-wonderful-technology-d838aafdc2d3" target="_blank" rel="noopener">Get started with ‘CodePush’ (React-Native)</a></p>
<p><a href="https://github.com/Microsoft/react-native-code-push/blob/master/docs/setup-ios.md" target="_blank" rel="noopener">IOS Setup</a></p>
<p><a href="https://github.com/Microsoft/react-native-code-push/blob/master/docs/setup-android.md" target="_blank" rel="noopener">Android Setup</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/React-Native/">React Native</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React-Native/">React Native</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-material-ui-themes" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/29/material-ui-themes/" class="article-date">
      <time datetime="2018-11-29T07:26:38.000Z" itemprop="datePublished">2018-11-29</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/29/material-ui-themes/">material-ui-themes</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="source"><a href="#source" class="headerlink" title="source"></a>source</h1><p><a href="https://material-ui.com/customization/themes/#palette" target="_blank" rel="noopener">material-ui themes</a></p>
<h1 id="Content"><a href="#Content" class="headerlink" title="Content"></a>Content</h1><h2 id="Palette"><a href="#Palette" class="headerlink" title="Palette"></a>Palette</h2><p>針對 Application  設定幾個基礎色</p>
<p>theme 中提供幾個 key 來設定基礎色</p>
<ul>
<li>primary - 主要的顏色</li>
<li>secondary - 次要的顏色</li>
<li>error - 顯示錯誤的時候的顏色</li>
</ul>
<h3 id="Custom-palette"><a href="#Custom-palette" class="headerlink" title="Custom palette"></a>Custom palette</h3><p>在 theme 有 <code>[palette.primary](https://material-ui.com/customization/default-theme/?expend-path=$.palette.primary)</code>, <code>[palette.secondary](https://material-ui.com/customization/default-theme/?expend-path=$.palette.secondary)</code>, <code>[palette.error](https://material-ui.com/customization/default-theme/?expend-path=$.palette.error)</code> 三個物件可以複寫</p>
<p>在上述三個物件中各有 <code>light</code>, <code>main</code>, <code>dark</code>, <code>contrastText</code> 四個參數可以提供修改</p>
<p>可以直接放入顏色的物件作設定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createMuiTheme &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"><span class="keyword">import</span> blue <span class="keyword">from</span> <span class="string">'@material-ui/core/colors/blue'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  palette: &#123;</span><br><span class="line">    primary: blue,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>也可以依據各個不同的狀況做設定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">palette: &#123;</span><br><span class="line">  primary: &#123;</span><br><span class="line">    light: palette.primary[<span class="number">300</span>],</span><br><span class="line">    main: palette.primary[<span class="number">500</span>],</span><br><span class="line">    dark: palette.primary[<span class="number">700</span>],</span><br><span class="line">    contrastText: getContrastText(palette.primary[<span class="number">500</span>]),</span><br><span class="line">  &#125;,</span><br><span class="line">  secondary: &#123;</span><br><span class="line">    light: palette.secondary.A200,</span><br><span class="line">    main: palette.secondary.A400,</span><br><span class="line">    dark: palette.secondary.A700,</span><br><span class="line">    contrastText: getContrastText(palette.secondary.A400),</span><br><span class="line">  &#125;,</span><br><span class="line">  error: &#123;</span><br><span class="line">    light: palette.error[<span class="number">300</span>],</span><br><span class="line">    main: palette.error[<span class="number">500</span>],</span><br><span class="line">    dark: palette.error[<span class="number">700</span>],</span><br><span class="line">    contrastText: getContrastText(palette.error[<span class="number">500</span>]),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>這個範例說明如何重新建立一個預設 palette </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createMuiTheme &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"><span class="keyword">import</span> indigo <span class="keyword">from</span> <span class="string">'@material-ui/core/colors/indigo'</span>;</span><br><span class="line"><span class="keyword">import</span> pink <span class="keyword">from</span> <span class="string">'@material-ui/core/colors/pink'</span>;</span><br><span class="line"><span class="keyword">import</span> red <span class="keyword">from</span> <span class="string">'@material-ui/core/colors/red'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// All the following keys are optional.</span></span><br><span class="line"><span class="comment">// We try our best to provide a great default value.</span></span><br><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  palette: &#123;</span><br><span class="line">    primary: indigo,</span><br><span class="line">    secondary: pink,</span><br><span class="line">    error: red,</span><br><span class="line">    <span class="comment">// 提供 getContrastText() 使用的值，最大化背景之間的對比度</span></span><br><span class="line">    contrastThreshold: <span class="number">3</span>,</span><br><span class="line">    <span class="comment">// E.g., shift from Red 500 to Red 300 or Red 700.</span></span><br><span class="line">    tonalOffset: <span class="number">0.2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>也可以客製化自己的顏色</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createMuiTheme &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  palette: &#123;</span><br><span class="line">    primary: &#123;</span><br><span class="line">      <span class="comment">// light: will be calculated from palette.primary.main,</span></span><br><span class="line">      main: <span class="string">'#ff4400'</span>,</span><br><span class="line">      <span class="comment">// dark: will be calculated from palette.primary.main,</span></span><br><span class="line">      <span class="comment">// contrastText: will be calculated to contrast with palette.primary.main</span></span><br><span class="line">    &#125;,</span><br><span class="line">    secondary: &#123;</span><br><span class="line">      light: <span class="string">'#0066ff'</span>,</span><br><span class="line">      main: <span class="string">'#0044ff'</span>,</span><br><span class="line">      <span class="comment">// dark: will be calculated from palette.secondary.main,</span></span><br><span class="line">      contrastText: <span class="string">'#ffcc00'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// error: will use the default color</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>也有提供 <a href="https://material-ui.com/style/color/#color-tool" target="_blank" rel="noopener">color tools</a></p>
<h3 id="Type-light-dark-theme"><a href="#Type-light-dark-theme" class="headerlink" title="Type(light/dark theme)"></a>Type(light/dark theme)</h3><p>你可以透過修改 <code>type</code> 改為 <code>dark</code> 來將佈景變暗</p>
<p>雖然只有改變一個參數</p>
<p>但是下述的 key 都會受到影響</p>
<ul>
<li>palette.text</li>
<li>palette.divider</li>
<li>palette.background</li>
<li>palette.action</li>
</ul>
<h3 id="Typography"><a href="#Typography" class="headerlink" title="Typography"></a>Typography</h3><p>一次太多字型 類型大小和 Style 會破壞 Layout</p>
<p>提供一組有限的 Style 來限制</p>
<p><code>Typography</code> 可以使用在任何的 component 中</p>
<p><a href="https://material-ui.com/style/typography/" target="_blank" rel="noopener">Typography section</a></p>
<h4 id="Font-family"><a href="#Font-family" class="headerlink" title="Font family"></a>Font family</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  typography: &#123;</span><br><span class="line">    <span class="comment">// Use the system font instead of the default Roboto font.</span></span><br><span class="line">    fontFamily: [</span><br><span class="line">      <span class="string">'-apple-system'</span>,</span><br><span class="line">      <span class="string">'BlinkMacSystemFont'</span>,</span><br><span class="line">      <span class="string">'"Segoe UI"'</span>,</span><br><span class="line">      <span class="string">'Roboto'</span>,</span><br><span class="line">      <span class="string">'"Helvetica Neue"'</span>,</span><br><span class="line">      <span class="string">'Arial'</span>,</span><br><span class="line">      <span class="string">'sans-serif'</span>,</span><br><span class="line">      <span class="string">'"Apple Color Emoji"'</span>,</span><br><span class="line">      <span class="string">'"Segoe UI Emoji"'</span>,</span><br><span class="line">      <span class="string">'"Segoe UI Symbol"'</span>,</span><br><span class="line">    ].join(<span class="string">','</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Material-UI 的字型大小預設使用 <code>rem</code> 但是他會依據 <code>&lt;html&gt;</code> 的預設字型大小改變</p>
<p>一般來說預設是 <code>16px</code> browser 沒有提供修改的方式</p>
<p>所以 <code>units</code> 提供一個方式來修改設定提升使用者體驗</p>
<p>修改 font-size 為 <code>12</code> 預設是 <code>14</code></p>
<h5 id="HTML-font-size"><a href="#HTML-font-size" class="headerlink" title="HTML font size"></a>HTML font size</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  typography: &#123;</span><br><span class="line">    <span class="comment">// In Japanese the characters are usually larger.</span></span><br><span class="line">    fontSize: <span class="number">12</span>,</span><br><span class="line">    htmlFontSize: <span class="number">10</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>瀏覽器計算字型大小是透過這個公式</p>
<p><img src="https://material-ui.com/static/images/font-size.gif" alt="calc font size"></p>
<h3 id="Custom-variables"><a href="#Custom-variables" class="headerlink" title="Custom variables"></a>Custom variables</h3><p>也可以透過 <code>styling solution</code> 來客製化你的 component</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Checkbox <span class="keyword">from</span> <span class="string">'@material-ui/core/Checkbox'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createMuiTheme, MuiThemeProvider, withStyles &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"><span class="keyword">import</span> orange <span class="keyword">from</span> <span class="string">'@material-ui/core/colors/orange'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> styles = <span class="function"><span class="params">theme</span> =&gt;</span> (&#123;</span><br><span class="line">  root: &#123;</span><br><span class="line">    color: theme.status.danger,</span><br><span class="line">    <span class="string">'&amp;$checked'</span>: &#123;</span><br><span class="line">      color: theme.status.danger,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  checked: &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> CustomCheckbox = <span class="function"><span class="params">props</span> =&gt;</span></span><br><span class="line">  &lt;Checkbox</span><br><span class="line">    defaultChecked</span><br><span class="line">    classes=&#123;&#123;</span><br><span class="line">      root: props.classes.root,</span><br><span class="line">      checked: props.classes.checked,</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  /&gt;</span><br><span class="line"></span><br><span class="line">CustomCheckbox = withStyles(styles)(CustomCheckbox);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  status: &#123;</span><br><span class="line">    danger: orange[<span class="number">500</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">StylingComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;MuiThemeProvider theme=&#123;theme&#125;&gt;</span><br><span class="line">      &lt;CustomCheckbox /&gt;</span><br><span class="line">    &lt;<span class="regexp">/MuiThemeProvider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default StylingComponent;</span></span><br></pre></td></tr></table></figure>
<h3 id="Customizing-all-instances-of-a-component-type"><a href="#Customizing-all-instances-of-a-component-type" class="headerlink" title="Customizing all instances of a component type"></a>Customizing all instances of a component type</h3><p>有時候要針對單一 Component 做設定的時候可以用 <code>overrides</code> 這個 keyword 來做複寫</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;MuiThemeProvider, createMuiTheme&#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;purple, green, blue&#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/colors'</span>;</span><br><span class="line"><span class="keyword">import</span> Example <span class="keyword">from</span> <span class="string">'./Example'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button, Typography &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core'</span>;</span><br><span class="line"><span class="keyword">import</span> ListItems <span class="keyword">from</span> <span class="string">'./ListItems'</span>;</span><br><span class="line"><span class="keyword">import</span> StylingComponent <span class="keyword">from</span> <span class="string">'./StylingComponent'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  overrides: &#123;</span><br><span class="line">    <span class="comment">// Name of the component ⚛️ / style sheet</span></span><br><span class="line">    MuiButton: &#123;</span><br><span class="line">      <span class="comment">// Name of the rule</span></span><br><span class="line">      root: &#123;</span><br><span class="line">        <span class="comment">// Some CSS</span></span><br><span class="line">        background: <span class="string">'linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)'</span>,</span><br><span class="line">        borderRadius: <span class="number">3</span>,</span><br><span class="line">        border: <span class="number">0</span>,</span><br><span class="line">        color: <span class="string">'white'</span>,</span><br><span class="line">        height: <span class="number">48</span>,</span><br><span class="line">        padding: <span class="string">'0 30px'</span>,</span><br><span class="line">        boxShadow: <span class="string">'0 3px 5px 2px rgba(255, 105, 135, .3)'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;MuiThemeProvider theme=&#123;theme&#125;&gt;</span><br><span class="line">        &lt;Button&gt;hello&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>MuiThemeProvider&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><p>也可以傳入 <code>properties</code> 使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;MuiThemeProvider, createMuiTheme&#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;purple, green, blue&#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/colors'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theme = createMuiTheme(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    <span class="comment">// Name of the component ⚛️</span></span><br><span class="line">    MuiButton: &#123;</span><br><span class="line">      <span class="comment">// The properties to apply</span></span><br><span class="line">      disableRipple: <span class="literal">true</span>, <span class="comment">// No more ripple, on the whole application 💣!</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;MuiThemeProvider theme=&#123;theme&#125;&gt;</span><br><span class="line">        &lt;Button&gt;hello&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>MuiThemeProvider&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>可以看到結果 ripple 會被 disabled</p>
<h3 id="Accessing-the-theme-in-a-component"><a href="#Accessing-the-theme-in-a-component" class="headerlink" title="Accessing the theme in a component"></a>Accessing the theme in a component</h3><p>有時候會希望在某些 Component 中使用 theme 的變數</p>
<p>這時候可以使用 <code>withTheme</code></p>
<p>範例如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> Typography <span class="keyword">from</span> <span class="string">'@material-ui/core/Typography'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withTheme &#125; <span class="keyword">from</span> <span class="string">'@material-ui/core/styles'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WithTheme</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; theme &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> primaryText = theme.palette.text.primary;</span><br><span class="line">  <span class="keyword">const</span> primaryColor = theme.palette.primary.main;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> styles = &#123;</span><br><span class="line">    primaryText: &#123;</span><br><span class="line">      backgroundColor: theme.palette.background.default,</span><br><span class="line">      padding: <span class="string">`<span class="subst">$&#123;theme.spacing.unit&#125;</span>px <span class="subst">$&#123;theme.spacing.unit * <span class="number">2</span>&#125;</span>px`</span>,</span><br><span class="line">      color: primaryText,</span><br><span class="line">    &#125;,</span><br><span class="line">    primaryColor: &#123;</span><br><span class="line">      backgroundColor: primaryColor,</span><br><span class="line">      padding: <span class="string">`<span class="subst">$&#123;theme.spacing.unit&#125;</span>px <span class="subst">$&#123;theme.spacing.unit * <span class="number">2</span>&#125;</span>px`</span>,</span><br><span class="line">      color: theme.palette.common.white,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div style=&#123;&#123; <span class="attr">width</span>: <span class="number">300</span> &#125;&#125;&gt;</span><br><span class="line">      &lt;Typography style=&#123;styles.primaryColor&#125;&gt;&#123;<span class="string">`Primary color <span class="subst">$&#123;primaryColor&#125;</span>`</span>&#125;&lt;<span class="regexp">/Typography&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Typography style=&#123;styles.primaryText&#125;&gt;&#123;`Primary text $&#123;primaryText&#125;`&#125;&lt;/</span>Typography&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">WithTheme.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  theme: PropTypes.object.isRequired,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withTheme()(WithTheme); /</span><span class="regexp">/ Let's get the theme as a property</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Css/">Css</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Css/">Css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Material-design/">Material-design</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Themes/">Themes</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReasonReact-lifeCycle" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/13/ReasonReact-lifeCycle/" class="article-date">
      <time datetime="2018-11-13T14:50:07.000Z" itemprop="datePublished">2018-11-13</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/13/ReasonReact-lifeCycle/">ReasonReact-LifeCycle</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h1><p>ReasonReact 也有類似 ReactJS 的生命週期</p>
<ul>
<li><p>didMount: self =&gt; unit</p>
</li>
<li><p>willReceiveProps: self =&gt; state</p>
</li>
<li><p>shouldUpdate: oldAndNewSelf =&gt; bool</p>
</li>
<li><p>willUpdate: oldAndNewSelf =&gt; unit</p>
</li>
<li><p>didUpdate: oldAndNewSelf =&gt; unit</p>
</li>
<li><p>willUnmount: self =&gt; unit</p>
</li>
</ul>
<p><strong>Note</strong></p>
<ul>
<li>移除了所有 <code>component</code> 前綴</li>
<li><code>willReceiveProps</code> 需要回傳的是 state 預設是假設你每次都要修改狀態，不然也可以直接回傳 <code>state</code></li>
<li><code>didUpdate</code>, <code>willUnmount</code> 和 <code>willUpdate</code> 不可以修改 <code>state</code></li>
<li>不支援 <code>willMount</code> 請用 <code>didMount</code></li>
<li><code>didUpdate</code>, <code>willUpdate</code> 和 <code>shouldUpdate</code> 的 input 是 <strong><code>oldAndNewSelf record</code></strong>, 類型是 <code>{oldSelf: self, newSelf: self}</code> </li>
</ul>
<p>如果你真的在 lifecycle 中修改 <code>state</code>, 請發一個 Action <code>self.send(DidMountUpdate)</code></p>
<h2 id="retainedProps"><a href="#retainedProps" class="headerlink" title="retainedProps"></a>retainedProps</h2><p>ReactJS 中有時會使用到 <code>prevProps(componentDidUpdate)</code> 或是 <code>nextProps(componentWillUpdate)</code> 這類的 API</p>
<p>但是 ReasonReact 中沒有這個部分, 則是要使用 <code>retainedProps</code> 來實現</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">type item = &#123;</span><br><span class="line">  title: string,</span><br><span class="line">  completed: bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type retainedProps = &#123;message: string&#125;;</span><br><span class="line"></span><br><span class="line">module TodoItem = &#123;</span><br><span class="line">  let component = ReasonReact.statelessComponentWithRetainedProps(&quot;TodoItem&quot;);</span><br><span class="line">  let make = (~item, ~message, _children) =&gt; &#123;</span><br><span class="line">    ...component,</span><br><span class="line">    retainedProps: &#123;message: message&#125;,</span><br><span class="line">    didUpdate: (&#123;oldSelf, newSelf&#125;) =&gt; &#123;</span><br><span class="line">      if (oldSelf.retainedProps.message !== newSelf.retainedProps.message) &#123;</span><br><span class="line">        Js.log(&quot;props `message` changed!&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    render: (_self) =&gt;</span><br><span class="line">      &lt;div className=&quot;item&quot;&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          checked=(item.completed)</span><br><span class="line">          /* TODO make interactive */</span><br><span class="line">        /&gt;</span><br><span class="line">        (ReasonReact.string(item.title))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type state = &#123;items: list(item)&#125;;</span><br><span class="line"></span><br><span class="line">type action =</span><br><span class="line">  | AddItem;</span><br><span class="line"></span><br><span class="line">let component = ReasonReact.reducerComponent(&quot;TodoApp&quot;);</span><br><span class="line"></span><br><span class="line">let newItem = () =&gt; &#123;title: &quot;Click a button&quot;, completed: true&#125;;</span><br><span class="line"></span><br><span class="line">let make = (_children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  initialState: () =&gt; &#123;</span><br><span class="line">    items: [</span><br><span class="line">      &#123;title: &quot;Write some things to do&quot;, completed: false&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  reducer: (action, &#123;items&#125;) =&gt;</span><br><span class="line">    switch action &#123;</span><br><span class="line">    | AddItem =&gt; ReasonReact.Update(&#123;items: [newItem(), ...items]&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  render: (self) =&gt; &#123;</span><br><span class="line">    let numItems = List.length(self.state.items);</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div className=&quot;title&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;What to do&quot;))</span><br><span class="line">        &lt;button onClick=(_event =&gt; self.send(AddItem))&gt;</span><br><span class="line">          (ReasonReact.string(&quot;Add something&quot;))</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt;</span><br><span class="line">        (</span><br><span class="line">          self.state.items </span><br><span class="line">            |&gt; List.map((item) =&gt; &lt;TodoItem item /&gt;)</span><br><span class="line">            |&gt; Array.of_list</span><br><span class="line">            |&gt; ReasonReact.array</span><br><span class="line">        )</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt; (ReasonReact.string(&quot;Nothing&quot;)) &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;footer&quot;&gt;</span><br><span class="line">        (ReasonReact.string(string_of_int(numItems) ++ &quot; items&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ReasonReact 提供了 <code>ReasonReact.statelessComponentWithRetainedProps</code> 和 <code>ReasonReact.reducerComponentWithRetainedProps</code></p>
<p>這兩個方法只是讓你的 <code>make</code> 函數中可以多一個 <code>retainedProps</code></p>
<h2 id="willReceiveProps"><a href="#willReceiveProps" class="headerlink" title="willReceiveProps"></a>willReceiveProps</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">type item = &#123;</span><br><span class="line">  title: string,</span><br><span class="line">  completed: bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type retainedProps = &#123;message: string&#125;;</span><br><span class="line"></span><br><span class="line">module TodoItem = &#123;</span><br><span class="line">  let component = ReasonReact.statelessComponentWithRetainedProps(&quot;TodoItem&quot;);</span><br><span class="line">  let make = (~item, ~message, _children) =&gt; &#123;</span><br><span class="line">    ...component,</span><br><span class="line">    retainedProps: &#123;message: message&#125;,</span><br><span class="line">    willReceiveProps: (self) =&gt; &#123;</span><br><span class="line">      if (self.retainedProps.message === message) &#123;</span><br><span class="line">        Js.log(&quot;willReceiveProps&quot;);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    didUpdate: (&#123;oldSelf, newSelf&#125;) =&gt; &#123;</span><br><span class="line">      if (oldSelf.retainedProps.message !== newSelf.retainedProps.message) &#123;</span><br><span class="line">        Js.log(&quot;props `message` changed!&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    render: (_self) =&gt;</span><br><span class="line">      &lt;div className=&quot;item&quot;&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          checked=(item.completed)</span><br><span class="line">          /* TODO make interactive */</span><br><span class="line">        /&gt;</span><br><span class="line">        (ReasonReact.string(item.title))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type state = &#123;items: list(item)&#125;;</span><br><span class="line"></span><br><span class="line">type action =</span><br><span class="line">  | AddItem;</span><br><span class="line"></span><br><span class="line">let component = ReasonReact.reducerComponent(&quot;TodoApp&quot;);</span><br><span class="line"></span><br><span class="line">let newItem = () =&gt; &#123;title: &quot;Click a button&quot;, completed: true&#125;;</span><br><span class="line"></span><br><span class="line">let make = (_children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  initialState: () =&gt; &#123;</span><br><span class="line">    items: [</span><br><span class="line">      &#123;title: &quot;Write some things to do&quot;, completed: false&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  reducer: (action, &#123;items&#125;) =&gt;</span><br><span class="line">    switch action &#123;</span><br><span class="line">    | AddItem =&gt; ReasonReact.Update(&#123;items: [newItem(), ...items]&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  render: (self) =&gt; &#123;</span><br><span class="line">    let numItems = List.length(self.state.items);</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div className=&quot;title&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;What to do&quot;))</span><br><span class="line">        &lt;button onClick=(_event =&gt; self.send(AddItem))&gt;</span><br><span class="line">          (ReasonReact.string(&quot;Add something&quot;))</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt;</span><br><span class="line">        (</span><br><span class="line">          self.state.items </span><br><span class="line">            |&gt; List.map((item) =&gt; &lt;TodoItem item /&gt;)</span><br><span class="line">            |&gt; Array.of_list</span><br><span class="line">            |&gt; ReasonReact.array</span><br><span class="line">        )</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt; (ReasonReact.string(&quot;Nothing&quot;)) &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;footer&quot;&gt;</span><br><span class="line">        (ReasonReact.string(string_of_int(numItems) ++ &quot; items&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ReactJS 的 <code>componentWillUpdate</code> 中的參數 <code>nextProps</code> 是 <code>make</code> 的參數</p>
<p>而現在的 <code>props (this.props)</code> 是上面的 <code>retainedProps，可以透過</code> <code>{oldSelf}</code> 得到</p>
<h2 id="didUpdate"><a href="#didUpdate" class="headerlink" title="didUpdate"></a>didUpdate</h2><p>ReactJS 的 prevProps 可以透過 <code>retainedProps</code> 拿到，需要使用 <code>oldSelf</code></p>
<h2 id="shouldUpdate"><a href="#shouldUpdate" class="headerlink" title="shouldUpdate"></a>shouldUpdate</h2><p>和 ReactJS 的 <code>shouldComponentUpdate</code> 對應</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReasonReact-auto-deploy" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/12/ReasonReact-auto-deploy/" class="article-date">
      <time datetime="2018-11-12T08:33:21.000Z" itemprop="datePublished">2018-11-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/12/ReasonReact-auto-deploy/">ReasonReact-auto-deploy</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Work-With-Drone"><a href="#Work-With-Drone" class="headerlink" title="Work With Drone"></a>Work With Drone</h1><p><em>drone.yml</em><br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pipeline:</span></span><br><span class="line">  <span class="attr">scp:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">appleboy/drone-scp</span></span><br><span class="line">    <span class="attr">pull:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">host:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">your</span> <span class="string">server</span> <span class="string">ip</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">22</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">secrets:</span> <span class="string">[</span> <span class="string">ssh_password</span> <span class="string">]</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/root</span></span><br><span class="line">    <span class="attr">source:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$DRONE_DIR</span></span><br><span class="line">    <span class="attr">when:</span></span><br><span class="line">      <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ssh:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">appleboy/drone-ssh</span></span><br><span class="line">    <span class="attr">host:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">your</span> <span class="string">server</span> <span class="string">ip</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">secrets:</span> <span class="string">[</span> <span class="string">ssh_password</span> <span class="string">]</span></span><br><span class="line">    <span class="attr">command_timeout:</span> <span class="number">600</span></span><br><span class="line">    <span class="attr">script:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.</span> <span class="string">/root/.nvm/nvm.sh</span> <span class="string">&amp;&amp;</span> <span class="string">nvm</span> <span class="string">use</span> <span class="number">10.9</span><span class="number">.0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mkdir</span> <span class="string">-p</span> <span class="string">Your</span> <span class="string">target</span> <span class="string">path</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cd</span> <span class="string">/root/$DRONE_DIR</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">yarn</span> <span class="string">install</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">webpack:production</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cp</span> <span class="string">-a</span> <span class="string">build/*</span> <span class="string">Your</span> <span class="string">target</span> <span class="string">path</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cd</span> <span class="string">/root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">/root/drone</span></span><br><span class="line">    <span class="attr">when:</span></span><br><span class="line">      <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></p>
<p>這個範例代表當你的 master 有被push 的時候觸發 pipe 流程</p>
<p>會依序執行</p>
<h1 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h1><p>我在 linode 的 ubuntu 16 的 server</p>
<p>安裝 bs-platform 的時候遇到 node: permission denied 的問題</p>
<p><a href="https://github.com/creationix/nvm/issues/1407" target="_blank" rel="noopener">解法</a></p>
<h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><p><a href="https://github.com/horsekitlin/reason-react-demo" target="_blank" rel="noopener">github</a></p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">server_name</span>  YourDomain;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">root</span> /var/www/html/YourDomain;</span><br><span class="line">  <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> / &#123;</span><br><span class="line">          <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然後要註冊一個 domain 指向你的 IP</p>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p><a href="http://reason-demo.tomas.website/" target="_blank" rel="noopener">demo</a></p>
<p>這樣只要有 push</p>
<p>就可以自動更新上去囉</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReasonReact-publish-package" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/11/ReasonReact-publish-package/" class="article-date">
      <time datetime="2018-11-11T14:56:56.000Z" itemprop="datePublished">2018-11-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/11/ReasonReact-publish-package/">ReasonReact-publish-package</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Initial-Project"><a href="#Initial-Project" class="headerlink" title="Initial Project"></a>Initial Project</h1><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">bsb </span>-init helloworld -theme <span class="keyword">basic-reason</span></span><br></pre></td></tr></table></figure>
<p>移除 <code>src/Demo.re</code></p>
<p>新增一個 <code>src/index.re</code></p>
<p><em>src/index.re</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let add = (a: int, b: int): int =&gt; a + b;</span><br></pre></td></tr></table></figure></p>
<p><em>package.json</em><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"tomas-math"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.1"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"bsb -make-world"</span>,</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"bsb -make-world -w"</span>,</span><br><span class="line">    <span class="attr">"clean"</span>: <span class="string">"bsb -clean-world"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"keywords"</span>: [</span><br><span class="line">    <span class="string">"BuckleScript"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"files"</span>: [</span><br><span class="line">    <span class="string">"src/index.bs.js"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"src/index.bs.js"</span>,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"bs-platform"</span>: <span class="string">"^4.0.7"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">npm</span> login</span><br><span class="line">$ <span class="built_in">npm</span> publish</span><br></pre></td></tr></table></figure>
<h1 id="Install-yourname-math"><a href="#Install-yourname-math" class="headerlink" title="Install yourname-math"></a>Install yourname-math</h1><p>建立一個新的 project</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br><span class="line">$ npm <span class="keyword">install</span> yourname-<span class="keyword">math</span></span><br></pre></td></tr></table></figure>
<p>會看到 node_modules</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── <span class="selector-tag">index</span><span class="selector-class">.js</span></span><br><span class="line">├── <span class="selector-tag">node_modules</span></span><br><span class="line">│   └── <span class="selector-tag">tomas-math</span></span><br><span class="line">│       ├── <span class="selector-tag">README</span><span class="selector-class">.md</span></span><br><span class="line">│       ├── <span class="selector-tag">package</span><span class="selector-class">.json</span></span><br><span class="line">│       └── <span class="selector-tag">src</span></span><br><span class="line">│           └── <span class="selector-tag">index</span><span class="selector-class">.bs</span><span class="selector-class">.js</span></span><br><span class="line">├── <span class="selector-tag">package-lock</span><span class="selector-class">.json</span></span><br><span class="line">└── <span class="selector-tag">package</span><span class="selector-class">.json</span></span><br></pre></td></tr></table></figure>
<p>因為我們指定了 公開 <code>index.bs.js</code></p>
<p>也是我們主要引入的檔案</p>
<p><em>index.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;add&#125; = <span class="built_in">require</span>(<span class="string">'tomas-math'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>, <span class="number">2</span>)); <span class="comment">//3</span></span><br></pre></td></tr></table></figure></p>
<p>很簡單吧</p>
<p>其實跟原本的 Nodejs 的 publish 大同小異</p>
<p>卻可以使用到 Reason 的形態檢查</p>
<p>明天再來討論如果有第三方套件該如何使用</p>
<p>以 lodash 為範例</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReasonReact-Todo-Tutorial-PartII-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/10/ReasonReact-Todo-Tutorial-PartII-1/" class="article-date">
      <time datetime="2018-11-09T16:19:35.000Z" itemprop="datePublished">2018-11-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/10/ReasonReact-Todo-Tutorial-PartII-1/">ReasonReact-Todo-Tutorial-PartII</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h1><p>昨天進度到了完成了一個 <code>Reducer</code></p>
<p>但是我們知道要修改 <code>Reducer</code> 只能夠透過 <code>Action</code></p>
<p>而在 ReasonReact 如何描述一個 <code>Action</code>？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">type action = </span><br><span class="line">  | AddItem;</span><br><span class="line"></span><br><span class="line">type item = &#123;</span><br><span class="line">  title: string,</span><br><span class="line">  completed: bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type state = &#123;</span><br><span class="line">  items: list(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let newItem = () =&gt; &#123;title: &quot;Click a button&quot;, completed: true&#125;;</span><br><span class="line"></span><br><span class="line">let component = ReasonReact.reducerComponent(&quot;TodoApp&quot;);</span><br><span class="line"></span><br><span class="line">let make = (_children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  reducer: ((), _) =&gt; ReasonReact.NoUpdate,</span><br><span class="line">  render: (&#123;state: &#123;items&#125;&#125;) =&gt; &#123;</span><br><span class="line">    let numItems = List.length(items);</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div className=&quot;title&quot;&gt;</span><br><span class="line">        (str(&quot;What to do&quot;))</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=((evt) =&gt; AddItem)</span><br><span class="line">        &gt;</span><br><span class="line">          (ReasonReact.string(&quot;Add something&quot;))</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt; (ReasonReact.string(&quot;Nothing&quot;)) &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;footer&quot;&gt;</span><br><span class="line">        (ReasonReact.string(string_of_int(numItems) ++ &quot; items&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先幫昨天的範例加上一個 <code>button</code> 有一個 Event <code>onClick</code></p>
<p>點擊後會 Js.log(“didn’t add something”)</p>
<p>如果在 <code>React</code> 中這邊應該是要呼叫 <code>this.setState</code></p>
<p>但是在 ReasonReact 中這需要兩個步驟</p>
<ol>
<li>建立一個 Action Type</li>
<li>然後建立一個 Reducer 並且和 Action Type mapping</li>
</ol>
<h1 id="Reducer-And-Action"><a href="#Reducer-And-Action" class="headerlink" title="Reducer And Action"></a>Reducer And Action</h1><p><em>Demo</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">type item = &#123;</span><br><span class="line">  title: string,</span><br><span class="line">  completed: bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type state = &#123;items: list(item)&#125;;</span><br><span class="line"></span><br><span class="line">type action =</span><br><span class="line">  | AddItem;</span><br><span class="line"></span><br><span class="line">let component = ReasonReact.reducerComponent(&quot;TodoApp&quot;);</span><br><span class="line"></span><br><span class="line">let newItem = () =&gt; &#123;title: &quot;Click a button&quot;, completed: true&#125;;</span><br><span class="line"></span><br><span class="line">let make = (_children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  initialState: () =&gt; &#123;</span><br><span class="line">    items: [</span><br><span class="line">      &#123;title: &quot;Write some things to do&quot;, completed: false&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  reducer: (action, &#123;items&#125;) =&gt;</span><br><span class="line">    switch action &#123;</span><br><span class="line">    | AddItem =&gt; ReasonReact.Update(&#123;items: [newItem(), ...items]&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  render: (self) =&gt; &#123;</span><br><span class="line">    let numItems = List.length(self.state.items);</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div className=&quot;title&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;What to do&quot;))</span><br><span class="line">        &lt;button onClick=(_event =&gt; self.send(AddItem))&gt;</span><br><span class="line">          (ReasonReact.string(&quot;Add something&quot;))</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt; (ReasonReact.string(&quot;Nothing&quot;)) &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;footer&quot;&gt;</span><br><span class="line">        (ReasonReact.string(string_of_int(numItems) ++ &quot; items&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="initialState"><a href="#initialState" class="headerlink" title="initialState"></a>initialState</h2><p>React 稱為 <code>getInitialState</code> 在 Reason 中稱為 <code>initialState</code></p>
<p>不需傳入參數，會回傳一個 <code>state</code> 類型</p>
<p><code>state</code> 可以是任何類型 string, int, record …etc</p>
<h1 id="Actions-and-Reducer"><a href="#Actions-and-Reducer" class="headerlink" title="Actions and Reducer"></a>Actions and Reducer</h1><p>在 React 中你會透過 callback handler 來修改 state</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* ... other fields */</span></span><br><span class="line">  handleClick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  handleSubmit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(...);</span><br><span class="line">  &#125;,</span><br><span class="line">  render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;MyForm</span><br><span class="line">        onClick=&#123;<span class="keyword">this</span>.handleClick&#125;</span><br><span class="line">        onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 ReasonReact 你會將所有的 Function 整理在同一個地方</p>
<p>如果你看到 <code>self.reduce</code> 這是舊的 API</p>
<p>新的 API 是 <code>self.send</code></p>
<ul>
<li><code>action</code> 是使用者定義的類型，他是一個 <code>variant</code> 類型，描述了所有可能的 state 類型</li>
<li>Component 的 state 可以透過 <code>self.state</code> 拿到</li>
<li>只有一個 reducer 是 <a href="https://reasonml.github.io/docs/en/pattern-matching.html" target="_blank" rel="noopener">pattern-matches</a> 會針對有可能的 action 去修改 reducer 得值</li>
<li>在 reducer 中 <code>self.handler</code> 不允許狀態的改變，你必須使用 self.send 發送一個 action</li>
</ul>
<p>例如我們點擊了一個按鈕</p>
<p>會發送一個 <code>Click</code> 的 action</p>
<p>他會依據 <code>Click</code> 的這事件回傳一個新的 state</p>
<h1 id="用-Reducer-更新狀態"><a href="#用-Reducer-更新狀態" class="headerlink" title="用 Reducer 更新狀態"></a>用 Reducer 更新狀態</h1><p><code>ReasonReact.Update</code> 回傳一個新的 state</p>
<p>另外也有一些其他選擇</p>
<ul>
<li>ReasonReact.NoUpdate - 不要更新 state</li>
<li>ReasonReact.Update - 更新 state</li>
<li>ReasonREact.SideEffects(self =&gt; unit) 不需要更新 state 但是需要但是需要觸發行為 e.g.<code>ReasonReact.SideEffects(_self =&gt; Js.log(&quot;hello!&quot;))</code></li>
<li>ReasonReact.UpdateWithSideEffects(state, self =&gt; unit): 更新狀態並且觸發行為</li>
</ul>
<h1 id="重要提示"><a href="#重要提示" class="headerlink" title="重要提示"></a>重要提示</h1><ul>
<li>action 可以帶入參數 <code>payload</code>: <code>onClick=(data =&gt; self.send(Click(data.foo)))</code></li>
<li>不要把事件本身傳遞給 action</li>
<li><code>reducer</code> 必須是 pure function, 用 SideEffects 或者 UpdateWithSideEffects 增加一個 side-effect, 這個 side-effect 會在 state 處理完之後, 下一次 render 前進行</li>
<li><code>ReactEvent.BlablaEvent.preventDefault(event)</code> 請在  <code>self.send</code> 中處理它</li>
<li>可以自由的觸發另一個 action 在 sideeffect, e.g <code>UpdateWithSideEffects(newState, self =&gt; self.send(Click))</code></li>
<li>如果你僅僅只有 state, 你的 Component 僅有 <code>self.handler</code>而沒有用到 <code>self.send</code> 但是依舊要指定 <code>reducer</code> <code>reducer: ((), _state) =&gt; ReasonReact.NoUpdate</code></li>
</ul>
<h2 id="Tip"><a href="#Tip" class="headerlink" title="Tip"></a>Tip</h2><p>盡量縮小你的 reducer 你可以更容易使用 <code>ReasonReact.SideEffects</code> 和 <code>ReasonReact.UpdateWithSideEffects</code> 來更新 reducer</p>
<h2 id="Async-State-updated"><a href="#Async-State-updated" class="headerlink" title="Async State updated"></a>Async State updated</h2><p>在 ReactJs 中你可能會這樣使用 setState</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.setState(...), <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>但是在 ReasonReact 中會是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Js.Global.setInterval(() =&gt; self.send(Tick), 1000)</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReasonReact-Todo-Tutorial-PartII" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/10/ReasonReact-Todo-Tutorial-PartII/" class="article-date">
      <time datetime="2018-11-09T16:18:02.000Z" itemprop="datePublished">2018-11-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/10/ReasonReact-Todo-Tutorial-PartII/">ReasonReact-Todo-Tutorial-PartIII</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Rendering-items"><a href="#Rendering-items" class="headerlink" title="Rendering items"></a>Rendering items</h1><p>希望有一個區塊 Component 來顯示輸入的 <code>items</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">type item = &#123;</span><br><span class="line">  title: string,</span><br><span class="line">  completed: bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module TodoItem = &#123;</span><br><span class="line">  let component = ReasonReact.statelessComponent(&quot;TodoItem&quot;);</span><br><span class="line">  let make = (~item, _children) =&gt; &#123;</span><br><span class="line">    ...component,</span><br><span class="line">    render: (_self) =&gt;</span><br><span class="line">      &lt;div className=&quot;item&quot;&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          _type=&quot;checkbox&quot;</span><br><span class="line">          checked=(item.completed)</span><br><span class="line">          /* TODO make interactive */</span><br><span class="line">        /&gt;</span><br><span class="line">        (ReasonReact.string(item.title))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type state = &#123;items: list(item)&#125;;</span><br><span class="line"></span><br><span class="line">type action =</span><br><span class="line">  | AddItem;</span><br><span class="line"></span><br><span class="line">let component = ReasonReact.reducerComponent(&quot;TodoApp&quot;);</span><br><span class="line"></span><br><span class="line">let newItem = () =&gt; &#123;title: &quot;Click a button&quot;, completed: true&#125;;</span><br><span class="line"></span><br><span class="line">let make = (_children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  initialState: () =&gt; &#123;</span><br><span class="line">    items: [</span><br><span class="line">      &#123;title: &quot;Write some things to do&quot;, completed: false&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  reducer: (action, &#123;items&#125;) =&gt;</span><br><span class="line">    switch action &#123;</span><br><span class="line">    | AddItem =&gt; ReasonReact.Update(&#123;items: [newItem(), ...items]&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  render: (self) =&gt; &#123;</span><br><span class="line">    let numItems = List.length(self.state.items);</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div className=&quot;title&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;What to do&quot;))</span><br><span class="line">        &lt;button onClick=(_event =&gt; self.send(AddItem))&gt;</span><br><span class="line">          (ReasonReact.string(&quot;Add something&quot;))</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt;</span><br><span class="line">        (</span><br><span class="line">          ReasonReact.array(Array.of_list(</span><br><span class="line">              List.map((item) =&gt; &lt;TodoItem item /&gt;, self.state.items)</span><br><span class="line">          ))</span><br><span class="line">        )</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt; (ReasonReact.string(&quot;Nothing&quot;)) &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;footer&quot;&gt;</span><br><span class="line">        (ReasonReact.string(string_of_int(numItems) ++ &quot; items&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我們又增加了一些東西</p>
<p>和一般的 JSX 有一點不一樣 <code>&lt;TodoItem item /&gt;</code></p>
<p>他原本也是 <code>&lt;TodoItem item=item /&gt;</code> 的簡寫</p>
<p>JSX 中則會被解釋為 <code>&lt;TodoItem item={true} /&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReasonReact.array(Array.of_list(</span><br><span class="line">    List.map((item) =&gt; &lt;TodoItem item /&gt;, self.state.items)</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
<p>可以看到這個寫法</p>
<p>但是其實也可以改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.state.items |&gt; List.map((item) =&gt; &lt;TodoItem item /&gt;) |&gt; Array.of_list |&gt; ReasonReact.array</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReasonReact-Todo-Tutorial-PartI" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/10/ReasonReact-Todo-Tutorial-PartI/" class="article-date">
      <time datetime="2018-11-09T16:17:47.000Z" itemprop="datePublished">2018-11-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/10/ReasonReact-Todo-Tutorial-PartI/">ReasonReact-Todo-Tutorial-PartI</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="調整-initial-的-project"><a href="#調整-initial-的-project" class="headerlink" title="調整 initial 的 project"></a>調整 initial 的 project</h1><p>之前我們有用 <code>bsb</code> initial 了一個 <code>project</code></p>
<p>但是要做一些小小的調整</p>
<p>先新增一個 <code>.re</code></p>
<p><em>TodoApp.re</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let component = ReasonReact.statelessComponent(&quot;TodoApp&quot;);</span><br><span class="line"></span><br><span class="line">let make = (children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  render: (self) =&gt;</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div className=&quot;title&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;What to do&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;Nothing&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>index.re</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOMRe.renderToElementWithId(&lt;TodoApp /&gt;, &quot;root&quot;);</span><br></pre></td></tr></table></figure></p>
<p><em>index.html</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>ReasonReact Examples<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"Index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到基本的顯示</p>
<p><img src="../../../../images/todoApp/demo.png" alt="demo"></p>
<h1 id="STEP1-增加一些-State"><a href="#STEP1-增加一些-State" class="headerlink" title="STEP1 增加一些 State"></a>STEP1 增加一些 State</h1><h2 id="宣告一些類型"><a href="#宣告一些類型" class="headerlink" title="宣告一些類型"></a>宣告一些類型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">type item = &#123;</span><br><span class="line">  title: string,</span><br><span class="line">  completed: bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type state = &#123;</span><br><span class="line">  items: array(item)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let component = ReasonReact.statelessComponent(&quot;TodoApp&quot;);</span><br><span class="line"></span><br><span class="line">let make = (children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  render: (_self) =&gt;</span><br><span class="line">    &lt;div className=&quot;app&quot;&gt;</span><br><span class="line">      &lt;div className=&quot;title&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;What to do&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className=&quot;items&quot;&gt;</span><br><span class="line">        (ReasonReact.string(&quot;Nothing&quot;))</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><p>ReaconReact 的有狀態 Component 和 React 的有狀態 Component 是類似的</p>
<p>只是多了 <code>reducer</code> 的概念 (類似 <a href="https://redux.js.org/" target="_blank" rel="noopener">Redux</a>)</p>
<p>只要把它當成狀態管理系統就好</p>
<p>將宣告 <code>statefulComponent</code> 取代 <code>statelessComponent</code></p>
<p>使用 <code>ReasonReact.reducerComponent(&quot;MyComponentName&quot;)</code> 這個 API</p>
<h3 id="Stateful-範例"><a href="#Stateful-範例" class="headerlink" title="Stateful 範例"></a>Stateful 範例</h3><p><em>index.re</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOMRe.renderToElementWithId(&lt;StatefulComponent greeting=&quot;greeting&quot; /&gt;, &quot;root&quot;);</span><br></pre></td></tr></table></figure></p>
<p><em>StatefulComponent.re</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">type state = &#123;</span><br><span class="line">  count: int,</span><br><span class="line">  show: bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type action = </span><br><span class="line">  | Click</span><br><span class="line">  | Toggle;</span><br><span class="line"></span><br><span class="line">let component = ReasonReact.reducerComponent(&quot;Example&quot;);</span><br><span class="line"></span><br><span class="line">let make = (~greeting, _children) =&gt; &#123;</span><br><span class="line">  ...component,</span><br><span class="line">  initialState: () =&gt; &#123;count: 0, show: true&#125;,</span><br><span class="line">  reducer: (action, state) =&gt;</span><br><span class="line">    switch (action) &#123;</span><br><span class="line">    | Click =&gt; ReasonReact.Update(&#123;...state, count: state.count + 1&#125;)</span><br><span class="line">    | Toggle =&gt; ReasonReact.Update(&#123;...state, show: !state.show&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  render: (self) =&gt; &#123;</span><br><span class="line">    let message = &quot;You&apos;ve clicked this &quot; ++ string_of_int(self.state.count) ++ &quot; times(s)&quot;;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=(_event =&gt; self.send(Click))&gt;</span><br><span class="line">        (ReasonReact.string(message))</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=(_event =&gt; self.send(Toggle))&gt;</span><br><span class="line">        (ReasonReact.string(&quot;Toggle greeting&quot;))</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      (</span><br><span class="line">        self.state.show</span><br><span class="line">          ? ReasonReact.string(greeting)</span><br><span class="line">          : ReasonReact.null</span><br><span class="line">      )</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason-ExternalPromiseAPI" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/04/Reason-ExternalPromiseAPI/" class="article-date">
      <time datetime="2018-11-04T09:18:26.000Z" itemprop="datePublished">2018-11-04</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/04/Reason-ExternalPromiseAPI/">Reason-ExternalPromiseAPI</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="External-Mongo-client"><a href="#External-Mongo-client" class="headerlink" title="External Mongo client"></a>External Mongo client</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let url = &quot;mongodb://localhost:27017&quot;;</span><br><span class="line">let dbName = &quot;myproject&quot;;</span><br><span class="line"></span><br><span class="line">[@bs.module &quot;mongodb&quot;] external connect: (string) =&gt; Js.Promise.t(&apos;a) = &quot;&quot;;</span><br><span class="line">let connection = (url) =&gt; connect(url);</span><br></pre></td></tr></table></figure>
<p><code>connection</code>會取得一個 <code>Promise</code> 的回傳值</p>
<p>之後只要利用它就可以用 <code>Promise</code> 的模式來對 MongoDB 進行控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;mongodb&quot;] external connect: (string) =&gt; Js.Promise.t(&apos;a) = &quot;&quot;;</span><br><span class="line">let connect = (url) =&gt; connect(url);</span><br><span class="line"></span><br><span class="line">module ObjectID = &#123;</span><br><span class="line">  type t;</span><br><span class="line">  [@bs.send.pipe : t] external toHexString : string = &quot;&quot;;</span><br><span class="line">  [@bs.new] [@bs.module &quot;mongodb&quot;] external from_string : string =&gt; t = &quot;ObjectID&quot;;</span><br><span class="line">  [@bs.new] [@bs.module &quot;mongodb&quot;] external make : t = &quot;ObjectID&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module type TConfig = &#123;</span><br><span class="line">  let url: string;</span><br><span class="line">  let dbName: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module CreateConnection = (Config: TConfig) =&gt; &#123;</span><br><span class="line">  let url = Config.url;</span><br><span class="line">  let dbName = Config.dbName;</span><br><span class="line"></span><br><span class="line">  module Db = &#123;</span><br><span class="line">    type t;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  module Client = &#123;</span><br><span class="line">    type t;</span><br><span class="line">    [@bs.send] external db : (t, string) =&gt; Db.t = &quot;&quot;;</span><br><span class="line">    let db = (client, name) =&gt; db(client, name);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  module Collection = &#123;</span><br><span class="line">    type t;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  let clientPromise: Js.Promise.t(Client.t) = connect(url);</span><br><span class="line"></span><br><span class="line">  let createDB: string =&gt; Js.Promise.t(Db.t) = (name) =&gt; </span><br><span class="line">    clientPromise |&gt; Js.Promise.then_((client) =&gt; &#123;</span><br><span class="line">      Js.Promise.resolve(Client.db(client, name));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module Config = &#123;</span><br><span class="line">  let url = &quot;mongodb://localhost:27017&quot;;</span><br><span class="line">  let dbName = &quot;myproject&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module Connection = CreateConnection(Config);</span><br></pre></td></tr></table></figure>
<p>幾本的程式碼</p>
<p>其中也有一部分利用 <code>functor</code> 建立一個 <code>module</code></p>
<p>但是總覺得這樣並不好</p>
<p>詳細要怎樣時做可能還需要一點時間處理</p>
<p>要準備開始 ReasonReact 了</p>
<p>先繼續往下走吧</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2024 Tomas Lin
            </div>
            <!-- <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div> -->
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>