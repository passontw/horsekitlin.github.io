<!DOCTYPE html>
<html lang="zh-tw">
<head><meta name="generator" content="Hexo 3.9.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Tomas Lin">


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="湯瑪士的部落格">
<meta property="og:url" content="https://horsekitlin.github.io/page/6/index.html">
<meta property="og:site_name" content="湯瑪士的部落格">
<meta property="og:locale" content="zh-tw">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="湯瑪士的部落格">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="湯瑪士的部落格" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>湯瑪士的部落格</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Tomas Lin</a></h1>
        </hgroup>

        
        <p class="header-subtitle">技術手扎！不定期更新</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/archives/">主頁</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">標籤</a></li>
                        
                            <li><a href="/about/">關於我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:passon.com.tw@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/passontw" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css/">Css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DesignPatten/">DesignPatten</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FunctionPrograming/">FunctionPrograming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IThome2023/">IThome2023</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Leetcode/">Leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Material-design/">Material-design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MessageQueue/">MessageQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Microservies/">Microservies</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-Native/">React Native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reason/">Reason</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redux/">Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SocketCluster/">SocketCluster</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sodility/">Sodility</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Themes/">Themes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translate/">Translate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Truffle/">Truffle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typescript/">Typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/">VSCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ithome-12/">ithome 12</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/">spring-boot</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Tomas Lin</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Tomas Lin</a></h1>
            </hgroup>
            
            <p class="header-subtitle">技術手扎！不定期更新</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">主頁</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">標籤</a></li>
                
                    <li><a href="/about/">關於我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:passon.com.tw@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/passontw" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-Express-helloworld-API" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/21/Express-helloworld-API/" class="article-date">
      <time datetime="2018-10-21T14:28:33.000Z" itemprop="datePublished">2018-10-21</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/21/Express-helloworld-API/">Express-helloworld-API</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Express-API"><a href="#Express-API" class="headerlink" title="Express API"></a>Express API</h1><p>之前聊了很多基本的型態和使用</p>
<p>開始來做一些實際的東西(不然有點無聊)</p>
<p>在 <code>Nodejs</code> 中似乎想到 API</p>
<p>都會先想到 <code>Express</code></p>
<p>今天先用 Reason 寫一個 Express 的 hello world API</p>
<p>但是在這之前</p>
<p>我們先用最簡單的 nodejs 寫一個 Express hello world API</p>
<p>然後再慢慢轉為 Reason</p>
<h2 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h2><p>安裝 <code>express</code> 和開始 watch <code>re</code> 檔案</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>npm install express</span><br><span class="line"><span class="variable">$ </span>yarn start</span><br></pre></td></tr></table></figure>
<p>app.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; res.send(<span class="string">'Hello World!'</span>));</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br></pre></td></tr></table></figure></p>
<p><img src="../../../../images/express_helloworld/helloworld.png" alt="Image"></p>
<h3 id="步驟"><a href="#步驟" class="headerlink" title="步驟"></a>步驟</h3><p>在上面的範例中  <code>require</code> 了一個 <code>express</code> 他是一個函式 它會回傳一個 <code>app</code> 的物件</p>
<p>然和對 <code>app</code> 的這個物件 有使用到兩個函式</p>
<p><code>listen</code> 和 <code>get</code></p>
<p>listen 會丟入一個參數(int)</p>
<p>get 會丟入兩個參數(string, function)</p>
<p>而在 get 中丟入的 function 會有兩個物件 <code>req</code>, <code>res</code></p>
<p>因為只有使用到 <code>res.send</code></p>
<p>大致上我們可以先宣告剛剛有提到函式 和參數的類型</p>
<p>再寫上 <code>express</code> 的程式</p>
<p>結果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">type res = &#123;.</span><br><span class="line">  [@bs.meth] &quot;send&quot;: string =&gt; string</span><br><span class="line"> &#125;;</span><br><span class="line">type handler = (string, res) =&gt; string;</span><br><span class="line">type expressApp = &#123;.</span><br><span class="line">  [@bs.meth] &quot;listen&quot;: (int) =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler) =&gt; string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.module] external express: unit =&gt; expressApp = &quot;express&quot;;</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">app##get(&quot;/&quot;, (_, res) =&gt; res##send(&quot;Hello World!&quot;));</span><br><span class="line"></span><br><span class="line">app##listen(3000);</span><br></pre></td></tr></table></figure>
<p>有一些東西看不懂</p>
<h3 id="BuckleScript-Class"><a href="#BuckleScript-Class" class="headerlink" title="BuckleScript - Class"></a>BuckleScript - Class</h3><p>裡面有些東西和 <code>BuckleScript</code> 的 <code>Class</code> 有關係</p>
<p>先來聊聊 在 <code>Reason</code> 中如何使用 class <code>new</code> 出一個物件</p>
<h4 id="bs-new"><a href="#bs-new" class="headerlink" title="@bs.new"></a>@bs.new</h4><p>以 <code>Date</code> 為範例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type t;</span><br><span class="line">[@bs.new] external createDate: unit =&gt; t = &quot;Date&quot;;</span><br><span class="line"></span><br><span class="line">let date = createDate();</span><br></pre></td></tr></table></figure>
<p>上面的程式碼會編譯為<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br></pre></td></tr></table></figure></p>
<p>如果你想要用 <a href="http://momentjs.com/" target="_blank" rel="noopener">moment</a></p>
<p>可以利用 <a href="mailto:`@bs.new" target="_blank" rel="noopener">`@bs.new</a><code>和</code>@bs.module`</p>
<p>並且設定回傳可以使用的 <code>method</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type momentResult = &#123;.</span><br><span class="line">  [@bs.meth] &quot;format&quot;: (string) =&gt; string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.new] [@bs.module]  external moment: unit =&gt; momentResult = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">let date = moment();</span><br><span class="line">Js.log(date##format(&quot;YYYY&quot;));</span><br></pre></td></tr></table></figure>
<p>上面的程式碼會轉為</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Moment = <span class="built_in">require</span>(<span class="string">"moment"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> Moment();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(date.format(<span class="string">"YYYY"</span>)); <span class="comment">/* 2018 */</span></span><br></pre></td></tr></table></figure>
<p>主要是因為在 <code>moment</code> 增加一個回傳的 <code>momentResult</code> 的類型</p>
<p>代表回傳了一個 Javascript 物件 裡面有一個 <code>format</code> 的函式可以使用</p>
<p>需要傳入一個 string 會回傳一個 string</p>
<h4 id="綁定-JS-Class"><a href="#綁定-JS-Class" class="headerlink" title="綁定 JS Class"></a>綁定 JS Class</h4><p>JS Class 其實就是 Object 和 Class 利用一些方式連接起來</p>
<p>OCaml 通常會增加 <code>[@bs]</code> 將 class 轉為 <code>Js.t</code> 類型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class type _moment =</span><br><span class="line">  [@bs]</span><br><span class="line">  &#123;</span><br><span class="line">    pub format: (string) =&gt; string;</span><br><span class="line">  &#125;;</span><br><span class="line">type momentResult = Js.t(_moment);</span><br><span class="line"></span><br><span class="line">[@bs.new] [@bs.module]  external moment: unit =&gt; momentResult = &quot;&quot;;</span><br><span class="line">let date = moment();</span><br><span class="line">Js.log(date##format(&quot;YYYY&quot;)); /* 2018 */</span><br></pre></td></tr></table></figure>
<p>這個做法也是可以</p>
<p>結果是同樣的</p>
<p>但是這個做法可以使用 <code>[@bs.meth]</code> 來宣告非 <code>arrow function</code></p>
<p>這些值會被視為 <code>properties</code></p>
<p><code>[@bs.set]</code> 則會將這些參數視為可以更動的 (<code>mutable</code>)</p>
<p>之後要修改值的時候要使用 <code>#=</code></p>
<p>刪除 <code>[@bs.set]</code> 則會變為 不可變動的(<code>immutable</code>)</p>
<p><strong>這部分之後在 JS package 中會做更詳細的討論</strong></p>
<h3 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h3><p>先實做一個 簡單的 <code>Middleware</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">type res = &#123;.</span><br><span class="line">  [@bs.meth] &quot;send&quot;: string =&gt; string</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">type nextFun = unit =&gt; string;</span><br><span class="line">type handler = (string, res, nextFun) =&gt; string;</span><br><span class="line"></span><br><span class="line">type expressApp = &#123;.</span><br><span class="line">  [@bs.meth] &quot;listen&quot;: (int) =&gt; unit,</span><br><span class="line">  [@bs.meth] &quot;get&quot;: (string, handler, handler) =&gt; string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.module] external express: unit =&gt; expressApp = &quot;express&quot;;</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">app##get(&quot;/&quot;, (_, _, next) =&gt; &#123;</span><br><span class="line">  Js.log(&quot;hello next&quot;);</span><br><span class="line">  next();</span><br><span class="line">&#125;, (_, res, _) =&gt; res##send(&quot;Hello World!&quot;));</span><br><span class="line"></span><br><span class="line">app##listen(3000);</span><br></pre></td></tr></table></figure>
<p>但是每次多一個 middleware 都要對一個 type 做一次修改</p>
<p>感覺很麻煩啊</p>
<p>今天先到這邊吧</p>
<p>之後再來處理 <code>Middleware</code> 的問題了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-BasicType-OptionsAndSomeAndNone" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/20/BasicType-OptionsAndSomeAndNone/" class="article-date">
      <time datetime="2018-10-20T15:12:05.000Z" itemprop="datePublished">2018-10-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/20/BasicType-OptionsAndSomeAndNone/">BasicType-OptionsAndSomeAndNone</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Null-和-Undefined-和-Option"><a href="#Null-和-Undefined-和-Option" class="headerlink" title="Null 和 Undefined 和 Option"></a>Null 和 Undefined 和 Option</h1><p>Reason 並沒有 <code>null</code> 和 <code>undefined</code> 的概念</p>
<p>這是很棒的事情，因為可以減少很多型態的 bugs</p>
<p>再也看不到 <code>undefined is not a function</code> 或是 <code>cannot access foo of undefined</code></p>
<p>但是 這些值其實依舊存在但是在 Reason 可以安全的存在</p>
<p>因為是通過 Option 來表示值是否存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type option(&apos;a) = None | Some(&apos;a);</span><br></pre></td></tr></table></figure>
<p>這代表這個值得類型是 <code>None</code> (無) 或是實際值包含在 <code>Some</code> 中</p>
<h2 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let personHasCar = false;</span><br><span class="line"></span><br><span class="line">if(personHasCar) &#123;</span><br><span class="line">  Some(5);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  None;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要表示一個數可能會是 <code>None</code> </p>
<p>但是可以利用另一種寫法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">let licenseNumber = Some(5);</span><br><span class="line"></span><br><span class="line">switch (licenseNumber) &#123;</span><br><span class="line">  | None =&gt; print_endline(&quot;The person doesn&apos;t have a car&quot;)</span><br><span class="line">  | Some(number) =&gt;</span><br><span class="line">    print_endline(&quot;The person&apos;s license number is &quot; ++ string_of_int(number))</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>透過將數字串為選項</p>
<p>強迫您列舉出所有可能的選項和回應</p>
<p>杜絕錯誤處理或忘記處理的情況</p>
<h2 id="Option"><a href="#Option" class="headerlink" title="Option"></a>Option</h2><p>Option 其實就是等於 <code>Some(&#39;a)</code> 或 <code>None</code></p>
<p>這在 Javascript 中十分常見</p>
<h3 id="警告1"><a href="#警告1" class="headerlink" title="警告1"></a>警告1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let aaa = Some(Some(Some(5)))</span><br></pre></td></tr></table></figure>
<p>這個依舊會被編譯為 <code>let aaa = 5;</code></p>
<p>但是下面的狀況會比較麻煩</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let bbb = Some(None);</span><br></pre></td></tr></table></figure>
<p>上面那一行會被編譯為</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bbb = Js_primitive.some(<span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure>
<p>什麼是 <code>Js_primitive</code> ?</p>
<p>怎麼不直接編譯為 <code>var bbb = undefined;</code> 這樣就好了？</p>
<p>在處理多種 <code>Option</code> 的型態的時候</p>
<p>如果沒有用一些特殊註解來標記這些值的話</p>
<p>很多操作上都會變得棘手</p>
<p>以下有幾個原則可以遵守</p>
<ul>
<li>永遠不要內嵌 <code>Option</code> (Ex: <code>Some(Some(Some(5)))</code>)</li>
<li>不要指定 <code>Option(&#39;a)</code> 給來源是 Javascript 的值，給予準確的型態</li>
</ul>
<h3 id="警告2"><a href="#警告2" class="headerlink" title="警告2"></a>警告2</h3><p>但是很多時候在 Javascript 總是會有 <code>null</code> 或是未定義</p>
<p>在這種情況下我們無法輸入這種值</p>
<p>因為 <code>option</code> 只會檢查 <code>undefined</code> 而不會檢查 <code>null</code></p>
<h4 id="解法-Js-Nullable"><a href="#解法-Js-Nullable" class="headerlink" title="解法: Js.Nullable"></a>解法: Js.Nullable</h4><p>有提供 <code>Js.Nullable</code> 這個模組來檢查 <code>undefined</code> 和 <code>null</code></p>
<p> 要建立 <code>undefined</code> 可以使用 <code>Js.Nullable.undefined</code> </p>
<p> 當然你也可以使用 <code>None</code> 這並不衝突</p>
<h4 id="範例-1"><a href="#範例-1" class="headerlink" title="範例"></a>範例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;MyIdValidator&quot;] external myId: Js.Nullable.t(string) = &quot;MyID&quot;;</span><br><span class="line"></span><br><span class="line">[@bs.module &quot;MyIdValidator&quot;] external validate: Js.Nullable.t(string) =&gt; bool = &quot;validate&quot;;</span><br><span class="line"></span><br><span class="line">let personId: Js.Nullable.t(string) = Js.Nullable.return(&quot;abc123&quot;);</span><br><span class="line"></span><br><span class="line">let result = validate(personId);</span><br></pre></td></tr></table></figure>
<p><code>Js.Nullable.return</code> 可以回傳的是一個允許他是 <code>null</code> 的字串</p>
<p>而不僅僅是單純的字串格式</p>
<p><code>None</code> 和 <code>Js.Nullable</code> 是很重要的一部分</p>
<p>因為他補足了強形態中處理 <code>null</code> 和 <code>undefined</code> 的問題</p>
<h2 id="More-on-Type"><a href="#More-on-Type" class="headerlink" title="More on Type"></a>More on Type</h2><p>型別是可以接受參數的</p>
<p>類似別種語言的(generics)</p>
<p>參數必須使用 <code>&#39;</code> 開頭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type intCoordinates = (int, int, int);</span><br><span class="line">type floatCoordinates = (float, float, float);</span><br><span class="line"></span><br><span class="line">let buddy: intCoordinates = (10, 20, 20);</span><br></pre></td></tr></table></figure>
<p>這是基本的使用方法</p>
<p>可以改為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type coordidate(&apos;a) = (&apos;a, &apos;a, &apos;a);</span><br><span class="line"></span><br><span class="line">type coordidateAlias = coordidate(int);</span><br><span class="line"></span><br><span class="line">let buddy: coordidateAlias = (10, 20, 20);</span><br></pre></td></tr></table></figure>
<p>其實型別會自動幫你推導</p>
<p>所以更簡潔的寫法是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let buddy = (10, 20, 20);</span><br></pre></td></tr></table></figure>
<p>這時候會自動推導它為 <code>(int, int, int)</code> 型別</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let greetings = [&quot;hello&quot;, &quot;world&quot;, &quot;how are you&quot;];</span><br></pre></td></tr></table></figure>
<p>會自動推導為 <code>list(string)</code></p>
<p>型別也可以接受多個參數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type result(&apos;a, &apos;b) =</span><br><span class="line">  | Ok(&apos;a)</span><br><span class="line">  | Error(&apos;b);</span><br><span class="line">type myPayload = &#123;data: string&#125;;</span><br><span class="line"></span><br><span class="line">type myPayloadResults(&apos;errorType) = list(result(myPayload, &apos;errorType));</span><br><span class="line"></span><br><span class="line">let payloadResults: myPayloadResults(string) = [</span><br><span class="line">  Ok(&#123;data: &quot;hi&quot;&#125;),</span><br><span class="line">  Ok(&#123;data: &quot;bye&quot;&#125;),</span><br><span class="line">  Error(&quot;Something wrong happened!&quot;)</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="相互遞迴型別"><a href="#相互遞迴型別" class="headerlink" title="相互遞迴型別"></a>相互遞迴型別</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type student = &#123;taughtBy: teacher&#125;</span><br><span class="line">and teacher = &#123;student: list(student)&#125;;</span><br></pre></td></tr></table></figure>
<p>第一行沒有分號</p>
<p>第二行開頭沒有 <code>type</code></p>
<h2 id="設計決策"><a href="#設計決策" class="headerlink" title="設計決策"></a>設計決策</h2><p>型別系統基本上允許階層</p>
<p>例如: <code>list(int)</code></p>
<p>實際是 <code>list</code> 型別 中接受 <code>int</code> 型別</p>
<p>其他語言有的會稱之為泛型</p>
<p>遵循 <a href="https://en.wikipedia.org/wiki/Rule_of_least_power" target="_blank" rel="noopener">The principle of least power</a>原則</p>
<p>在解決方法中選擇最不複雜的一個來使用</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-BuckleScript-Object" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/19/BuckleScript-Object/" class="article-date">
      <time datetime="2018-10-19T07:49:47.000Z" itemprop="datePublished">2018-10-19</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/19/BuckleScript-Object/">BuckleScript-Object</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Bukle-Script-Object"><a href="#Bukle-Script-Object" class="headerlink" title="Bukle Script Object"></a>Bukle Script Object</h1><p>Javascript 中的物件有兩個主要的目的</p>
<ul>
<li>像是一個雜湊表(或是字典)， Keys 可以動態的 新增/刪除 ，值是同樣的型態</li>
<li>像是一個紀錄(Record)，欄位是固定的(但是也允許是選擇性的)，他的值可以是不同的形態</li>
</ul>
<p>這部分 BuckleScript 的物件也是一樣的</p>
<h2 id="雜湊表模式"><a href="#雜湊表模式" class="headerlink" title="雜湊表模式"></a>雜湊表模式</h2><p>直到最近 <code>Javascript</code> 才終於有正確的支援 <code>Map</code></p>
<p>物件使用上和 <code>Map</code> 可以是一樣的</p>
<p>前提是</p>
<ul>
<li>可能會或是不會 新增/刪除 參數的鰎值</li>
<li>值可以被 動態/計算 鍵值 瀏覽</li>
<li>值得型態都是一樣</li>
</ul>
<p>這時候可以利用 <code>Js.Dict</code>  來綁定這個 Javascript 物件</p>
<p>你可以就像 Javascript 中的 Object 來做操作</p>
<p><code>Js.Dict.keys</code> 來取得所有的鍵值</p>
<p><code>Js.Divt.values</code> 來取得所有的值</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let myMap = Js.Dict.empty();</span><br><span class="line"></span><br><span class="line">Js.Dict.set(myMap, &quot;Allison&quot;, 10);</span><br><span class="line"></span><br><span class="line">[@bs.val] external studentAge: Js.Dict.t(int) = &quot;student&quot;;</span><br><span class="line"></span><br><span class="line">switch (Js.Dict.get(studentAge, &quot;Joe&quot;)) &#123;</span><br><span class="line">| None =&gt; Js.log(&quot;Joe can&apos;t be found&quot;)</span><br><span class="line">| Some(age) =&gt; Js.log(&quot;Joe is &quot; ++ string_of_int(age));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>轉譯後的結果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myMap = &#123; &#125;;</span><br><span class="line"></span><br><span class="line">myMap[<span class="string">"Allison"</span>] = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> match = student[<span class="string">"Joe"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (match !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Joe is "</span> + <span class="built_in">String</span>(match));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Joe can't be found"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以看到其實 <code>Js.Dict</code> 是基於 Javascript 的物件</p>
<p>整個 API 都沒有使用到 <code>external</code> 所以在編譯之後 整個 API 都會消失</p>
<p>編譯結果中你也找不到 <code>Dict</code> 的相關字</p>
<p>這很便於你將 Js 檔案轉為 BuckleScript 檔案</p>
<h3 id="Record-模式"><a href="#Record-模式" class="headerlink" title="Record 模式"></a>Record 模式</h3><p>如果你的 Js 物件:</p>
<ul>
<li>有固定並且已知的欄位</li>
<li>包含的值有不同的型別</li>
</ul>
<p>這時候大多數的程式語言中 你都可以使用 <code>Record</code></p>
<h4 id="例如"><a href="#例如" class="headerlink" title="例如:"></a>例如:</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"John"</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="string">"Allison"</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="string">"Jimmy"</span>: <span class="number">15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: <span class="string">"John"</span>,</span><br><span class="line">  age: <span class="number">10</span>,</span><br><span class="line">  job: <span class="string">"CEO"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>的不同</p>
<p>前者會使用 <code>雜湊表</code> 的型態來處理</p>
<p>後者會使用 <code>Record</code> 來處理</p>
<p>而在 BuckleScript 中要使用 <code>bs.deriving abstract</code> 功能</p>
<p>後者則會這樣寫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[@bs.deriving abstract]</span><br><span class="line">type person = &#123;</span><br><span class="line">  name: string,</span><br><span class="line">  age: int,</span><br><span class="line">  job: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[@bs.val] external john: person = &quot;john&quot;;</span><br></pre></td></tr></table></figure>
<p><strong>note</strong> <code>person</code> 並不是一個 <code>Record</code> 的型別</p>
<p>他只是看起來像是 <code>Record</code> 的型別</p>
<p>而且可以使用 <code>Record</code> 的形態檢查</p>
<p><code>bs.deriving abstract</code> 就是在註解將 <code>person</code> 轉為 抽象型別</p>
<h5 id="建立"><a href="#建立" class="headerlink" title="建立"></a>建立</h5><p>上述的抽象型別因為不是 <code>Record</code> 型別</p>
<p>所以不能直接使用型態的方式來建立</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[@bs.deriving abstract]</span><br><span class="line">type person = &#123;</span><br><span class="line">  name: string,</span><br><span class="line">  age: int,</span><br><span class="line">  job: string,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let joe = person(~name=&quot;Joe&quot;, ~age=20, ~job=&quot;teacher&quot;)</span><br></pre></td></tr></table></figure>
<p>轉譯後的結果<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated by BUCKLESCRIPT VERSION 4.0.5, PLEASE EDIT WITH CARE</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> joe = &#123;</span><br><span class="line">  name: <span class="string">"Joe"</span>,</span><br><span class="line">  age: <span class="number">20</span>,</span><br><span class="line">  job: <span class="string">"teacher"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.joe = joe;</span><br><span class="line"><span class="comment">/* No side effect */</span></span><br></pre></td></tr></table></figure></p>
<p>結果對於運行並不會有成本</p>
<h5 id="欄位重新命名"><a href="#欄位重新命名" class="headerlink" title="欄位重新命名"></a>欄位重新命名</h5><p>有時候在綁定 JS object 的時候，欄位名稱在 BuckleScript/Reason 中是無效的名稱</p>
<p>有兩種範例 一個是 <code>{type: &quot;foo&quot;}</code> (BS/Reason 中的保留字) 和 <code>{&quot;aria-checked&quot;: true}</code></p>
<p>可以選擇另一個有效的名稱 使用 <a href="mailto:`@bs.as" target="_blank" rel="noopener">`@bs.as</a>` 來規避這個問題</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[@bs.deriving abstract]</span><br><span class="line">type data = &#123;</span><br><span class="line">  [@bs.as &quot;type&quot;] type_: string,</span><br><span class="line">  [@bs.as &quot;aria-checked&quot;] ariaLabel: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let d = data(~type_=&quot;message&quot;, ~ariaLabel=&quot;hello&quot;);</span><br></pre></td></tr></table></figure>
<p>輸出會是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = &#123;</span><br><span class="line">  type: <span class="string">"message"</span>,</span><br><span class="line">  <span class="string">"aria-checked"</span>: <span class="string">"hello"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="可選的標籤"><a href="#可選的標籤" class="headerlink" title="可選的標籤"></a>可選的標籤</h6><p>可以建立可忽略的 欄位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[[@bs.deriving abstract]</span><br><span class="line">type person = &#123;</span><br><span class="line">  [@bs.optional] name: string,</span><br><span class="line">  age: int,</span><br><span class="line">  job: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let joe = person(~age=19, ~job=&quot;sleep&quot;, ());</span><br><span class="line">Js.log(joe);</span><br></pre></td></tr></table></figure>
<p>編譯後會是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Js_primitive = <span class="built_in">require</span>(<span class="string">"bs-platform/lib/js/js_primitive.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">joe</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span> (<span class="params">param$<span class="number">1</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> prim = param;</span><br><span class="line">      <span class="keyword">var</span> prim$<span class="number">1</span> = <span class="number">19</span>;</span><br><span class="line">      <span class="keyword">var</span> prim$<span class="number">2</span> = <span class="string">"sleep"</span>;</span><br><span class="line">      <span class="keyword">var</span> tmp = &#123;</span><br><span class="line">        age: prim$<span class="number">1</span>,</span><br><span class="line">        job: prim$<span class="number">2</span></span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span> (prim !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        tmp.name = Js_primitive.valFromOption(prim);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(joe);</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>name</code> 會是可選的，若是沒有也不會造成錯誤</p>
<p><strong>note:bs.optional 只是將  name 改為可選，但是如果輸入 Option(string) 不會有作用</strong></p>
<h5 id="Accessors"><a href="#Accessors" class="headerlink" title="Accessors"></a>Accessors</h5><p>當你使用 <code>bs.deriving abstract</code> 隱含了 recode 的型態，你無法使用 <code>joe.age</code> 這樣的方式來取得值</p>
<p>原生會提供 <code>getter</code> 和 <code>setter</code> 來完成這個</p>
<h6 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h6><p>每一個 <code>bs.deriving abstract</code> 欄位 都會有一個 <code>getter function</code> </p>
<p>在上面的範例中會有三個 <code>getter function</code> ，<code>nameGet</code>, <code>ageGet</code>, <code>jobGet</code></p>
<p>他們會取得 <code>person</code> 的值並分別回傳 <code>string</code>, <code>int</code>, <code>string</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[@bs.deriving abstract]</span><br><span class="line">type person = &#123;</span><br><span class="line">  [@bs.optional] name: string,</span><br><span class="line">  age: int,</span><br><span class="line">  job: string,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let joe = person(~age=20, ~job=&quot;teacher&quot;, ());</span><br><span class="line"></span><br><span class="line">let twenty = ageGet(joe);</span><br><span class="line">Js.log(twenty);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">也可以寫成這樣</span><br><span class="line">joe-&gt; ageGet-&gt; Js.log</span><br><span class="line">**/</span><br></pre></td></tr></table></figure>
<p>至於改值則是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[@bs.deriving abstract]</span><br><span class="line">type person = &#123;</span><br><span class="line">  [@bs.optional] name: string,</span><br><span class="line">  mutable age: int,</span><br><span class="line">  job: string,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let joe = person(~age=20, ~job=&quot;teacher&quot;, ());</span><br><span class="line"></span><br><span class="line">joe-&gt; ageGet-&gt; Js.log; /* 20 */</span><br><span class="line">joe-&gt; ageSet(21)-&gt; Js.log;</span><br><span class="line">joe-&gt; ageGet-&gt; Js.log; /* 21 */</span><br></pre></td></tr></table></figure>
<p><strong>note: 要記得將需要修改的參數前面加上 <code>mutable</code></strong></p>
<h5 id="Object-Methods"><a href="#Object-Methods" class="headerlink" title="Object Methods"></a>Object Methods</h5><p>可以附加任何<code>function</code> 在類型上(任何類型的 record 不僅止於 <a href="mailto:`@bs.deriving" target="_blank" rel="noopener">`@bs.deriving</a> abtract`)</p>
<p>可以參閱 <a href="https://bucklescript.github.io/docs/zh-TW/function#object-method" target="_blank" rel="noopener">Object Method</a></p>
<p>這部分之後會再討埨</p>
<h5 id="可變性"><a href="#可變性" class="headerlink" title="可變性"></a>可變性</h5><p>Test.re</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[@bs.deriving abstract]</span><br><span class="line">type cord = &#123;</span><br><span class="line">  [@bs.optional] mutable x: int,</span><br><span class="line">  y: int,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Test.rei</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[@bs.deriving abstract]</span><br><span class="line">type cord = &#123;</span><br><span class="line">  [@bs.optional] x: int,</span><br><span class="line">  y: int,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Object2"><a href="#Object2" class="headerlink" title="Object2"></a>Object2</h3><p>如果上述的 Object 並不符合您的需求 </p>
<p>也有另外一種方式可以綁定 <code>Javascript Object</code></p>
<p>有幾個前提</p>
<ul>
<li>你不想要預先宣告 <code>type</code></li>
<li>你希望你的 Object 是有結構性的</li>
</ul>
<p>Ex: 你的類型希望可以接受所有含有 <code>age</code> 這個參數的物件，而不是只有特定參數的物件</p>
<h4 id="陷阱"><a href="#陷阱" class="headerlink" title="陷阱"></a>陷阱</h4><p><strong>note: 不能使用普通的 Reason/OCaml 的物件類型，如下</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;</span><br><span class="line">  .</span><br><span class="line">  name: string,</span><br><span class="line">  age: int,</span><br><span class="line">  job: string</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>你仍然可以宣告這個類型</p>
<p>但是無法編譯成功</p>
<p>因為 <code>Reason/OCaml</code> 的對象工作方式是不一樣的</p>
<h4 id="解決方案"><a href="#解決方案" class="headerlink" title="解決方案"></a>解決方案</h4><p>BuckleScript 利用 <code>Js.t</code> 來做包裝類型</p>
<p>以便控制和追蹤可以編譯成 Javascript 的對象子集合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type person = Js.t(&#123;</span><br><span class="line">  .</span><br><span class="line">  name: string,</span><br><span class="line">  age: int,</span><br><span class="line">  job: string</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let john = &#123;&quot;name&quot;: &quot;john&quot;, &quot;age&quot;: 11&#125;;</span><br><span class="line"></span><br><span class="line">john##name -&gt; Js.log;</span><br></pre></td></tr></table></figure>
<p>從現在開始 BuckleScript 都會以 <code>Js.t</code> 來消除跟 一般物件 和 Javascript 物件的歧義</p>
<p>因為 Reason 有包覆一層語法糖 會將 <code>Js.t({. name: string})</code> 轉為 <code>{. &quot;name&quot;: string}</code></p>
<h4 id="訪問-與-修改"><a href="#訪問-與-修改" class="headerlink" title="訪問 與 修改"></a>訪問 與 修改</h4><h5 id="取值-1"><a href="#取值-1" class="headerlink" title="取值"></a>取值</h5><p>要取得值的話方法為 <code>##</code></p>
<p>範例如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">type person = Js.t(&#123;</span><br><span class="line">  .</span><br><span class="line">  name: string,</span><br><span class="line">  age: int,</span><br><span class="line">  job: string</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let john = &#123;</span><br><span class="line">  &quot;name&quot;: &quot;john&quot;,</span><br><span class="line">  &quot;age&quot;: 11,</span><br><span class="line">  &quot;job&quot;: &quot;development&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let johnName = john##name;</span><br></pre></td></tr></table></figure>
<p>明天再來談談 <code>Some</code> 和 <code>Option</code> 的問題</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-BuckleScript-Best-Friend" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/14/BuckleScript-Best-Friend/" class="article-date">
      <time datetime="2018-10-14T15:16:34.000Z" itemprop="datePublished">2018-10-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/14/BuckleScript-Best-Friend/">BuckleScript-Best-Friend</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="BuckleScript"><a href="#BuckleScript" class="headerlink" title="BuckleScript"></a>BuckleScript</h1><h2 id="OCaml"><a href="#OCaml" class="headerlink" title="OCaml"></a>OCaml</h2><p><code>BuckleScript</code> 的基礎</p>
<p>如果需要對 OCaml 有興趣可以參考 <a href="https://realworldocaml.org/" target="_blank" rel="noopener">官方文件</a></p>
<p>如果對 Reason 有興趣可以參考 <a href="https://reasonml.github.io/" target="_blank" rel="noopener">官方文件</a></p>
<h2 id="Reason"><a href="#Reason" class="headerlink" title="Reason"></a>Reason</h2><p>OCaml 的另一種語法，對 <code>Javascript</code> 的開發者比較親切</p>
<h2 id="OPAM"><a href="#OPAM" class="headerlink" title="OPAM"></a>OPAM</h2><p>官方的套件管理， 自從 <code>BuckleScript</code> 支援 NPM/YARN 之後就不需要使用他了</p>
<h2 id="External-Interop-FFI"><a href="#External-Interop-FFI" class="headerlink" title="External/Interop/FFI"></a>External/Interop/FFI</h2><p>都是 <code>BuckleScript &lt;-&gt; JavaScript</code> 交互編譯的術語</p>
<ul>
<li>External - 在 <code>BuckleScript</code> 中使用 JS 值得一種方式</li>
<li>Interop - interoperability 的縮寫</li>
<li>FFI - <code>Foreign Function Interface</code> 的縮寫, “external”, “wrapper” 和 “interop” 的通用術語, 基本上就是在一個語言中呼叫另一個語言的值</li>
</ul>
<table>
<thead>
<tr>
<th>值</th>
<th>bs</th>
<th>意義</th>
</tr>
</thead>
<tbody>
<tr>
<td>val</td>
<td>[@bs.val]</td>
<td>global value</td>
</tr>
<tr>
<td>scope</td>
<td>[@bs.scope]</td>
<td>use names as a namespace</td>
</tr>
<tr>
<td>new</td>
<td>[@bs.new]</td>
<td>new constructor</td>
</tr>
<tr>
<td>module</td>
<td>[@bs.module]</td>
<td>從某一個 mobule 綁定其中一個值</td>
</tr>
<tr>
<td>send</td>
<td>@bs.send</td>
<td>function chaining</td>
</tr>
<tr>
<td>send.pipe</td>
<td>@bs.send.pipe</td>
<td>function chaining includes parameters</td>
</tr>
<tr>
<td>splice</td>
<td>[@bs.splice]</td>
<td>具有不定長度參數的函式</td>
</tr>
</tbody>
</table>
<p><strong>note:這只是一小部分</strong></p>
<h3 id="使用場景"><a href="#使用場景" class="headerlink" title="使用場景"></a>使用場景</h3><ul>
<li>在 <code>Reason</code> 中直接寫 Javascript</li>
<li>引用 js lib 使用 (global, default, other libs)</li>
<li>使用現有 <code>Bucklescript</code> 所提供的lib</li>
</ul>
<h3 id="原生-Javascript"><a href="#原生-Javascript" class="headerlink" title="原生 Javascript"></a>原生 Javascript</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[%%raw &quot;var a = 1, b = 2&quot;];</span><br><span class="line">let add = [%raw &quot;a + b&quot;];</span><br><span class="line">let myFunction = [%raw &quot;(a, b) =&gt;  a + b&quot;]</span><br><span class="line">Js.log(myFunction(1)(2));</span><br></pre></td></tr></table></figure>
<h3 id="字串-Unicode-和-template-string"><a href="#字串-Unicode-和-template-string" class="headerlink" title="字串 Unicode 和 template string"></a>字串 Unicode 和 template string</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Js.log(&#123;js|你好，</span><br><span class="line">世界|js&#125;);</span><br><span class="line"></span><br><span class="line">let world = &quot;world&quot;;</span><br><span class="line">let helloWorld = &#123;j|hello, $world|j&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="全域變數"><a href="#全域變數" class="headerlink" title="全域變數"></a>全域變數</h3><p><strong>note: 先看看官方是否有先幫你完成的 <a href="https://reasonml.github.io/api/index.html" target="_blank" rel="noopener">API</a> 再決定是否要自己處理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[@bs.val] external setTimeout/* 在 Reason 中使用的模組名稱 */: (unit =&gt; unit, int) =&gt; float = &quot;setTimeout&quot;;/* 對應到 Javascript 中的模組名稱 */</span><br><span class="line"></span><br><span class="line">let eventId = setTimeout(() =&gt; Js.log(&quot;hello setTimeout&quot;), 1000);</span><br><span class="line">Js.log(eventId);</span><br></pre></td></tr></table></figure>
<h3 id="function-chaining"><a href="#function-chaining" class="headerlink" title="function chaining"></a>function chaining</h3><p>亦或是利用 <code>map</code> 和 <code>filter</code> 做一些陣列處理的時候</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[@bs.send] external map: (array(&apos;a), &apos;a =&gt; &apos;b) =&gt; array(&apos;b) = &quot;&quot;;</span><br><span class="line">[@bs.send] external filter: (array(&apos;a), &apos;a =&gt; &apos;b) =&gt; array(&apos;b) = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">let mapResult = map([|1, 2, 3|], a =&gt; a + 1);</span><br><span class="line">let result = filter(mapResult, a =&gt; a mod 2 === 0);</span><br><span class="line">Js.log(result);</span><br></pre></td></tr></table></figure>
<p>上面的範例 <code>map</code> 和 <code>filter</code> 為什麼要使用 <code>send</code> 呢？</p>
<p>也有另外一個比較漂亮的做法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[@bs.send] external map: (array(&apos;a), &apos;a =&gt; &apos;b) =&gt; array(&apos;b) = &quot;&quot;;</span><br><span class="line">[@bs.send] external filter: (array(&apos;a), &apos;a =&gt; &apos;b) =&gt; array(&apos;b) = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">[|1, 2, 3|]</span><br><span class="line">-&gt;map(a =&gt; a+1)</span><br><span class="line">-&gt;filter(a =&gt; a mod 2 === 0)</span><br><span class="line">-&gt;Js.log</span><br></pre></td></tr></table></figure>
<p>但是這部分之後再探討</p>
<h3 id="全域模組"><a href="#全域模組" class="headerlink" title="全域模組"></a>全域模組</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[@bs.val] [@bs.scope &quot;Math&quot;] external random: unit =&gt; float = &quot;random&quot;;</span><br><span class="line">let someNumber = random();</span><br><span class="line">/**/</span><br><span class="line"></span><br><span class="line">/* front end demo */</span><br><span class="line">[@bs.val] [@bs.scope (&quot;window&quot;, &quot;location&quot;, &quot;ancestorOrigins&quot;)] external length: int = &quot;length&quot;;</span><br></pre></td></tr></table></figure>
<h4 id="可空值"><a href="#可空值" class="headerlink" title="可空值"></a>可空值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let a = Some(5);</span><br><span class="line">let b = None;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let JsNullable = Js.Nullable.null;</span><br><span class="line">let JsUndefined = Js.Nullable.undefined;</span><br><span class="line"></span><br><span class="line">let result1: Js.Nullable.t(string) = Js.Nullable.return(&quot;hello&quot;); /* hello */</span><br><span class="line">let result2: Js.Nullable.t(int) = Js.Nullable.fromOption(Some(10)); /* 10 */</span><br><span class="line">let result3: option(int) = Js.Nullable.toOption(Js.Nullable.return(10)); /* 10 */</span><br></pre></td></tr></table></figure>
<p>這一部份在後續章節也會做更詳細的討論</p>
<h4 id="模組"><a href="#模組" class="headerlink" title="模組"></a>模組</h4><h5 id="預設輸出-ES6"><a href="#預設輸出-ES6" class="headerlink" title="預設輸出 ES6"></a>預設輸出 ES6</h5><p>LeftPad.re<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let default = (name: string, age: int) =&gt; Js.log(&#123;j|$name 年紀 $age|j&#125;);</span><br></pre></td></tr></table></figure></p>
<h5 id="Import-Module"><a href="#Import-Module" class="headerlink" title="Import Module"></a>Import Module</h5><p>ImportModule.re<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;./LeftPad.bs&quot;] external leftPad : (string, int) =&gt; string = &quot;default&quot;;</span><br><span class="line"></span><br><span class="line">leftPad(&quot;hello&quot;, 123);</span><br></pre></td></tr></table></figure></p>
<p>因為 <code>bsconfig.js</code> 中的 <code>suffix</code> 設定為 <code>.bs.js</code></p>
<p>所以當我們要 import 的時候需要加上 .bs</p>
<p>他編譯後的結果會是<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LeftPadBs = <span class="built_in">require</span>(<span class="string">"./LeftPad.bs"</span>);</span><br><span class="line"></span><br><span class="line">LeftPadBs.default(<span class="string">"hello"</span>, <span class="number">123</span>);</span><br></pre></td></tr></table></figure></p>
<p>否則會找不到這個檔案</p>
<h5 id="Global-Module"><a href="#Global-Module" class="headerlink" title="Global Module"></a>Global Module</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;path&quot;] external dirname: string =&gt; string = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">Js.log(dirname(&quot;/foo/bar/baz/asdf/quux&quot;));</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Path.dirname(<span class="string">"/foo/bar/baz/asdf/quux"</span>));</span><br></pre></td></tr></table></figure>
<p><a href="mailto:`@bs.module" target="_blank" rel="noopener">`@bs.module</a>` 會將模組引入</p>
<p><code>external</code> 則是指定輸出的名稱 (在<code>Reason</code> 使用的名稱)</p>
<p>最後則是要引入的名稱，但是如果同名則可以設為空字串</p>
<h4 id="參數長度可變"><a href="#參數長度可變" class="headerlink" title="參數長度可變"></a>參數長度可變</h4><p>使用 module <code>path</code> 中的 <code>join</code> 來做 demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[@bs.module &quot;path&quot;] [@bs.splice]</span><br><span class="line">external join : array(string) =&gt; string = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">Js.log(join([|&quot;/&quot;, &quot;hello&quot;, &quot;/&quot;, &quot;world&quot;|]));</span><br></pre></td></tr></table></figure>
<p><code>bs.module</code> 先指定來源 <code>path</code></p>
<p>再加上 <code>bs.splice</code> 來告訴 <code>Reason</code> 他是一個具有不固定長度參數的 function</p>
<p>利用 <code>array</code> 的 長度是彈性的優點來做彈性的多參數處理</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BuckleScript/">BuckleScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason-BasicTypeIII" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/11/Reason-BasicTypeIII/" class="article-date">
      <time datetime="2018-10-11T03:24:09.000Z" itemprop="datePublished">2018-10-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/11/Reason-BasicTypeIII/">Reason-BasicTypeIII</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Basic-Type"><a href="#Basic-Type" class="headerlink" title="Basic Type"></a>Basic Type</h1><p>今天討論的東西會也很多(每天啃到天荒地老)</p>
<ul>
<li>Reason - Record</li>
<li>Reason - Object</li>
<li>Reason - Destructuring</li>
</ul>
<h2 id="Reason-Record"><a href="#Reason-Record" class="headerlink" title="Reason - Record"></a>Reason - Record</h2><p>Reason - <code>Record</code> 很像 Javascript 的 Object</p>
<p>但是他有幾個特性</p>
<ul>
<li>更輕量</li>
<li>預設是不可改變的 (Immutable)</li>
<li>欄位名稱和型別都是固定的</li>
<li>很快</li>
<li>是較嚴格的類別</li>
</ul>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;</span><br><span class="line">  age: int,</span><br><span class="line">  name: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomas = &#123;</span><br><span class="line">  age: 35,</span><br><span class="line">  name: &quot;Tomas Lin&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomasName = tomas.name;</span><br><span class="line">print_endline(tomasName); /* Tomas Lin */</span><br></pre></td></tr></table></figure>
<h3 id="需要明確的定義類型跟結構"><a href="#需要明確的定義類型跟結構" class="headerlink" title="需要明確的定義類型跟結構"></a>需要明確的定義類型跟結構</h3><p>Record 需要先宣告一個基本的結構 (Type)</p>
<p>否則會報錯</p>
<p>如果符合則會自動型別推導</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;</span><br><span class="line">  age: int,</span><br><span class="line">  name: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomas: person = &#123;</span><br><span class="line">  age: 35,</span><br><span class="line">  name: &quot;Tomas Lin&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomasName = tomas.name;</span><br><span class="line">print_endline(tomasName);</span><br><span class="line">let simon = &#123;</span><br><span class="line">  age: 22,</span><br><span class="line">  name: &quot;Simon&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面的範例中 <code>tomas</code> 有指定型別是 <code>person</code></p>
<p>但是 <code>simon</code> 並未指定，可是因為他的結構和 <code>person</code> 一樣</p>
<p>所以 Reason 會自動做型別推導為 <code>person</code></p>
<p><strong>note:若是有兩個同樣型別結構的話則會依據較近的型別</strong></p>
<p>你也可以將型別宣告在別的檔案中</p>
<p>但是需要明確的指定名稱</p>
<p><code>AnimalType.re</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type cat = &#123;color: string, call: string&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>Animal.re</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let whiteCat: AnimalType.cat = &#123;</span><br><span class="line">  color: &quot;white&quot;,</span><br><span class="line">  call: &quot;喵!&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">print_endline(whiteCat.call);</span><br></pre></td></tr></table></figure></p>
<h3 id="Spread-修改-immutable-update"><a href="#Spread-修改-immutable-update" class="headerlink" title="Spread 修改 (immutable update)"></a>Spread 修改 (immutable update)</h3><p>因為 <code>Record</code> 是不可以直接修改的</p>
<p>可以利用 <code>Spread</code> 來做修改的實作</p>
<p>範例如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;</span><br><span class="line">  age: int,</span><br><span class="line">  name: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomas: person = &#123;</span><br><span class="line">  age: 35,</span><br><span class="line">  name: &quot;Tomas Lin&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomasName = tomas.name;</span><br><span class="line">print_endline(tomasName);</span><br><span class="line">let simon = &#123;</span><br><span class="line">  age: 22,</span><br><span class="line">  name: &quot;Simon&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomasNextYear = &#123;...tomas, age: tomas.age + 1&#125;;</span><br><span class="line"></span><br><span class="line">Js.log(tomasNextYear.age);/* 36 */</span><br></pre></td></tr></table></figure>
<p><strong>注意:Spread修改不能夠增加新的欄位</strong></p>
<h3 id="mutable-update"><a href="#mutable-update" class="headerlink" title="mutable update"></a>mutable update</h3><p><code>Reason</code> 也保有直接修改的彈性</p>
<p>範例如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;</span><br><span class="line">  age: int,</span><br><span class="line">  mutable name: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomas: person = &#123;</span><br><span class="line">  age: 25,</span><br><span class="line">  name: &quot;Tomas Lin&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let name = &quot;Simon&quot;;</span><br><span class="line"></span><br><span class="line">let simon = &#123;</span><br><span class="line">  age: 25,</span><br><span class="line">  name</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">tomas.age = tomas.age + 1;</span><br><span class="line"></span><br><span class="line">Js.log(tomas.age); /* 26 */</span><br><span class="line">Js.log(simon.name); /* Simon */</span><br></pre></td></tr></table></figure>
<p>也支援 <code>punning</code> 簡化程式碼</p>
<h3 id="不能用-Record-處理的問題"><a href="#不能用-Record-處理的問題" class="headerlink" title="不能用 Record 處理的問題"></a>不能用 Record 處理的問題</h3><p> <code>Reason</code> 中你無法宣告一個 <code>function</code> 他的參數傳入一個物件</p>
<p> 這個物件中必要參數是 <code>age</code></p>
<p> 而其他參數都是可以變動的</p>
<p> 範例如下</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;age: int, name: string&#125;;</span><br><span class="line">type monster = &#123;age: int, hasTentacles: bool&#125;;</span><br><span class="line"></span><br><span class="line">let getAge = (entity) =&gt; entity.age;</span><br><span class="line">let kraken = &#123;age: 9999, hasTentacles: true&#125;;</span><br><span class="line">let me = &#123;age: 5, name: &quot;Baby Reason&quot;&#125;;</span><br><span class="line"></span><br><span class="line">getAge(kraken);</span><br><span class="line">getAge(me); </span><br><span class="line">  /* get Error:</span><br><span class="line">    This has type:</span><br><span class="line">      person</span><br><span class="line">    But somewhere wanted:</span><br><span class="line">      monster  */</span><br></pre></td></tr></table></figure>
<p>Type system 不能定義一個類型是 <code>person</code> 或 <code>monster</code></p>
<p>當你有這類型需求的話</p>
<p>接下來介紹的 <code>Reason - Object</code> 可以滿足</p>
<h2 id="Reason-Object"><a href="#Reason-Object" class="headerlink" title="Reason - Object"></a>Reason - Object</h2><p>有些時候 <code>Reason - Record</code> 無法滿足一些特殊情境的需求</p>
<p>所以便有了 <code>Reason - Object</code> 增加一些彈性</p>
<h3 id="型別"><a href="#型別" class="headerlink" title="型別"></a>型別</h3><p>物件不一定要宣告型別</p>
<p>看起來和 <code>Reason - Record</code> 十分相似</p>
<p>除了 <code>.</code> 和 <code>..</code></p>
<p>範例如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type tesla = &#123;</span><br><span class="line">  .</span><br><span class="line">  color: string</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>開頭 <code>.</code> 代表這是一個閉鎖的物件</p>
<p>任何基於這個型別的物件都必須完全符合結構</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type car(`a) = &#123;</span><br><span class="line">  ..</span><br><span class="line">  color: string</span><br><span class="line">&#125; as `a;</span><br></pre></td></tr></table></figure>
<p>開頭 <code>..</code> 則代表這是開放型的物件，所以可以包含其他值或 <code>function</code></p>
<p>開放型的物件代表是多型</p>
<p>所以需要一個參數</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><h4 id="Simple"><a href="#Simple" class="headerlink" title="Simple"></a>Simple</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">type tesla = &#123;</span><br><span class="line">  .</span><br><span class="line">  color: string,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let obj: tesla = &#123;</span><br><span class="line">  val red = &quot;Red&quot;;</span><br><span class="line">  pub color = red;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Js.log(obj#color) /* &quot;Red&quot; */</span><br></pre></td></tr></table></figure>
<p>在這個物件中含有兩個屬性</p>
<p>私有屬性 <code>red</code> 和 <code>color</code> method</p>
<p>因為 <code>color</code> 是一個公開的 method</p>
<p>所以我們可以利用 <code>object notation</code> 來標記取得值</p>
<p><strong>物件只導出Method，所有屬性都是Private的</strong></p>
<h4 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type tesla = &#123;.</span><br><span class="line">  drive: (int) =&gt; int</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let obj: tesla = &#123;</span><br><span class="line">  val hasEnvy = ref(false);</span><br><span class="line">  pub drive = (speed) =&gt; &#123;</span><br><span class="line">    this#enableEnvy(true);</span><br><span class="line">    speed;</span><br><span class="line">  &#125;;</span><br><span class="line">  pri enableEnvy = (envy) =&gt; hasEnvy := envy</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在這個範例中 <code>tesla</code> 中一個公開的 <code>drive</code> 也有一個私有的 <code>enableEnvy</code> method</p>
<p>私有的 method 只可以在物件內部取用</p>
<p>Reason 也有 <code>this</code> 和 Javascript 的 <code>this</code> 不一樣的地方在於</p>
<p>Reason 的 <code>this</code> 永遠都會指向物件本身</p>
<h4 id="開放式物件的範例"><a href="#開放式物件的範例" class="headerlink" title="開放式物件的範例"></a>開放式物件的範例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">type tesla(&apos;a) = &#123;</span><br><span class="line">  ..</span><br><span class="line">  drive: int =&gt; int</span><br><span class="line">&#125; as &apos;a;</span><br><span class="line"></span><br><span class="line">type teslaParams = &#123;.</span><br><span class="line">  drive: int =&gt; int,</span><br><span class="line">  doYouWant: unit =&gt; bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let obj: tesla(teslaParams) = &#123;</span><br><span class="line">  val hasEnvy = ref (false);</span><br><span class="line">  pub drive = (speed) =&gt; &#123;</span><br><span class="line">    this#enableEnvy(true);</span><br><span class="line">    speed;</span><br><span class="line">  &#125;;</span><br><span class="line">  pub doYouWant = () =&gt; hasEnvy^;</span><br><span class="line">  pri enableEnvy = (envy) =&gt; hasEnvy := envy</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Js.log(obj#doYouWant());</span><br><span class="line">Js.log(obj#drive(11));</span><br><span class="line">Js.log(obj#doYouWant());</span><br></pre></td></tr></table></figure>
<p>上面的 <code>tesla</code> 中為開放型物件</p>
<p>但是需要有一個參數 <code>teslaParams</code> 定義所有開放的的 <code>method</code></p>
<p>但是如果你要找由 <code>Javascript</code> 的物件，你需要的不是 <code>Reason - Object</code></p>
<p>而是特別的 <code>BukleScript - Record</code> <a href="https://bucklescript.github.io/docs/en/object.html#record-mode" target="_blank" rel="noopener">special Record</a></p>
<h2 id="Reason-Destructuring-解構"><a href="#Reason-Destructuring-解構" class="headerlink" title="Reason - Destructuring (解構)"></a>Reason - Destructuring (解構)</h2><p>解構是很清楚簡單的方式來取得物件或陣列中的變數</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>下面綁定 <code>ten = 10</code> 和 <code>twenty = 20</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let someInts = (10, 20);</span><br><span class="line">let (ten, twenty) = someInts;</span><br><span class="line">Js.log(ten);</span><br><span class="line">Js.log(twenty);</span><br></pre></td></tr></table></figure>
<p>下列綁定變數 <code>name = &quot;Guy&quot;</code> 和 <code>age = 30</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;name: string, age: int&#125;;</span><br><span class="line">let somePerson: person = &#123;name: &quot;Tomas&quot;, age: 30&#125;;</span><br><span class="line">let &#123;name, age&#125; = somePerson;</span><br><span class="line">Js.log(name);</span><br><span class="line">Js.log(age);</span><br></pre></td></tr></table></figure>
<p>取回變數後可以重新命名 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;name: string, age: int&#125;;</span><br><span class="line">let somePerson: person = &#123;name: &quot;Tomas&quot;, age: 30&#125;;</span><br><span class="line">let &#123;name: n, age: a&#125; = somePerson;</span><br><span class="line">Js.log(n);</span><br><span class="line">Js.log(a);</span><br></pre></td></tr></table></figure>
<p>也可以定義型態</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;name: string, age: int&#125;;</span><br><span class="line">let somePerson: person = &#123;name: &quot;Tomas&quot;, age: 30&#125;;</span><br><span class="line">let &#123;name: (n: string), age: (a: int)&#125; = somePerson;</span><br><span class="line">Js.log(n);</span><br><span class="line">Js.log(a);</span><br></pre></td></tr></table></figure>
<p>當然函式的標籤式參數也可以解構</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">type person = &#123;</span><br><span class="line">  name: string,</span><br><span class="line">  age: int</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let tomas = &#123;name: &quot;Tomas&quot;, age: 25&#125;;</span><br><span class="line"></span><br><span class="line">let someFunction = (~person as &#123;name&#125;) =&gt; &#123;</span><br><span class="line">  Js.log(name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">let otherFunction = (~person as &#123;name&#125; as thePerson) =&gt; &#123;</span><br><span class="line">  Js.log(thePerson);</span><br><span class="line">  Js.log(name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">someFunction(~person=tomas);</span><br><span class="line">otherFunction(~person=tomas);</span><br></pre></td></tr></table></figure>
<h3 id="Mutable"><a href="#Mutable" class="headerlink" title="Mutable"></a>Mutable</h3><p>有時候我們會需要可以變更的變數</p>
<p>Reason 也有保留這部分的彈性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type total = ref(int);</span><br><span class="line">let x: total = ref(5);</span><br><span class="line">x := x^ + 1;</span><br><span class="line">Js.log(x); // 6</span><br></pre></td></tr></table></figure>
<p><code>ref</code> 只是一個語法糖</p>
<p>透過 <code>:=</code> 修改</p>
<p><code>^</code> 代表取出他的值</p>
<p>這樣就可以簡單地在 Reason 中使用 Mutation 的技巧</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason-BasicTypeII" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/10/Reason-BasicTypeII/" class="article-date">
      <time datetime="2018-10-10T15:49:54.000Z" itemprop="datePublished">2018-10-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/10/Reason-BasicTypeII/">Reason-BasicType Part-II</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Basic-Type"><a href="#Basic-Type" class="headerlink" title="Basic Type"></a>Basic Type</h1><p>上一章節已經有討論了幾種基本類型</p>
<p>這是今天要了解的幾種型態</p>
<ul>
<li>Function</li>
<li>Array</li>
<li>Tuple</li>
<li>List</li>
</ul>
<h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><p><code>Function</code> 在日常 coding 是相當常見與重要的部分</p>
<p><code>Reason</code> 中是以箭頭以及回傳表達式</p>
<p>以逗號隔開參數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let greet = (hello, name) =&gt; hello ++ &quot; &quot; ++ name;</span><br><span class="line">Js.log(greet(&quot;Hello&quot;, &quot;Tomas&quot;));</span><br></pre></td></tr></table></figure>
<h3 id="無參數"><a href="#無參數" class="headerlink" title="無參數"></a>無參數</h3><p>有時候 <code>Function</code> 中不需要傳入參數</p>
<p>這裡稱為 <code>unit</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let sayHello = () =&gt; &quot;Hello&quot;;</span><br><span class="line">Js.log(sayHello()); /* Hello */</span><br></pre></td></tr></table></figure>
<h3 id="參數的標籤"><a href="#參數的標籤" class="headerlink" title="參數的標籤"></a>參數的標籤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let subNumber = (x, y) =&gt; &#123;</span><br><span class="line">  return x - y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Js.log(subNumber(1, 2)); /* 1 */</span><br></pre></td></tr></table></figure>
<p>這裡其實很難知道哪個是 <code>x</code>,  哪個是 <code>y</code></p>
<p>我們可以加上 <code>~</code> 這樣的話會變成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let subNumber = (~x, ~y) =&gt; &#123;</span><br><span class="line">  return x - y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Js.log(subNumber(~x=1, ~y=2));</span><br></pre></td></tr></table></figure>
<p>也可以利用 <code>as</code> 加上別名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let drawCircle = (~radius as r, ~color as c) =&gt; &#123;</span><br><span class="line">  setColor(c);</span><br><span class="line">  startAt(r, r);</span><br><span class="line">  /* ... */</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">drawCircle(~radius=10, ~color=&quot;red&quot;);</span><br></pre></td></tr></table></figure>
<p>事實上，(~radius) 只是 (~radius as radius) 的速寫法(稱之為 <code>雙關(punning)</code>)</p>
<h3 id="Optional-參數"><a href="#Optional-參數" class="headerlink" title="Optional 參數"></a>Optional 參數</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let saySomeThing = (~name, ~title) =&gt; &#123;</span><br><span class="line">  switch title &#123;</span><br><span class="line">  | None =&gt; &quot;Hello &quot; ++ name;</span><br><span class="line">  | Some(t_) =&gt; t_ ++ name;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Js.log(saySomeThing(~name=&quot;Tomas&quot;));</span><br></pre></td></tr></table></figure>
<p><code>title</code> 並不是一定要輸入的參數</p>
<p>如果為空預設值是 <code>None</code></p>
<p>利用 <code>switch</code> 來涵蓋相對的 回傳值</p>
<h2 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h2><p>在 <code>Javascript</code> 中並沒有 <code>Tuple</code> 的概念 而被整合在 <code>Array</code> 之中</p>
<p><code>Reason</code> 中的 Tuple 需要符合幾種特性</p>
<ul>
<li>不可變(immutable)</li>
<li>有順序性的</li>
<li>一開始就已經固定長度</li>
<li>允許包含不同的值</li>
</ul>
<p><strong>tuple 長度不會是 1。若長度為 1 就是值本身。</strong></p>
<h3 id="Pair-operations"><a href="#Pair-operations" class="headerlink" title="Pair operations"></a>Pair operations</h3><p>官方提供 <code>fst</code> 和 <code>snd</code> 來快速取得 <code>Tuple</code>中第一 二個值</p>
<p>若是要取得其他更多的值，可以多多利用解構</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type testTuple = (int, int, int);</span><br><span class="line">let test: testTuple = (1, 2, 3);</span><br><span class="line"></span><br><span class="line">let (_, second, _) = test;</span><br><span class="line"></span><br><span class="line">Js.log(second);/* 2 */</span><br><span class="line"></span><br><span class="line">/* Js.log(fst(test));  get compiler Error */</span><br><span class="line">type test2Tuple = (int, int);</span><br></pre></td></tr></table></figure>
<p>盡量在 <strong>區域性</strong> 使用 <code>Tuple</code>，若是有經常傳遞的需求則可以考慮使用 <code>record</code></p>
<p>而且 <code>Tuple</code> + <code>Switch</code> 是十分強大的應用，可以解決 <strong>category bug</strong> </p>
<p>因為 <code>Reason</code> 會強迫你列出 <strong>2*2=4</strong>的所有可能情況而不用使用 <code>if</code> <code>else</code> 來做處理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">switch (isWindowOpen, isDoorOpen) &#123;</span><br><span class="line">| (true, true) =&gt; &quot;window and door are open!&quot;</span><br><span class="line">| (true, false) =&gt; &quot;just window open&quot;</span><br><span class="line">| (false, true) =&gt; &quot;just door open&quot;</span><br><span class="line">| (false, false) =&gt; &quot;window and door are not open&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是總會有些時候必須要修改某個 <code>Tuple</code> 中的一個值</p>
<p>對 Reason 來說這就是一個新的 <code>Tuple</code> 範例如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let tuple1 = (1, 2);</span><br><span class="line">let tuple2 = (fst(tuple1), 4);</span><br><span class="line">Js.log(tuple2);</span><br></pre></td></tr></table></figure>
<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>包含的參數需要同型態</li>
<li>不可變的(immutable)</li>
<li>在陣列前面 <code>shift</code> 元素會效率很好</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let myList: list(int) = [1, 2, 3];</span><br><span class="line">let anotherList = [0, ...myList];</span><br></pre></td></tr></table></figure>
<p><code>myList</code> 的值不會被改變， antherList現在是 <code>[0, 1, 2, 3]</code></p>
<p>為什麼他的效能式常數而不是線性的?</p>
<p>因為在 <code>anotherList</code> 中的 <code>myList</code> 是 shared 的</p>
<p><strong>note:</strong> 但是並不允許 <code>[0, ...aList, ...bList]</code></p>
<p>你可以使用 <code>ListLabels.concat</code> 來實現</p>
<p><code>Reason</code> 提供了一些基本的 <a href="https://reasonml.github.io/api/List.html" target="_blank" rel="noopener">API</a></p>
<p>但是在使用的時候名稱是 <code>ListLabels</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let myList: list(int) = [1,2,3];</span><br><span class="line">let anotherList = [0, ...myList];</span><br><span class="line">Js.log(ListLabels.length(myList)); /* 3 */</span><br><span class="line">Js.log(ListLabels.length(anotherList)); /* 4 */</span><br></pre></td></tr></table></figure>
<h3 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h3><p>也可以搭配 <code>pattern matching</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let myList: list(int) = [1, 2];</span><br><span class="line">let message = </span><br><span class="line">  switch (myList) &#123;</span><br><span class="line">  | [] =&gt; &quot;This list is Empty&quot;</span><br><span class="line">  | [a, ...rest] =&gt; &quot;a: &quot; ++ string_of_int(a) ++ &quot; rest.length is &quot; ++ string_of_int(ListLabels.length(rest))</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">Js.log(message); /* a: 1 rest.length is 1 */</span><br></pre></td></tr></table></figure>
<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><h3 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h3><ul>
<li>可變的</li>
<li>快速的任意存取和修改</li>
<li>原生固定長度 (Javascript 彈性長度)</li>
</ul>
<p>前後需要使用 <code>[|</code> 和 <code>|]</code></p>
<p>可以使用 <a href="https://reasonml.github.io/api/Array.html" target="_blank" rel="noopener">Array</a> 和 <a href="https://reasonml.github.io/api/ArrayLabels.html" target="_blank" rel="noopener">ArrayLabels</a> 而針對 JS compiler 也可以使用 <a href="https://bucklescript.github.io/bucklescript/api/Js.Array.html" target="_blank" rel="noopener">Js.Array</a> API</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let arrayTest = [|&quot;hello&quot;, &quot;eeee&quot;, &quot;yo&quot;|];</span><br><span class="line"></span><br><span class="line">Js.log(arrayTest[0]);</span><br><span class="line"></span><br><span class="line">arrayTest[1] = &quot;gggg&quot;;</span><br><span class="line"></span><br><span class="line">Js.log(arrayTest[1]); /* gggg */</span><br></pre></td></tr></table></figure>
<p>如果要編譯 <code>Javascript</code> Reason 中的 <code>Array</code> 可以直接對應 Javascript 的 <code>Array</code></p>
<p>雖然在 Reason 中無法直接修改長度，可以利用 <code>Js.Array</code> 來修改</p>
<p>範例如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let array1 = [|0,2,3,4,5,6|];</span><br><span class="line">let array2 = Js.Array.copyWithin(~to_=3, array1);</span><br><span class="line">Js.log(array1);/* [ 0, 2, 3, 0, 2, 3 ] */</span><br><span class="line">Js.log(array2);/* [ 0, 2, 3, 0, 2, 3 ] */</span><br><span class="line">let array3 = Js.Array.push(1, array1);</span><br><span class="line">Js.log(array3);/* [ 0, 2, 3, 0, 2, 3, 1 ] */</span><br></pre></td></tr></table></figure>
<p>陣列在一般寫程式過程中扮演相當重要的一個角色</p>
<p>篇幅會太多</p>
<p>明天再來聊聊另一種基本型到 <code>Record</code> 和 <code>Object</code></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason-BasicType" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/03/Reason-BasicType/" class="article-date">
      <time datetime="2018-10-03T08:21:38.000Z" itemprop="datePublished">2018-10-03</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/03/Reason-BasicType/">Reason-BasicType</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Basic-Type"><a href="#Basic-Type" class="headerlink" title="Basic Type"></a>Basic Type</h1><p>在每個程式語言中都會有一些基本的型態</p>
<p><code>Reason</code> 屬於強型態的程式語言</p>
<p>這裡介紹的基本型態的變數型態有</p>
<ul>
<li>Boolean</li>
<li>數字</li>
<li>字串</li>
<li>字元</li>
</ul>
<h2 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h2><p><code>Type</code> 是 <code>Reason</code> 的亮點之一</p>
<p><code>let</code> 不一定需要宣告 類型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let score = 10;</span><br></pre></td></tr></table></figure>
<p>Reason 知道 <code>score</code> 是個 <code>int</code> 型別，透過其值 <code>10</code> 判斷出來。這個稱之為 <code>推斷(inference)</code></p>
<h2 id="變數宣告-Let-binding"><a href="#變數宣告-Let-binding" class="headerlink" title="變數宣告(Let binding)"></a>變數宣告(Let binding)</h2><p>在介紹變數型態之前要先介紹一下如何宣告變數</p>
<p><code>Reason</code> 中只有使用 <code>let</code> 來宣告變數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let a: string = &quot;hello&quot;;</span><br></pre></td></tr></table></figure>
<p>雖然在 <code>Reason</code> 中已經宣告，但是在編譯成功後依舊不會看到這個變數</p>
<p>因為當尚未使用到之前是不會產生在結果中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let a: string = &quot;hello&quot;;</span><br><span class="line">Js.log(a);</span><br></pre></td></tr></table></figure>
<p>但是當我們開始使用之後，編譯結果就會出現</p>
<p>Result:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated by BUCKLESCRIPT VERSION 4.0.5, PLEASE EDIT WITH CARE</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"></span><br><span class="line">exports.a = a;</span><br><span class="line"><span class="comment">/*  Not a pure module */</span></span><br></pre></td></tr></table></figure>
<p>另外 <code>Reason</code> 是屬於 <code>Block Scope</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (displayGreeting) &#123;</span><br><span class="line">  let message = &quot;Enjoying the docs so far?&quot;;</span><br><span class="line">  print_endline(message)</span><br><span class="line">&#125;;</span><br><span class="line">/*這裡不能呼叫 message*/</span><br></pre></td></tr></table></figure>
<p>也可以這樣處理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let message = &#123;</span><br><span class="line">  let part1 = &quot;hello&quot;;</span><br><span class="line">  let part2 = &quot;world&quot;;</span><br><span class="line">  part1 ++ &quot; &quot; ++ part2</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Js.log(message);</span><br></pre></td></tr></table></figure>
<p>這樣在外層會無法呼叫 <code>part1</code>, <code>part2</code></p>
<p>而 <code>message</code> 會等於 <code>part1 ++ &quot; &quot; ++ part2</code> 的字串組合</p>
<p>編譯後的結果會是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> message = <span class="string">"hello world"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message);</span><br><span class="line"></span><br><span class="line">exports.message = message;</span><br></pre></td></tr></table></figure>
<p>而且預設使用 <code>let</code> 宣告的變數都是 <code>Immutable</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let a: string = &quot;hello&quot;;</span><br><span class="line">a = &quot;hello world&quot;;</span><br></pre></td></tr></table></figure>
<p>這邊會得到一個錯誤訊息</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;&gt; Start compiling</span><br><span class="line">[1/1] Building src/Demo-HelloWorld.cmj</span><br><span class="line"></span><br><span class="line">  We've found a bug for you!</span><br><span class="line">  /Users/tomas/Documents/iThome/2018/hello-world/src/Demo.re 2:1-17</span><br><span class="line"></span><br><span class="line">  1 │ let a: string = <span class="string">"hello"</span>;</span><br><span class="line">  2 │ a = <span class="string">"hello world"</span>;</span><br><span class="line"></span><br><span class="line">  The value a is<span class="built_in"> not </span>an<span class="built_in"> instance </span>variable</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;&gt; Finish compiling(exit: 1)</span><br></pre></td></tr></table></figure>
<p>但是可以重複使用 <code>let</code> 宣告同一個變數</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let message = &quot;hello&quot;;</span><br><span class="line">Js.log(message); /* Prints &quot;hello&quot; */</span><br><span class="line">let message = &quot;bye&quot;;</span><br><span class="line">Js.log(message); /* Prints &quot;bye&quot; */</span><br></pre></td></tr></table></figure>
<h2 id="Type-system"><a href="#Type-system" class="headerlink" title="Type system"></a>Type system</h2><p>雖然 <code>Reason</code> 是屬於強型態，但是也有留一些彈性</p>
<p>若你沒有宣告變數型態的時候，他會自動進行型態推導</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let a = &quot;1&quot;;</span><br><span class="line"></span><br><span class="line">let b = a ++ &quot;hello&quot;;</span><br><span class="line"></span><br><span class="line">Js.log(b); /* 1hello */</span><br></pre></td></tr></table></figure>
<p>但是如果使用數字的運算的話</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let a = 1;</span><br><span class="line"></span><br><span class="line">let b = a ++ &quot;hello&quot;;</span><br><span class="line"></span><br><span class="line">Js.log(b); /* Error: */</span><br></pre></td></tr></table></figure>
<p>會得到了一個錯誤</p>
<p><img src="../../../../images/Reason_BasicType/systaxError.png" alt="型態錯誤"></p>
<p>訊息會相當清楚地告知是哪一個部分錯誤</p>
<p>對於 <code>debug</code> 會相當有利</p>
<h2 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h2><p>布林值在各個程式語言中佔有相當重要的基本判斷依據</p>
<p>而且在 <code>Javascript</code> 中也是一項令人相當頭痛的變數型態</p>
<p>常常會有很多不小心造成了很多 <code>bug</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let testNum = 1;</span><br><span class="line">let isZero: bool = testNum === 0;</span><br><span class="line">Js.log(isZero);</span><br></pre></td></tr></table></figure>
<p>有趣的是編譯結果會是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated by BUCKLESCRIPT VERSION 4.0.5, PLEASE EDIT WITH CARE</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isZero = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isZero);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> testNum = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">exports.testNum = testNum;</span><br><span class="line">exports.isZero = isZero;</span><br></pre></td></tr></table></figure>
<p>他並未依據我的順序來做編譯</p>
<p>而是做了一些優化</p>
<p>因為 <code>isZero</code> 比較的是一個常數</p>
<p>所以不論怎樣執行，最後的結果一定是 <code>false</code></p>
<p>所以他優先宣告了 <code>var isZero = false;</code></p>
<p>然後在宣告 <code>testNum</code></p>
<h3 id="基本的布林運算子"><a href="#基本的布林運算子" class="headerlink" title="基本的布林運算子"></a>基本的布林運算子</h3><ul>
<li>&amp;&amp; - and</li>
<li>|| - or</li>
<li>! - not</li>
<li>&lt;=, &gt;=, &lt;, &gt;</li>
<li>== - structural equal</li>
<li>=== - referential equal</li>
<li>!= - structural not equal</li>
<li>!== - referential equal</li>
</ul>
<p>運算子中比較有趣的是 <code>==</code> 和 <code>===</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let tuple1 = (1, 2, 3);</span><br><span class="line">let tuple2 = (1, 2, 3);</span><br><span class="line">let tuple3 = tuple2;</span><br><span class="line"></span><br><span class="line">Js.log(tuple1 == tuple2); /* true */</span><br><span class="line">Js.log(tuple1 == tuple3); /* true */</span><br><span class="line">Js.log(tuple1 === tuple2); /* false */</span><br><span class="line">Js.log(tuple1 === tuple3); /* false */</span><br><span class="line">Js.log(tuple2 === tuple3); /* true */</span><br></pre></td></tr></table></figure>
<p><code>==</code> 是比較結構是否相等<br><code>===</code> 是比較來源是否相同</p>
<h2 id="數字"><a href="#數字" class="headerlink" title="數字"></a>數字</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let zero: int = 0;</span><br><span class="line">let floatNumber: float = 0.1;</span><br><span class="line"></span><br><span class="line">Js.log(zero); /* 0 */</span><br><span class="line">Js.log(floatNumber); /* 0.1 */</span><br><span class="line"></span><br><span class="line">/* zero === floatNumber will got Error by compiler*/</span><br></pre></td></tr></table></figure>
<ul>
<li>int - 整數</li>
<li>float - 浮點數</li>
</ul>
<h3 id="數字的相加"><a href="#數字的相加" class="headerlink" title="數字的相加"></a>數字的相加</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let addResult = 1 + 1;</span><br><span class="line">Js.log(addresult);/* 2 */</span><br><span class="line"></span><br><span class="line">let floatAddResult = 1.1 + 1.2; /* get compiler Error (WTF) */</span><br><span class="line">Js.log(floatAddResult);</span><br></pre></td></tr></table></figure>
<p>Float 的相加要使用另外一個符號 <code>+.</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let addResult = 1 + 1;</span><br><span class="line">Js.log(addresult);/* 2 */</span><br><span class="line"></span><br><span class="line">let floatAddResult = 1.1 +. 1.2; /* 2.3 */</span><br><span class="line">Js.log(floatAddResult);</span><br></pre></td></tr></table></figure>
<h3 id="int-與-float-的比大小"><a href="#int-與-float-的比大小" class="headerlink" title="int 與 float 的比大小"></a>int 與 float 的比大小</h3><p>因為 <code>Reason</code> 是強型別的語言</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let twoBiggerThanOne = 2 &gt; 1;</span><br><span class="line">Js.log(twoBiggerThanOne);</span><br></pre></td></tr></table></figure>
<p><code>int</code> 和 <code>float</code> 是不同的型別</p>
<p>無法直接地做比較</p>
<p>所以要先使用 <code>float_of_int</code> 將 <code>int</code> 轉成 <code>float</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float_of_int(2) &gt; 1.2; /* true */</span><br></pre></td></tr></table></figure>
<h2 id="string"><a href="#string" class="headerlink" title="string"></a>string</h2><p><code>&quot;</code> 使用雙引號宣告的為字串</p>
<p><code>&#39;</code> 使用單引號宣告的為字元</p>
<p>字元只能有一個字母</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let name: string = &quot;Tomas&quot;;</span><br><span class="line">let yourName: string = &quot;哈囉世界!&quot;;</span><br><span class="line">let a: char = &apos;a&apos;;</span><br><span class="line"></span><br><span class="line">Js.log(name);</span><br><span class="line">Js.log(a);</span><br><span class="line">Js.log(yourName); /* \xe5\x93\x88\xe5\x9b\x89\xe4\xb8\x96\xe7\x95\x8c! */</span><br></pre></td></tr></table></figure>
<p>在編譯的時候要注意的是如果是中文的話預設是 <code>Unicode</code></p>
<p>在宣告的時候要先進行處理</p>
<p>而使用 <code>j</code> 除了處理 <code>Unicode</code> 也可以用變數 (類似 ES6 Template)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let name: string = &quot;Tomas&quot;;</span><br><span class="line">let yourName: string = &#123;js|哈囉世界!|js&#125;;</span><br><span class="line">let world = &#123;js|世界|js&#125;;</span><br><span class="line">let helloWorld = &#123;j|你好，$world|j&#125;;</span><br><span class="line">let a: char = &apos;a&apos;;</span><br><span class="line"></span><br><span class="line">Js.log(name);</span><br><span class="line">Js.log(a);</span><br><span class="line">Js.log(yourName); /* 哈囉世界! */</span><br></pre></td></tr></table></figure></p>
<p><code>BuckleScript</code> 編譯前會先尋找 <code>js</code> 和 <code>j</code> 進行處理</p>
<p>另外字串的相加使用 <code>++</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let hello = &quot;Hello&quot;;</span><br><span class="line">let world = &quot;World&quot;</span><br><span class="line">Js.log(hello ++ &quot; &quot; ++ world); /* console.log(&quot;Hello World&quot;); */</span><br></pre></td></tr></table></figure>
<p>也可此參考 <code>Reason</code> 的 string API<a href="https://bucklescript.github.io/bucklescript/api/Js.String.html" target="_blank" rel="noopener">文件</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Reason簡介與Helloworld" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/10/01/Reason簡介與Helloworld/" class="article-date">
      <time datetime="2018-10-01T03:51:55.000Z" itemprop="datePublished">2018-10-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/01/Reason簡介與Helloworld/">Reason簡介與Helloworld</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="What-is-Reason"><a href="#What-is-Reason" class="headerlink" title="What is Reason"></a>What is Reason</h1><p><code>Reason</code> 並不是一個新的語言，而是一種新的語法和工具鍊(toolchain)，<a href="http://ocaml.org/" target="_blank" rel="noopener">Ocaml</a>支援。並支援既有的 NPM/YARN。</p>
<p>藉由 <a href="https://bucklescript.github.io/" target="_blank" rel="noopener">BuckleScript</a>將 <code>Reason</code> 編譯為可閱讀的 <code>Javascript</code> </p>
<h2 id="Reason-的優勢"><a href="#Reason-的優勢" class="headerlink" title="Reason 的優勢"></a>Reason 的優勢</h2><ul>
<li>型別系統: Ocaml 型別測試具有 <code>100%</code> 的覆蓋率，而且保有 <code>Javascript</code> 的型別推導，一但編譯過型別保證正確</li>
<li>保有簡單和實用性:<ul>
<li>允許 side-effect, mutable</li>
<li>也可以使用 immutable functional</li>
</ul>
</li>
<li>重視效能和大小: Reason 的建置系統 <code>bsb</code> 建置時間小於 100ms(遞增)，產生的結果也會很小</li>
<li>漸進式學習 &amp; 程式碼庫轉換: 也可以在 <code>Reason</code> 中貼上 <code>Javascript</code> 的程式片段再慢慢調整為 <code>Reason</code> 的程式碼</li>
<li>基本使用 <code>immutable and functional</code> 但是也提供 <code>side-effect</code> 和 <code>mutation</code> 的彈性</li>
<li>Reason 的 build system (bsb) 建構精簡可閱讀的 <code>Javascript code</code></li>
<li>完整的生態圈和工具鍊: <a href="https://reasonml.github.io/docs/zh-TW/editor-plugins" target="_blank" rel="noopener">編輯器</a>, <a href="https://reasonml.github.io/docs/zh-TW/libraries" target="_blank" rel="noopener">NPM 套件</a>, <a href="https://github.com/reasonml/reason-react" target="_blank" rel="noopener">Reason-React</a>, <a href="https://webpack.js.org/" target="_blank" rel="noopener">webpack</a></li>
</ul>
<h2 id="compiler-流程"><a href="#compiler-流程" class="headerlink" title="compiler 流程"></a>compiler 流程</h2><p>當你完成一個簡單的 <code>.re</code> 檔案 (這是基本的 reason檔案)</p>
<p>會經由下圖的過程幫你編譯成 <code>Javascript</code></p>
<p><img src="../../../../images/Reason_Helloworld/compiler_flow.png" alt="流程"></p>
<h2 id="Install-Reason-on-Mac"><a href="#Install-Reason-on-Mac" class="headerlink" title="Install Reason on Mac"></a>Install Reason on Mac</h2><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">npm</span> install -g reason-cli@latest-macos</span><br><span class="line">$ <span class="built_in">npm</span> install -g bs-platform</span><br></pre></td></tr></table></figure>
<ul>
<li>reason-cli - Reason 的環境套件</li>
<li>bs-platform - BuckleScript 和 Reason 基本套件</li>
</ul>
<h3 id="initial-First-Reason-Project"><a href="#initial-First-Reason-Project" class="headerlink" title="initial First Reason Project"></a>initial First Reason Project</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">bsb </span>-init hello-world -theme  <span class="keyword">basic-reason</span></span><br></pre></td></tr></table></figure>
<p>第一次初始化之後會得到這樣的檔案結構<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── <span class="keyword">bsconfig.json</span></span><br><span class="line"><span class="keyword">├── </span>node_modules</span><br><span class="line">│   └── <span class="keyword">bs-platform </span>-&gt; /usr/local/lib/node_modules/<span class="keyword">bs-platform</span></span><br><span class="line"><span class="keyword">├── </span>package.json</span><br><span class="line">└── src</span><br><span class="line">    └── Demo.re</span><br></pre></td></tr></table></figure></p>
<h4 id="bsconfig-json"><a href="#bsconfig-json" class="headerlink" title="bsconfig.json"></a>bsconfig.json</h4><p><code>BuckleScript</code> 的設定 json 檔案</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"hello-world"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">  <span class="attr">"sources"</span>: &#123;</span><br><span class="line">    <span class="attr">"dir"</span> : <span class="string">"src"</span>,</span><br><span class="line">    <span class="attr">"subdirs"</span> : <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"package-specs"</span>: &#123;</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="attr">"in-source"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"suffix"</span>: <span class="string">".bs.js"</span>,</span><br><span class="line">  <span class="attr">"bs-dependencies"</span>: [</span><br><span class="line">      <span class="comment">// add your dependencies here. You'd usually install them normally through `npm install my-dependency`. If my-dependency has a bsconfig.json too, then everything will work seamlessly.</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"warnings"</span>: &#123;</span><br><span class="line">    <span class="attr">"error"</span> : <span class="string">"+101"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"namespace"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"refmt"</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>name - 專案名稱</li>
<li>version - 版本</li>
<li>sources<ul>
<li>dir - source 的資料夾</li>
<li>subdirs - 是否要編譯子資料夾內的 re (Boolean or Array)</li>
</ul>
</li>
<li>package-specs<ul>
<li>module - 編譯後使用哪種 Javascript 模組 (default: commonjs)</li>
<li>in-source - 編譯的時候是否也要輸出</li>
</ul>
</li>
<li>suffix - 編譯後的 js 的 後綴</li>
<li>bs-dependencies - 列出你使用 NPM(Yarn) 安裝的第三方 套件</li>
<li>bs-dev-dependencies- 列出你使用 NPM(Yarn) 安裝的第三方 開發套件</li>
<li>namespace - name 是 package 名稱，可以選擇是否開啟命名空間 (default: false)<ul>
<li>例如您有一個 <code>Util.re</code> 的檔案，如果沒有開啟命名空間，你的第三方套件也有一個 <code>Util</code> 的套件，他們會造成衝突，，這個參數影響的是這個 lib 的<strong>使用者</strong>，而不是自己本身</li>
</ul>
</li>
<li>refmt -  當你使用 <a href="https://reasonml.github.io/blog/2017/10/27/reason3.html" target="_blank" rel="noopener">Reason V3 syntax</a> 則明確指定為 <code>3</code></li>
<li>reason - 預設是打開的，但是若有使用 <code>ReasonReact</code>, 設定則為</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"reason"</span>: &#123;<span class="attr">"react-jsx"</span>: <span class="number">2</span>&#125;,</span><br><span class="line">  <span class="attr">"refmt"</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="merlin"><a href="#merlin" class="headerlink" title="merlin"></a>merlin</h4><p>在你的專案中還隱藏了一個小小的檔案 <code>.merlin</code></p>
<p>這個檔案雖然只有短短幾行</p>
<p>但是扮演相當重要的角色</p>
<p>他會協助你的 <code>格式檢查</code>, <code>autocompleate</code>…</p>
<h2 id="執行您的第一個-Hello-world"><a href="#執行您的第一個-Hello-world" class="headerlink" title="執行您的第一個 Hello world"></a>執行您的第一個 Hello world</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">run</span><span class="bash"> start</span></span><br></pre></td></tr></table></figure>
<p>然後會開始編譯</p>
<p><img src="../../../../images/Reason_Helloworld/start1.png" alt="編譯完成"></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span> <span class="title">src</span>/Demo.bs.js</span><br><span class="line">// Hello, BuckleScript <span class="keyword">and</span> Reason!</span><br></pre></td></tr></table></figure>
<p>Welcom Reason’s World</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Reason/">Reason</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IThome2018/">IThome2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reason/">Reason</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Truffle-pet-demo" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/05/05/Truffle-pet-demo/" class="article-date">
      <time datetime="2018-05-05T05:54:23.000Z" itemprop="datePublished">2018-05-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/05/Truffle-pet-demo/">truffle pet demo</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="設定步驟"><a href="#設定步驟" class="headerlink" title="設定步驟"></a>設定步驟</h1><ol>
<li>設定開發者相關環境變數</li>
<li>建立一個 Truffle 專案</li>
<li>寫一個基本的合約</li>
<li>編譯與部屬你的合約</li>
<li>測試你的合約</li>
<li>建立一個介面來跟你的合約溝通</li>
<li>放到瀏覽器開工囉</li>
</ol>
<h2 id="後端"><a href="#後端" class="headerlink" title="後端"></a>後端</h2><h3 id="1-設定開發者相關環境變數"><a href="#1-設定開發者相關環境變數" class="headerlink" title="1. 設定開發者相關環境變數"></a>1. 設定開發者相關環境變數</h3><h4 id="安裝基本環境"><a href="#安裝基本環境" class="headerlink" title="安裝基本環境"></a>安裝基本環境</h4><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Nodejs</a></p>
<p><a href="https://git-scm.com/" target="_blank" rel="noopener">Git</a></p>
<p><a href="http://truffleframework.com/ganache/" target="_blank" rel="noopener">Ganache</a></p>
<p>個人的以太區塊鏈的測試環境</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -<span class="keyword">g</span> truffle</span><br><span class="line">$ truffle --<span class="keyword">version</span> <span class="comment">// 檢查是否安裝成功以及版本</span></span><br><span class="line">$ <span class="keyword">mkdir</span> pet-shop-<span class="keyword">tutorial</span> &amp;&amp; <span class="keyword">cd</span> pet-shop-<span class="keyword">tutorial</span></span><br></pre></td></tr></table></figure>
<h3 id="2-建立一個-Truffle-專案"><a href="#2-建立一個-Truffle-專案" class="headerlink" title="2. 建立一個 Truffle 專案"></a>2. 建立一個 Truffle 專案</h3><p>Truffle 有提供一些套件協助建立 <code>DAPP</code></p>
<p><a href="https://truffleframework.com/boxes" target="_blank" rel="noopener">Truffle Boxes</a></p>
<p>我常用 <code>React</code> 開發</p>
<p><a href="https://truffleframework.com/boxes/react" target="_blank" rel="noopener">Truffle React Box</a></p>
<p>所以這裡使用 React 作為範例</p>
<p>建立一個 <code>pet-shop</code> 的 basic project</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>npx truffle unbox react</span><br><span class="line"><span class="variable">$ </span>npm install -g truffle</span><br><span class="line"><span class="variable">$ </span>truffle unbox react</span><br></pre></td></tr></table></figure>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Truffle initial 有很多方式， `truffle init` 會幫你建立一個空的 Truffle 專案</span><br></pre></td></tr></table></figure>
<p><a href="http://truffleframework.com/docs/getting_started/project" target="_blank" rel="noopener">Truffle init</a></p>
<h4 id="檔案結構"><a href="#檔案結構" class="headerlink" title="檔案結構"></a>檔案結構</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">  .</span><br><span class="line">├── <span class="selector-tag">LICENSE</span></span><br><span class="line">├── <span class="selector-tag">box-img-lg</span><span class="selector-class">.png</span></span><br><span class="line">├── <span class="selector-tag">box-img-sm</span><span class="selector-class">.png</span></span><br><span class="line">├── <span class="selector-tag">bs-config</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">build</span></span><br><span class="line">│   └── <span class="selector-tag">contracts</span></span><br><span class="line">│       ├── <span class="selector-tag">Adoption</span><span class="selector-class">.json</span></span><br><span class="line">│       └── <span class="selector-tag">Migrations</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">contracts</span></span><br><span class="line">│   ├── <span class="selector-tag">Adoption</span><span class="selector-class">.sol</span></span><br><span class="line">│   └── <span class="selector-tag">Migrations</span><span class="selector-class">.sol</span></span><br><span class="line">├── <span class="selector-tag">migrations</span></span><br><span class="line">│   └── 1_<span class="selector-tag">initial_migration</span><span class="selector-class">.js</span></span><br><span class="line">├── <span class="selector-tag">package-lock</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">package</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">src</span></span><br><span class="line">│   ├── <span class="selector-tag">css</span></span><br><span class="line">│   │   ├── <span class="selector-tag">bootstrap</span><span class="selector-class">.min</span><span class="selector-class">.css</span></span><br><span class="line">│   │   └── <span class="selector-tag">bootstrap</span><span class="selector-class">.min</span><span class="selector-class">.css</span><span class="selector-class">.map</span></span><br><span class="line">│   ├── <span class="selector-tag">fonts</span></span><br><span class="line">│   │   ├── <span class="selector-tag">glyphicons-halflings-regular</span><span class="selector-class">.eot</span></span><br><span class="line">│   │   ├── <span class="selector-tag">glyphicons-halflings-regular</span><span class="selector-class">.svg</span></span><br><span class="line">│   │   ├── <span class="selector-tag">glyphicons-halflings-regular</span><span class="selector-class">.ttf</span></span><br><span class="line">│   │   ├── <span class="selector-tag">glyphicons-halflings-regular</span><span class="selector-class">.woff</span></span><br><span class="line">│   │   └── <span class="selector-tag">glyphicons-halflings-regular</span><span class="selector-class">.woff2</span></span><br><span class="line">│   ├── <span class="selector-tag">images</span></span><br><span class="line">│   │   ├── <span class="selector-tag">boxer</span><span class="selector-class">.jpeg</span></span><br><span class="line">│   │   ├── <span class="selector-tag">french-bulldog</span><span class="selector-class">.jpeg</span></span><br><span class="line">│   │   ├── <span class="selector-tag">golden-retriever</span><span class="selector-class">.jpeg</span></span><br><span class="line">│   │   └── <span class="selector-tag">scottish-terrier</span><span class="selector-class">.jpeg</span></span><br><span class="line">│   ├── <span class="selector-tag">index</span><span class="selector-class">.html</span></span><br><span class="line">│   ├── <span class="selector-tag">js</span></span><br><span class="line">│   │   ├── <span class="selector-tag">app</span><span class="selector-class">.js</span></span><br><span class="line">│   │   ├── <span class="selector-tag">bootstrap</span><span class="selector-class">.min</span><span class="selector-class">.js</span></span><br><span class="line">│   │   ├── <span class="selector-tag">truffle-contract</span><span class="selector-class">.js</span></span><br><span class="line">│   │   └── <span class="selector-tag">web3</span><span class="selector-class">.min</span><span class="selector-class">.js</span></span><br><span class="line">│   └── <span class="selector-tag">pets</span><span class="selector-class">.json</span></span><br><span class="line">├── <span class="selector-tag">test</span></span><br><span class="line">└── <span class="selector-tag">truffle-config</span><span class="selector-class">.js</span></span><br></pre></td></tr></table></figure>
<p>* contracts : <code>Solidity</code> 的檔案，在這個範例中有一個 <code>Migrations.sol</code> 的範例檔案</p>
<ul>
<li>migrations : Truffle 利用 <code>migrations system</code> 來處理開發環境，A migration is an additional special smart contract that keeps track of changes.</li>
<li>test : 測試檔案</li>
<li>truffle.js : Truffle 的設定檔案</li>
</ul>
<h3 id="3-寫一個基本的合約"><a href="#3-寫一個基本的合約" class="headerlink" title="3. 寫一個基本的合約"></a>3. 寫一個基本的合約</h3><p>在 <code>constracts</code> 中建立一個檔案 <code>Adoption.sol</code></p>
<p>Adoption.sol</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Adoption &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>pragma 定義使用 <code>solidity</code> 編譯器的版本</li>
</ul>
<h4 id="變數"><a href="#變數" class="headerlink" title="變數"></a>變數</h4><p><code>Solidity</code> 有一種特別的變數 <code>adress</code>，這是代表  <code>Ethereum</code> 的位址</p>
<p>儲存了 20 個 byte 得值， 每一個帳號和合約在 <code>Ethereum block chain</code> 都擁有一個 <code>adress</code></p>
<p>這個變數是 <strong>唯一的</strong></p>
<p>在 <code>Adoption.sol</code> 中宣告一個 <code>adress</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Adoption &#123;</span><br><span class="line">  address[16] public adopters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>宣告一個變數 <code>adopters</code> 這是一個陣列儲存 <code>Ethereum</code> 的 address<br>Array 內有一種類型，在這裡的長度設定為 <code>16</code></p>
</li>
<li><p><code>adopters</code> 設定是 public， public 有 <code>getter method</code> 回傳一個值<br>但是因為在這個範例 <code>adopters</code> 是一個陣列，所以等等會寫一個 function 回傳整個陣列</p>
</li>
</ul>
<h3 id="First-Function-Adopting-a-pet"><a href="#First-Function-Adopting-a-pet" class="headerlink" title="First Function: Adopting a pet"></a>First Function: Adopting a pet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Adoption &#123;</span><br><span class="line">  address[16] public adopters;</span><br><span class="line">  // Adopting a pet</span><br><span class="line">  function adopt(uint petId) public returns (uint) &#123;</span><br><span class="line">    require(petId &gt;= 0 &amp;&amp; petId &lt;= 15);</span><br><span class="line"></span><br><span class="line">    adopters[petId] = msg.sender;</span><br><span class="line"></span><br><span class="line">    return petId;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在 <code>Solidity</code> 中必須要定義函式的 輸入值和回傳值的型態，在這個範例中會接收一個 <strong>petId</strong> (整數)也會回傳一個整數</p>
</li>
<li><p>在函式要保證 <strong>petId</strong> 的範圍值必須在 <code>adopters 陣列</code> 範圍內, <code>Solidity</code> 中的陣列 index 是從 0 開始，所以這個 ID 會在 0~15 之間， 我們利用 <code>require()</code> 來定義這個範圍</p>
</li>
<li><p>如果這個 ID 在允許的範圍內 (0 ~ 15) 之間，則新增這個人的位址到採用者的陣列 <code>adopters</code> 而這個人的位址則是利用 <code>msg.sender</code> 來取得</p>
</li>
<li><p>最後回傳 <code>petId</code> 提供確認</p>
</li>
</ul>
<h3 id="Second-Function-Retrieving-the-adopters"><a href="#Second-Function-Retrieving-the-adopters" class="headerlink" title="Second Function: Retrieving the adopters"></a>Second Function: Retrieving the adopters</h3><p>array getter 只能回傳一個值，但是但是 16 個 API 不是很實際，所以我們需要一個 API 來回傳所有的寵物列表</p>
<ol>
<li>在 <code>adopt()</code> 後增加一個 <code>getAdopters()</code> 這個 function</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function getAdopters() public view returns (address[16] memory) &#123;</span><br><span class="line">  return adopters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><code>adopters</code>已經宣告過了，可以直接回傳，但是要確認加上 <code>memory</code> 這個關鍵字 確認給出的是變量的位置</li>
<li>而 <code>view</code> 這個關鍵字則代表這個 function 部會修改這個合約的任何狀態值，更詳細的資訊可以<a href="https://solidity.readthedocs.io/en/latest/contracts.html#view-functions" target="_blank" rel="noopener">查看這</a></li>
</ol>
<p><code>memory</code> 表示 adopters 的值存在記憶體裡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Adoption &#123;</span><br><span class="line">  address[16] public adopters;</span><br><span class="line">  function adopt(uint petId) public returns (uint) &#123;</span><br><span class="line">    require(petId &gt;= 0 &amp;&amp; petId &lt;= 15);</span><br><span class="line">    adopters[petId] = msg.sender;</span><br><span class="line">    return petId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getAdopters() public view returns (address[16] memory) &#123;</span><br><span class="line">    return adopters;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在這邊我們將回傳之前宣告的 <code>adopters</code> 定義類型為 address[16]</p>
<h3 id="編譯並部署智能合約"><a href="#編譯並部署智能合約" class="headerlink" title="編譯並部署智能合約"></a>編譯並部署智能合約</h3><p>Truffle 有一個開發者控制台， 他會生成一個開發區塊鏈，可以利用他測試部署合同</p>
<p>他可以直接在控制台運行，本範例大部分將會使用它完成</p>
<h4 id="編譯"><a href="#編譯" class="headerlink" title="編譯"></a>編譯</h4><p><code>Solidity</code> 是一個編譯語言，所以需要一個編譯器先編譯之後才能執行，</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>truffle compile</span><br></pre></td></tr></table></figure>
<p>這時候應該會看到這些資訊<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Compiling .<span class="regexp">/contracts/</span>Adoption.sol...</span><br><span class="line">Compiling .<span class="regexp">/contracts/Mig</span>rations.sol...</span><br><span class="line">Writing <span class="keyword">artifacts</span> to .<span class="regexp">/build/</span>contracts</span><br></pre></td></tr></table></figure></p>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><p>資料夾內會看到 <code>migrations/1_initial_migration.js</code> 這個檔案，，他是一個更改 contract 狀態的部屬腳本，會避免未來重複部署同樣的 <code>Migrations.sol</code> 合約</p>
<p>現在我們需要新增一個屬於我們自己的部署 script</p>
<ol>
<li>在 <code>migrations</code> 資料夾中新增一個檔案 <code>2_deploy_contracts.js</code></li>
<li><code>2_deploy_contracts.js</code> 內容</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Adoption = artifacts.require(<span class="string">"Adoption"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">deployer</span>)</span>&#123;</span><br><span class="line">  deployer.deploy(Adoption);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在部署之前要先執行 <code>Ganache</code> 他會有一個本地的區塊鏈在 <code>port 7575</code></p>
<p>若您尚未下載 <a href="http://truffleframework.com/ganache" target="_blank" rel="noopener">download Ganache</a></p>
<p><img src="https://truffleframework.com/img/docs/ganache/quickstart/accounts.png" alt="image"></p>
<p>然後回到終端機</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">  $ truffle migrate</span></span><br><span class="line">Compiling ./contracts/Adoption.sol...</span><br><span class="line">Writing artifacts to ./build/contracts</span><br><span class="line"></span><br><span class="line">⚠️  Important ⚠️</span><br><span class="line">If you're using an HDWalletProvider, it must be Web3 1.0 enabled or your migration will hang.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line">&gt; Network name:    <span class="emphasis">'development'</span></span><br><span class="line">&gt; Network id:      5777</span><br><span class="line">&gt; Block gas limit: 6721975</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1<span class="emphasis">_initial_</span>migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line"><span class="code">   Deploying 'Migrations'</span></span><br><span class="line"><span class="code">   ----------------------</span></span><br><span class="line"><span class="code">   &gt; transaction hash:    0x9965bb63687936396ef9db5830b9e0a9ff36f10108b775abf944fc86f061454c</span></span><br><span class="line"><span class="code">   &gt; Blocks: 0            Seconds: 0</span></span><br><span class="line"><span class="code">   &gt; contract address:    0x3216882738b0ca58BD4a2a3125Fa4bC651100C7e</span></span><br><span class="line"><span class="code">   &gt; account:             0x10D045570AD2a69921Dc4e6b55148e071fC7484D</span></span><br><span class="line"><span class="code">   &gt; balance:             99.99430184</span></span><br><span class="line"><span class="code">   &gt; gas used:            284908</span></span><br><span class="line"><span class="code">   &gt; gas price:           20 gwei</span></span><br><span class="line"><span class="code">   &gt; value sent:          0 ETH</span></span><br><span class="line"><span class="code">   &gt; total cost:          0.00569816 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="code">   &gt; Saving migration to chain.</span></span><br><span class="line"><span class="code">   &gt; Saving artifacts</span></span><br><span class="line"><span class="code">   -------------------------------------</span></span><br><span class="line"><span class="code">   &gt; Total cost:          0.00569816 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line">&gt; Total deployments:   1</span><br><span class="line">&gt; Final cost:          0.00569816 ETH</span><br></pre></td></tr></table></figure>
<p>在 <code>Ganache</code> 中 blockchain 的狀態改變了從原本的 0 改變為 4 ，之後會再討論到交易成本</p>
<p>寫好第一個合約並且部署上了區塊鏈，接下來要開始測試一下你的合約</p>
<p><code>transaction hash</code> 代表這個合約的序號</p>
<p>你可以透過這個序號來搜尋這個合約</p>
<p>回到 Terminal migrate 合約到鍊上</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>truffle migrate</span><br></pre></td></tr></table></figure>
<p>結果會是<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line">&gt; Network name:    <span class="emphasis">'development'</span></span><br><span class="line">&gt; Network id:      5777</span><br><span class="line">&gt; Block gas limit: 6721975</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2<span class="emphasis">_deploy_</span>contracts.js</span><br><span class="line">=====================</span><br><span class="line"></span><br><span class="line"><span class="code">   Deploying 'Adoption'</span></span><br><span class="line"><span class="code">   --------------------</span></span><br><span class="line"><span class="code">   &gt; transaction hash:    0xac113a702da3ab7a8fde7ec8941143ff854cb8ae3f2457e1cc9251a0fa62a2b8</span></span><br><span class="line"><span class="code">   &gt; Blocks: 0            Seconds: 0</span></span><br><span class="line"><span class="code">   &gt; contract address:    0xAc30aaD46a83f8E8De3f452B0d4C175a1173a54b</span></span><br><span class="line"><span class="code">   &gt; account:             0x10D045570AD2a69921Dc4e6b55148e071fC7484D</span></span><br><span class="line"><span class="code">   &gt; balance:             99.98838348</span></span><br><span class="line"><span class="code">   &gt; gas used:            253884</span></span><br><span class="line"><span class="code">   &gt; gas price:           20 gwei</span></span><br><span class="line"><span class="code">   &gt; value sent:          0 ETH</span></span><br><span class="line"><span class="code">   &gt; total cost:          0.00507768 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="code">   &gt; Saving migration to chain.</span></span><br><span class="line"><span class="code">   &gt; Saving artifacts</span></span><br><span class="line"><span class="code">   -------------------------------------</span></span><br><span class="line"><span class="code">   &gt; Total cost:          0.00507768 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line">&gt; Total deployments:   1</span><br><span class="line">&gt; Final cost:          0.00507768 ETH</span><br></pre></td></tr></table></figure></p>
<p><img src="https://truffleframework.com/img/tutorials/pet-shop/ganache-migrated.png" alt="image"></p>
<ol>
<li>可以打開 <code>Ganache</code> 之前的數值是 0 現在會變成 4，也可以看到第一個帳號原本是 <code>100</code>但是現在不到 <code>100</code> (我的顯示是 99.99)，因為這次的 migration 花費了乙太幣，等等會討論到更多關於這個花費的問題</li>
</ol>
<h4 id="測試智能合約"><a href="#測試智能合約" class="headerlink" title="測試智能合約"></a>測試智能合約</h4><p>Truffle 如何測試你的合約呢？</p>
<ol>
<li>建立一個 <code>TestAdoption.sol</code> 在 <code>test</code> 的資料夾下</li>
<li>內容如下</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">import &quot;truffle/Assert.sol&quot;;</span><br><span class="line">import &quot;truffle/DeployedAddresses.sol&quot;;</span><br><span class="line">import &quot;../contracts/Adoption.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract TestAdoption &#123;</span><br><span class="line">  Adoption adoption = Adoption(DeployedAddresses.Adoption());</span><br><span class="line"></span><br><span class="line">  uint expectedPetId = 8;</span><br><span class="line"></span><br><span class="line">  address expectedAdopter = address(this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Assert.sol</code>: 提供 assertions 使用，判斷是否相等，大於小於等等的判斷</li>
<li><code>DeployedAddresses.sol</code>: 側是的時後 Truffle 會在鍊上部署一個新的實例，會取得那一個的位址來使用模擬</li>
<li><code>Adoption.sol</code>: 要測試的智能合約內容</li>
</ul>
<p>然後再定義其他的變數</p>
<ul>
<li><code>DeployedAddresses</code> 模擬部署一個智能合約取得他的位址</li>
<li><code>expectedPetId</code> 提供測試的寵物 ID</li>
<li>因為預計 <code>TestAdoption</code> 合約會發送交易，預期的 <code>sneder</code> 位址設為此，取得現在合約的 <code>address</code></li>
</ul>
<h5 id="測試-adopt-函式"><a href="#測試-adopt-函式" class="headerlink" title="測試 adopt() 函式"></a>測試 <code>adopt()</code> 函式</h5><p>測試 <code>adopt()</code> 使用這個函式成功後回傳 <code>petId</code></p>
<p>可以判斷這個 <code>petId</code> 的直是否正確</p>
<ol>
<li>在 <code>TestAdoption.sol</code> 中的 <code>Adoption</code> 中增加下面的程式碼</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function testUserCanAdoptPet() public &#123;</span><br><span class="line">  uint returnedId = adoption.adopt(expectedPetId);</span><br><span class="line"></span><br><span class="line">  Assert.equal(returnedId, expectedPetId, &quot;Adoption of the expected pet should match what is returned.&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>expectedPetId</code> 是我們要認養的 寵物 ID 跟回傳的 <code>returnedId</code>是否相等</li>
</ul>
<h5 id="測試單個寵物主人的主人"><a href="#測試單個寵物主人的主人" class="headerlink" title="測試單個寵物主人的主人"></a>測試單個寵物主人的主人</h5><p>public 變數會有一個 <code>getter</code> 的 function 來取得，測試的過程中數據會持續存在</p>
<p>所以可以沿用 <code>expectedPetId</code> 在其他測試中</p>
<ol>
<li>增加一個 function 在 <code>TestAdoption.sol</code> 中</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function testGetAdopterAddressByPetId() public &#123;</span><br><span class="line">  address adopter = adoption.adopters(expectedPetId);</span><br><span class="line"></span><br><span class="line">  Assert.equal(adopter, expectedAdopter, &quot;Owner of the expected pet should be this contract&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>取得 <code>adopter</code> 的位址 存在合約中，利用 Assert 判斷是否一致</p>
<h5 id="測試所有寵物主人"><a href="#測試所有寵物主人" class="headerlink" title="測試所有寵物主人"></a>測試所有寵物主人</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function testGetAdopterAddressByPetIdInArray() public &#123;</span><br><span class="line">  address[16] memory adopters = adoption.getAdopters();</span><br><span class="line"></span><br><span class="line">  Assert.equal(adopters[expectedPetId], expectedAdopter, &quot;Owner of the expected pet should be this contract&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意 <code>adopters</code> 屬性，因為有 <code>memory</code> 關鍵字代表存在記憶體中，不是存在合約的 storage 中，當 <code>adopters</code> 在一個陣列中，比較了陣列中的 <code>expectedAdopter</code>做比較</p>
<h4 id="Running-test"><a href="#Running-test" class="headerlink" title="Running test"></a>Running test</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ truffle test</span><br><span class="line">Using<span class="built_in"> network </span><span class="string">'development'</span>.</span><br><span class="line"></span><br><span class="line">Compiling ./contracts/Adoption.sol<span class="built_in">..</span>.</span><br><span class="line">Compiling ./test/TestAdoption.sol<span class="built_in">..</span>.</span><br><span class="line">Compiling truffle/Assert.sol<span class="built_in">..</span>.</span><br><span class="line">Compiling truffle/DeployedAddresses.sol<span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">TestAdoption</span><br><span class="line">  ✓ testUserCanAdoptPet (75ms)</span><br><span class="line">  ✓ testGetAdopterAddressByPetId (64ms)</span><br><span class="line">  ✓ testGetAdopterAdderssByPetIdInArray (138ms)</span><br></pre></td></tr></table></figure>
<h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><p><a href="http://truffleframework.com/tutorials/pet-shop" target="_blank" rel="noopener">Tutorial</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Block-Chain/">Block Chain</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sodility/">Sodility</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Truffle/">Truffle</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Javascript-HighOrderFunction" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/02/02/Javascript-HighOrderFunction/" class="article-date">
      <time datetime="2018-02-02T15:14:11.000Z" itemprop="datePublished">2018-02-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/02/Javascript-HighOrderFunction/">Javascript-High Order Function</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="High-Order-Function"><a href="#High-Order-Function" class="headerlink" title="High Order Function"></a>High Order Function</h1><p>是一種 <code>接受 Funciton 回傳 Function 的 Function</code></p>
<p>Map, Filter, Reduce 都是</p>
<h2 id="Function-回傳一個-Function"><a href="#Function-回傳一個-Function" class="headerlink" title="Function 回傳一個 Function"></a>Function 回傳一個 Function</h2><p>範例一</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基本款</span></span><br><span class="line"><span class="keyword">const</span> sum = <span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//簡潔款</span></span><br><span class="line"><span class="keyword">const</span> sum2 = <span class="function"><span class="params">x</span> =&gt;</span> <span class="function"><span class="params">y</span> =&gt;</span> x + y;</span><br></pre></td></tr></table></figure>
<h3 id="applyTwice-就是一個-High-Order-Function"><a href="#applyTwice-就是一個-High-Order-Function" class="headerlink" title="applyTwice 就是一個 High Order Function"></a>applyTwice 就是一個 High Order Function</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> applyTwice = <span class="function"><span class="params">func</span> =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> func(func.apply(<span class="literal">null</span>, args));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(applyTwice(<span class="function"><span class="params">x</span> =&gt;</span> <span class="string">"yo!"</span> + x)(<span class="string">"world"</span>));</span><br></pre></td></tr></table></figure>
<p>在 <code>func</code> 中回傳兩次呼叫的自己，</p>
<p>所以會收到 <code>yo!yo!world</code></p>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>實作 Map</p>
<p>先來看看 <code>Array.prototype.Map</code> 是如何使用的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">array.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item)); <span class="comment">// 1,2,3,4</span></span><br><span class="line"><span class="built_in">console</span>.log(array.map(<span class="function"><span class="params">item</span> =&gt;</span> item + <span class="number">1</span>)); <span class="comment">//[2,3,4,5]</span></span><br></pre></td></tr></table></figure>
<p>不希望使用到 <code>prototype</code></p>
<p>實作的時候會偏向 <code>lodash</code> 的 Map</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">_.map(array, item =&gt; <span class="built_in">console</span>.log(item)); <span class="comment">//1,2,3,4</span></span><br><span class="line"><span class="built_in">console</span>.log(_.map(array, item =&gt; item + <span class="number">1</span>)); <span class="comment">//[2,3,4,5]</span></span><br></pre></td></tr></table></figure>
<p>真正來實作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="function">(<span class="params">array, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (array.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> x = array.pop();</span><br><span class="line">    map(array, callback) || [];</span><br><span class="line">    callback(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">map(array, item =&gt; <span class="built_in">console</span>.log(item)); <span class="comment">//1,2,3,4</span></span><br><span class="line"><span class="built_in">console</span>.log(map(array, item =&gt; item + <span class="number">1</span>)); <span class="comment">//[]</span></span><br></pre></td></tr></table></figure>
<p>似乎需要回傳一些東西</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="function">(<span class="params">array, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (array.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> x = array.pop();</span><br><span class="line">    <span class="keyword">const</span> result = map(array, callback) || [];</span><br><span class="line">    result.push(callback(x));</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">map(array, item =&gt; <span class="built_in">console</span>.log(item)); <span class="comment">//1,2,3,4</span></span><br><span class="line"><span class="built_in">console</span>.log(map(array, item =&gt; item + <span class="number">1</span>)); <span class="comment">//[1,2,3,4]</span></span><br></pre></td></tr></table></figure>
<h2 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h2><p>Filter 的使用範例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="built_in">console</span>.log(array.filter(<span class="function"><span class="params">x</span> =&gt;</span> x &gt; <span class="number">2</span>)); <span class="comment">// [3,4,5]</span></span><br><span class="line"><span class="built_in">console</span>.log(array.filter(<span class="function"><span class="params">x</span> =&gt;</span> x &gt; <span class="number">4</span>)); <span class="comment">// [ 5 ]</span></span><br></pre></td></tr></table></figure>
<p>針對 Filter 的實作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> filter = <span class="function"><span class="params">func</span> =&gt;</span> <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (array.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [x, ...xs] = array;</span><br><span class="line">    <span class="keyword">const</span> filterResult = func(x) ? [x] : [];</span><br><span class="line">    <span class="keyword">return</span> [...filterResult, ...filter(func)(xs)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(filter(<span class="function"><span class="params">x</span> =&gt;</span> x &gt; <span class="number">2</span>)(array));</span><br></pre></td></tr></table></figure>
<h2 id="Zip"><a href="#Zip" class="headerlink" title="Zip"></a>Zip</h2><p>Zip 就是將兩個陣列合成一個二維陣列大小以較小的陣列為基準</p>
<p>輸出結果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]) = [[<span class="number">1</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>], [<span class="number">3</span>, <span class="number">0</span>]]</span><br><span class="line">zip([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])([<span class="number">87</span>]) = [[<span class="number">1</span>, <span class="number">87</span>]]</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zip = <span class="function"><span class="params">array1</span> =&gt;</span> <span class="function"><span class="params">array2</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (array1.length === <span class="number">0</span> || array2.lenght === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [x1, ...xs1] = array1;</span><br><span class="line">    <span class="keyword">const</span> [y1, ...ys1] = array2;</span><br><span class="line">    <span class="keyword">const</span> result = zip(xs1)(ys1);</span><br><span class="line">    <span class="keyword">return</span> [...result, [x1, y1]];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(zip([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]));</span><br></pre></td></tr></table></figure>
<h2 id="Quick-Sort"><a href="#Quick-Sort" class="headerlink" title="Quick Sort"></a>Quick Sort</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> quickSort = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (array.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [basic, ...xs] = array;</span><br><span class="line">    <span class="keyword">const</span> left = xs.filter(<span class="function"><span class="params">item</span> =&gt;</span> item &lt; basic);</span><br><span class="line">    <span class="keyword">const</span> right = xs.filter(<span class="function"><span class="params">item</span> =&gt;</span> item &gt;= basic);</span><br><span class="line">    <span class="keyword">return</span> [...quickSort(left), basic, ...quickSort(right)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">77</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">44</span>, <span class="number">66</span>, <span class="number">22</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(quickSort(array)); <span class="comment">//[ 1, 2, 2, 3, 5, 22, 33, 34, 44, 66, 77 ]</span></span><br></pre></td></tr></table></figure>
<h2 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h2><h3 id="參數"><a href="#參數" class="headerlink" title="參數"></a>參數</h3><p>Reduce 又稱為 Fold</p>
<p>Reduce 就與 Map 跟 Filter 不同了</p>
<p>Redcue 須傳入 function 與 初始值</p>
<p>且 Reduce 是依序接到四個變數︰</p>
<ul>
<li><p>accumulator</p>
<ul>
<li>累積值</li>
</ul>
</li>
<li><p>element 當前元素</p>
</li>
<li><p>index - index</p>
</li>
<li><p>array 正在執行 reduce 的陣列</p>
</li>
</ul>
<p>Reduce 的遞迴實作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reduce = <span class="function"><span class="params">func</span> =&gt;</span> <span class="function"><span class="params">acc</span> =&gt;</span> <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (array.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> acc;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [x, ...xs] = array;</span><br><span class="line">    <span class="keyword">return</span> reduce(func)(func(acc, x))(xs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> reverse = reduce(<span class="function">(<span class="params">acc, el</span>) =&gt;</span> [el, ...acc])([])([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(reverse);</span><br></pre></td></tr></table></figure>
<p>functional</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reduce = <span class="function"><span class="params">func</span> =&gt;</span> <span class="function"><span class="params">acc</span> =&gt;</span> <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (array.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> acc;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [x, ...xs] = array;</span><br><span class="line">    <span class="keyword">return</span> reduce(func)(func(acc, x))(xs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> reverse = reduce(<span class="function">(<span class="params">acc, el</span>) =&gt;</span> [el, ...acc])([])([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(reverse);</span><br></pre></td></tr></table></figure>
<h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><p><a href="http://larry850806.github.io/2016/09/20/shallow-vs-deep-copy/" target="_blank" rel="noopener">關於 JS 中的淺拷貝和深拷貝</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Javascript/">Javascript</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FunctionPrograming/">FunctionPrograming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2024 Tomas Lin
            </div>
            <!-- <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div> -->
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>